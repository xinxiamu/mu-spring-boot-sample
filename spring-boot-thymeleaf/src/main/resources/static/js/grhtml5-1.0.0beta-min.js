var gr={};!function(e){"use strict";gr.const_={REPORT_STYLE_ID:"-gr-style-id",GROUP_SUMACC_INSUP:-1,BIG_AMT_NUMBER:"零壹贰叁肆伍陆柒捌玖",HZ_NUMBER:"一二三四五六七八九十零",HZ_NEGATIVE:"负",HZ_ZERO_YUAN:"零元整",HZ_AMT_STEP:"元拾佰仟万拾佰仟亿拾佰仟",HZ_AMT_UNIT:"整角分",HZ_DATETIME_UNIT:"周日星期天",PenStyleHtml:{Solid:"solid",Dash:"dashed",Dot:"dotted",DashDot:"dashed",DashDotDot:"dotted"},MILLISECONDS_DAY:864e5,TIMEZONE_OFFSET:6e4*(new Date).getTimezoneOffset()},gr.enum_={PenStyle:{Solid:0,Dash:1,Dot:2,DashDot:3,DashDotDot:4},BorderStyle:{DrawLeft:1,DrawTop:2,DrawRight:4,DrawBottom:8},BackStyle:{Normal:1,Transparent:2},TextAlign:{TopLeft:17,TopCenter:18,TopRight:20,TopJustiy:144,BottomLeft:65,BottomCenter:66,BottomRight:68,BottomJustiy:192,MiddleLeft:33,MiddleCenter:34,MiddleRight:36,MiddleJustiy:160},TextOrientation:{Default:0,U2DL2R0:5,D2UL2R1:22,U2DR2L0:9,U2DR2L1:25,Invert:58,L2RD2U0:38,L2RD2U1:54},ParameterDataType:{String:1,Integer:2,Float:3,Boolean:5,DateTime:6},FieldType:{String:1,Integer:2,Float:3,Currency:4,Boolean:5,DateTime:6,Binary:7},ControlType:{StaticBox:1,ShapeBox:2,SystemVarBox:3,FieldBox:4,SummaryBox:5,RichTextBox:6,PictureBox:7,MemoBox:8,SubReport:9,Line:10,Chart:11,Barcode:12,FreeGrid:13},SummaryFun:{Sum:1,Avg:2,Count:3,Min:4,Max:5,Var:6,VarP:7,StdDev:8,StdDevP:9,AveDev:10,DevSq:11,CountBlank:12,CountA:13,Distinct:14,AvgA:15,MinN:16,MaxN:17,StrMin:18,StrMax:19,VarA:20,VarPA:21,StdDevA:22,StdDevPA:23,AveDevA:24,DevSqA:25,SumAbs:26,SumAcc:27,GroupSumAcc:28},SystemVarType:{CurrentDateTime:1,RecordNo:4,RowNo:8,RecordCount:19,GroupNo:20,GroupCount:21,GroupRowNo:22,GroupRowCount:23},AnchorStyle:{Left:1,Top:2,Right:4,Bottom:8},AlignColumnSideStyle:{Left:1,Right:2,Both:3},DockStyle:{None:0,Left:1,Top:2,Right:3,Bottom:4,Fill:5},CenterStyle:{None:0,Horizontal:1,Vertical:2,Both:3},ShiftMode:{Never:0,Always:1,WhenOverLapped:2},Unit:{Cm:1,Inch:2},ShapeBoxType:{Circle:1,Ellipse:2,Rectangle:3,RoundRect:4,RoundSquare:5,Square:6,Line:7},PictureAlignment:{TopLeft:1,TopRight:2,Center:3,BottomLeft:4,BottomRight:5},PictureSizeMode:{Clip:1,Stretch:2,Zoom:3,EnsureFullView:4,Tile:5},PictureTransparentMode:{None:0,Overlying:1,Background:2},PictureRotateMode:{None:0,Left:1,Right:2,Flip:3,Mirror:4},ChartType:{BarChart:1,PieChart:2,LineChart:3,StackedBarChart:4,XYScatterChart:5,XYLineChart:6,CurveLineChart:7,XYCurveLineChart:8,Bubble:9,StackedBar100Chart:10,ColumnChart:11,StackedColumnChart:12,StackedColumn100Chart:13},ChartVarType:{XVal:1,YVal:2,ZVal:3,YVal100ByGroup:4,YVal100BySeries:5,YValTotalByGroup:6,YValTotalBySeries:7,SeriesLabel:8,GroupLabel:9},PointMarkerStyle:{None:-1,Square:0,SquareCheck:1,SquareCross:2,Circle:3,CirclePoint:4,CircleCross:5,Dimond:6,Triangle:7,Cross:8,Cross4:9,Star4:10,Star5:11,Star6:12,Star10:13},BarcodeType:{Code25Intlv:1,Code25Ind:2,Code25Matrix:3,Code39:4,Code39X:5,Code128A:6,Code128B:7,Code128C:8,Code93:9,Code93X:10,CodeMSI:11,CodePostNet:12,CodeCodabar:13,CodeEAN8:14,CodeEAN13:15,CodeUPC_A:16,CodeUPC_E0:17,CodeUPC_E1:18,CodeUPC_Supp2:19,CodeUPC_Supp5:20,CodeEAN128A:21,CodeEAN128B:22,CodeEAN128C:23,Code128Auto:24,PDF417:50,QRCode:51,DataMatrix:52},BarcodeCaptionPosition:{None:1,Above:2,Below:3},BarcodeDirection:{LeftToRight:1,RightToLeft:2,TopToBottom:3,BottomToTop:4},DtmxEncoding:{Auto:2,Ascii:3,C40:4,Text:5,X12:6,Edifact:7,Base256:8},DtmxMatrixSize:{Auto:2,"10x10":4,"12x12":5,"14x14":6,"16x16":7,"18x18":8,"20x20":9,"22x22":10,"24x24":11,"26x26":12,"32x32":13,"36x36":14,"40x40":15,"44x44":16,"48x48":17,"52x52":18,"64x64":19,"72x72":20,"80x80":21,"88x88":22,"96x96":23,"104x104":24,"120x120":25,"132x132":26,"144x144":27,"8x18":28,"8x32":29,"12x26":30,"12x36":31,"16x36":32,"16x48":33},StringAlignment:{Near:1,Center:2,Far:3},PeriodType:{None:0,Day:1,Week:2,ThirdMonth:3,HalfMonth:4,Month:5,Quarter:6,HalfYear:7,Year:8,Calendar:9},OCGroupHeaderVAlign:{Top:1,Bottom:2,Middle:3},controlLayout:{auto:0,table:1,absolute:2}},gr.locale={supportIntl:!!window.Intl,decimalSep:".",thousandSep:",",dateSep:"-",timeSep:":",textAM:"上午",textPM:"下午",currencySymbol:"￥"}}(),function(e){"use strict";var t=gr.enum_,r=gr.const_,o=gr.helper={},n=gr.common={},a=r.MILLISECONDS_DAY,i=r.TIMEZONE_OFFSET,l=o.assignJSONMembers=function(e,t){var r,o;for(o in t)r=t[o],"object"!=typeof r&&e.hasOwnProperty(o)&&(e[o]=r)},s=o.enumMemberValid=function(e,t,r){"number"!=typeof e[t]&&(e[t]=g(r,e[t]))},u=o.enumBitMemberValid=function(e,t,r){"number"!=typeof e[t]&&(e[t]=x(r,e[t]))},c=o.colorMemberValid=function(e,t,r){"number"!=typeof e[t]&&(e[t]=parseInt("0x"+e[t],16)|Math.max(0,Math.min(Math.round(255*r)))<<24)},d=o.penStyleText=function(e){return m(e.Width)+" "+r.PenStyleHtml[C(t.PenStyle,e.Style)]+" "+S(e.Color)},p=(o.fontString=function(e,t,r){return t+" "+m(e)+" "+r},o.fontCSSText=function(e){var t="",r=[];return e.Italic&&r.push("italic"),e.Bold&&r.push("bold"),r.push(m(h(e)),e.Name),r.forEach(function(e){t&&(t+=" "),t+=e}),t}),h=o.fontHeight=function(e){return 4*e.Size/3e4},f=(o.intFixed=function(e,t){var r,o=e+"";if(t>0)if(r=t-o.length,0>r)o=o.substring(-r);else for(;r-- >0;)o="0"+o;return o},function(e){var t=e.toFixed(2),r=t.length-1;return"0"===t.charAt(r)&&("0"===t.charAt(r-1)&&(r-=2),t=t.substring(0,r)),t}),m=o.pixelsToHtml=function(e){return f(e)+"px"},g=(o.percentToHtml=function(e){return f(e)+"%"},o.confirmDateValue=function(e){function t(){function t(){var t=e.indexOf(":"),o=t>0&&8>t,n=e.split(/[\:\-\/ ]/g),a=n.length,i=a>0?+n[0]:0,l=a>1?+n[1]:0,s=a>2?+n[2]:0,u=a>3?+n[3]:0,c=a>4?+n[4]:0,d=a>5?+n[5]:0;return isNaN(l)&&(t=n[1],l=r.HZ_NUMBER.indexOf(t.charAt(0))+1,t.length>=3&&(l+=r.HZ_NUMBER.indexOf(t.charAt(1))+1)),o&&(t=i,i=u,u=t,t=l,l=c,c=t,t=s,s=d,d=t),s>31&&(t=i,i=s,s=t,t=l,l=s,s=t),l>12&&(t=l,l=s,s=t),new Date(i,--l,s,u,c,d)}var o;return"string"!=typeof e?(o=new B,o.AsFloat=+e,e=o.value):(o=Date.parse(e),e=isNaN(o)?t():new Date(o)),e}return Date.prototype.isPrototypeOf(e)?e:t()},o.cloneDate=function(e){return new Date(e)},o.strimDate=function(e){var t=e.getTime();e.setTime(t-(t-6e4*e.getTimezoneOffset())%a)},o.incDate=function(e){e.setTime(e.getTime()+a)},o.incDate2=function(e,t){e.setTime(e.getTime()+t*a)},o.confirmBooleanValue=function(e){if(e.constructor===Boolean.prototype.constructor)return e;if("string"==typeof e){if(e.toLowerCase(),"TRUE"===e||"true"===e)return!0;e=parseInt(e)}return!!e},o.ensureNameText=function(e){return/^[A-Za-z_\u0100-\uffff][\w\u0100-\uffff]*$/.test(e)||(e="["+e+"]"),e},o.enumName2Value=function(t,r){var o=t[r];return o!==e?o:-1}),C=o.enumValue2Name=function(e,t){for(var r in e)if(e[r]===t)return r;return""},x=function(e,t){var r,o,n,a=0;for(t=t.substring(1,t.length-1),r=t.split("|"),n=r.length,o=0;n>o;o++)a+=e[r[o]]||0;return a},y=(o.rgba2color=function(e,t,r,o){return y(e|t<<8|r<<16,o)},o.colorAlpha=function(e,t){return e|Math.max(0,Math.min(Math.round(255*t)))<<24}),T=o.color2rgba=function(e){return{r:255&e,g:e>>8&255,b:e>>16&255,a:(e>>24&255)/255}},S=o.colorValue2Html=function(e){function t(e){return(16>e?"0":"")+e.toString(16)}var r=T(e);return 1===r.a?"#"+t(r.r)+t(r.g)+t(r.b):"rgba("+r.r+","+r.g+","+r.b+","+f(r.a)+")"},b=(o.decodeTextColor=function(e){var t,r,o,n,a,i=4;return"rgb("===e.substring(0,4)&&(t=e.indexOf(")",i),-1!==t&&(e=e.substring(4,t),r=e.split(","),3===r.length&&(o=parseInt(r[0]),n=parseInt(r[1]),a=parseInt(r[2]),o>=0&&255>=o&&n>=0&&255>=n&&a>=0&&255>=a)))?{color:rgb(o,n,a),index:t+1}:!1},o.prototypeLinkExtend=function(e,t){function r(){}var o,n=e.prototype;r.prototype=t.prototype,o=new r;for(var a in n)o[a]=n[a];e.prototype=o,e.prototype.constructor=e},o.prototypeCopyExtend=function(e,t){var r=t.prototype,o=e.prototype;for(var n in r)o.hasOwnProperty(n)||(o[n]=r[n])},o.createArray=function(e,t){for(var r=[],o=0;o++<e;)r.push(t);return r},o.assignObjectEx=function(e,t,r){var o,n;for(var a in t)t.hasOwnProperty(a)&&(o=t[a],n=typeof o,r&&"object"===n?(e[a]||(e[a]={}),v(e[a],o)):e[a]=o);return e}),v=o.assignObject=function(e,t){b(e,t,1)},F=(o.assignObjectAtom=function(e,t){var r;for(var o in t)t.hasOwnProperty(o)&&(r=t[o],"object"!=typeof r&&(e[o]=r));return e},o.compareObject=function(e,t){var r;for(var o in e)if(r=typeof e[o],"object"===r){if(!F(e[o],t[o]))return!1}else if("function"!==r&&e[o]!==t[o])return!1;return!0}),w=(o.parseXML=function(t){function r(){for(var e,r=0,o=t.indexOf("<",r),n=[];o>=0;)o>r&&(e=t.substring(r,o),/\S/g.test(e)&&n.push(e)),r=o,o=t.indexOf(">",r+1),n.push(t.substring(r,++o)),r=o,o=t.indexOf("<",r);return n}var o;/\s/g.test(t)&&(t=r().join(""));try{o=(new DOMParser).parseFromString(t,"text/xml")}catch(n){o=e}return o},o.xmlToReportDataJSON=function(e){var t,r,o,n,a="",i={};for(o=e.childNodes[0].firstChild;o;){for(o.nodeName!==a&&(a=o.nodeName,r=[],i[o.nodeName]=r),t={},n=o.firstChild;n;)t[n.nodeName]=n.hasOwnProperty("text")?n.text:n.textContent,n=n.nextSibling;r.push(t),o=o.nextSibling}return i},o.getRelativePosition=function(e){var t,r,o=e.originalEvent||e,n=e.currentTarget||e.srcElement,a=n.getBoundingClientRect();return o.touches?(t=o.touches[0].clientX-a.left,r=o.touches[0].clientY-a.top):(t=o.clientX-a.left,r=o.clientY-a.top),{x:t,y:r}},o.addEvent=function(e,t,r){e.addEventListener?e.addEventListener(t,r):e.attachEvent?e.attachEvent("on"+t,r):e["on"+t]=r}),D=o.removeEvent=function(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent?e.detachEvent("on"+t,r):e["on"+t]=noop},P=(o.bindEvents=function(e,t,r){e.events||(e.events={}),t.forEach(function(t){e.events[t]=function(){r.apply(e,arguments)},w(e.canvas,t,e.events[t])})},o.unbindEvents=function(e,t){t.forEach(function(t,r){D(e.canvas,r,t)})},o.toRadians=function(e){return e*(Math.PI/180)}),B=(o.toDegree=function(e){return 180*e/Math.PI},n.DateTime=function(){this.value=new Date});B.prototype={get Year(){return this.value.getFullYear()},get Month(){return this.value.getMonth()+1},get Day(){return this.value.getDate()},get Hour(){return this.value.getHours()},get Minute(){return this.value.getMinutes()},get Second(){return this.value.getSeconds()},get DayOfWeek(){return this.value.getDay()},get DayOfYear(){var e=this.value,t=e.getFullYear();return(new Date(t,e.getMonth(),e.getDate()).getTime()-new Date(t,0,1).getTime())/a+1},get AsFloat(){return(this.value.getTime()+new Date(1970,0,1).getTime()-new Date(1899,11,30).getTime()-i)/a},set AsFloat(e){this.value.setTime(e*a+new Date(1899,11,30).getTime()-new Date(1970,0,1).getTime()+i)},ValueFromDate:function(e,t,r){this.value=new Date(e,t-1,r)},ValueFromDateTime:function(e,t,r,o,n,a){this.value=new Date(e,t-1,r,o,n,a)},Format:function(e){return new gr.format.DateTimeFormatter(e).format(this.value)}};var A=n.Rect=function(e,t,r,o){var n=this;n.left=e,n.top=t,n.right=r,n.bottom=o};A.prototype={clone:function(){var e=this;return new A(e.left,e.top,e.right,e.bottom)},IsRectEmpty:function(){var e=this;return e.left>=e.right||e.top>=e.bottom},PtInRect:function(e,t){var r=this;return r.left<=e&&e<r.right&&r.top<=t&&t<r.bottom},Width:function(){var e=this;return e.right-e.left},Height:function(){var e=this;return e.bottom-e.top},SetRect:function(e,t,r,o){var n=this;n.left=e,n.top=t,n.right=r,n.bottom=o},InflateRect:function(e,t){var r=this;r.left-=e,r.top-=t,r.right+=e,r.bottom+=t},OffsetRect:function(e,t){var r=this;r.left+=e,r.top+=t,r.right+=e,r.bottom+=t}};var E=n.Pen=function(){var e=this;e.Width=1,e.Style=0,e.Color=y(0,1)};E.prototype={clone:function(){var e=this,t=new E;return t.Width=e.Width,t.Style=e.Style,t.Color=e.Color,t},loadFromJSON:function(e,r){e&&(l(this,e),s(this,"Style",t.PenStyle),c(this,"Color",r))},getDashStyle:function(){var e;switch(this.Style){case 1:e=[2,2];break;case 2:e=[1,1];break;case 3:e=[2,1,1,1];break;case 4:e=[2,1,1,1,1,1];break;default:e=[]}return e}};var R=n.Border=function(e){var t=this;t.Styles=e,t.Shadow=!1,t.ShadowWidth=4,t.ShadowColor=0,t.Pen=new E};R.prototype={loadFromJSON:function(e,r){var o=this;e&&(l(this,e),u(this,"Styles",t.BorderStyle),c(this,"ShadowColor"),e.Pen&&o.Pen.loadFromJSON(e.Pen,r))},getLeftWidth:function(){var e=this;return 1&e.Styles?e.Pen.Width:0},getRightWidth:function(){var e=this;return(4&e.Styles?e.Pen.Width:0)+(e.Shadow?e.ShadowWidth:0)},getTopWidth:function(){var e=this;return 2&e.Styles?e.Pen.Width:0},getBottomWidth:function(){var e=this;return(8&e.Styles?e.Pen.Width:0)+(e.Shadow?e.ShadowWidth:0)}};var L=n.Font=function(){var e=this;e.Size=97500,e.Bold=!1,e.Italic=!1,e.Underline=!1,e.Strikethrough=!1,e.Name=""};L.prototype={loadFromJSON:function(e){e&&l(this,e)},clone:function(){var e=this,t=new L;return t.Size=e.Size,t.Bold=e.Bold,t.Italic=e.Italic,t.Underline=e.Underline,t.Strikethrough=e.Strikethrough,t.Name=e.Name,t}};var M=n.FontWrapper=function(e){this.parentFont=e};M.prototype={loadFromJSON:function(e){var t=this;e&&(t.prepareModify(),t.font.loadFromJSON(e))},assign:function(e){var t=this;e.font?t.font=e.font.clone():delete t.font},prepareModify:function(){var e=this;e.font||(e.font=e.parentFont.UsingFont().clone())},Clone:function(){var e=this,t=new M(e.parentFont);return t.font=e.UsingFont().clone(),t},UsingFont:function(){var e=this;return e.font?e.font:e.parentFont.UsingFont()},get Name(){return this.UsingFont().Name},set Name(e){var t=this;t.prepareModify(),t.font.Name=e},get Point(){return this.UsingFont().Size/1e4},set Point(e){var t=this;t.prepareModify(),t.font.Size=1e4*e},get Bold(){return this.UsingFont().Bold},set Bold(e){var t=this;t.prepareModify(),t.font.Bold=e},get Italic(){return this.UsingFont().Italic},set Italic(e){var t=this;t.prepareModify(),t.font.Italic=e},get Underline(){return this.UsingFont().Underline},set Underline(e){var t=this;t.prepareModify(),t.font.Underline=e},get Strikethrough(){return this.UsingFont().Strikethrough},set Strikethrough(e){var t=this;t.prepareModify(),t.font.Strikethrough=e}};var V=n.TextFormat=function(){var e=this;e.WordWrap=!1,e.EndEllipsis=!1,e.TextAlign=33,e.CharacterSpacing=0,e.LineSpacing=0,e.FirstCharIndent=0};V.prototype={loadFromJSON:function(e){var r=this;e&&(l(this,e),e.CharSpacing&&(r.CharacterSpacing=e.CharSpacing),s(this,"TextAlign",t.TextAlign),s(this,"TextOrientation",t.TextOrientation))}};var G=n.Context=function(e){var t=this;t.ctx=e,e.textBaseline="top",t.pens=[new E],t.defaultFillStyles=e.fillStyle,t.fonts=[]};G.prototype={setDefaultFillColor:function(e){var t=this;t.defaultFillStyles=S(e),t.ctx.fillStyle=t.defaultFillStyles},setFillStyle:function(e){this.ctx.fillStyle=e},setFillColor:function(e){this.ctx.fillStyle=S(e)},resetFillStyle:function(){var e=this;e.ctx.fillStyle=e.defaultFillStyles},SelectPen:function(e){var t=this;t.pens.push(e),t._applyPen()},RestorePen:function(){var e=this;e.pens.pop(),e._applyPen()},SelectFont:function(e){var t=this,r=t.fonts,o=r[r.length-1];e!==o&&(t.ctx.font=p(e)),r.push(e)},RestoreFont:function(){var e=this,t=e.fonts,r=t.pop(),o=t[t.length-1];t.length>0?o!==r&&(e.ctx.font=p(o)):e.ctx.font=""},measureTextWidth:function(e){return this.ctx.measureText(e).width},drawText:function(e,t,r){this.ctx.fillText(e,t,r)},drawTextCenter:function(e,t,r){var o=this.ctx;o.textAlign="center",o.fillText(e,t,r),o.textAlign="start"},drawTextRotate:function(e,t,r,o){var n=this.ctx;n.translate(t,r),n.rotate(P(-o)),this.ctx.fillText(e,0,0),n.setTransform(1,0,0,1,0,0)},drawLine:function(e,t,r,o){var n=this.ctx;n.beginPath(),n.moveTo(e,t),n.lineTo(r,o),n.stroke()},drawPolyLine:function(e,t,r){var o=this.ctx,n=0,a=e.length;for(o.beginPath(),o.moveTo(e[n++],e[n++]);a>n;)o.lineTo(e[n++],e[n++]);r&&o.closePath(),o.stroke(),t&&o.fill()},polyBezier:function(e){var t,r=this.ctx,o=e.length;for(r.beginPath(),r.moveTo(e[0].x,e[0].y),t=1;o>t;t++)r.bezierCurveTo(e[t].x,e[t++].y,e[t].x,e[t++].y,e[t].x,e[t].y);r.stroke()},DrawHorzLine:function(e,t,r){this.drawLine(t,e,r,e)},DrawVertLine:function(e,t,r){this.drawLine(e,t,e,r)},circle:function(e,t,r,o,n){var a=this.ctx,i=(o>r?r:o)/2;e+=r/2,t+=o/2,a.beginPath(),a.arc(e,t,i,0,2*Math.PI),a.stroke(),n&&a.fill()},ellipse:function(e,t,r,o,n){var a=this.ctx,i=r>o?r:o,l=r/i,s=o/i;e+=r/2,t+=o/2,i/=2,a.beginPath(),a.save(),a.scale(l,s),a.arc(e/l,t/s,i,0,2*Math.PI),a.restore(),a.stroke(),n&&a.fill()},rectangle:function(e,t,r,o,n){var a=this;a.ctx.strokeRect(e,t,r,o),n&&a.ctx.fillRect(e,t,r,o)},rectangle2:function(e,t){this.rectangle(e.left,e.top,e.Width(),e.Height(),t)},square:function(e,t,r,o,n){var a=o>r?r:o;e+=(r-a)/2,t+=(o-a)/2,this.rectangle(e,t,a,a,n)},roundRectangle:function(e,t,r,o,n,a,i){var l=this.ctx;l.beginPath(),l.moveTo(e+n,t),l.lineTo(e+r-n,t),l.quadraticCurveTo(e+r,t,e+r,t+a),l.lineTo(e+r,t+o-a),l.quadraticCurveTo(e+r,t+o,e+r-n,t+o),l.lineTo(e+n,t+o),l.quadraticCurveTo(e,t+o,e,t+o-a),l.lineTo(e,t+a),l.quadraticCurveTo(e,t,e+n,t),l.stroke(),i&&l.fill()},roundSquare:function(e,t,r,o,n,a,i){var l=o>r?r:o;e+=(r-l)/2,t+=(o-l)/2,this.roundRectangle(e,t,l,l,n,a,i)},pie:function(e,t,r,o,n){var a=this,i=a.ctx;o=P(o),n=P(n),i.beginPath(),i.moveTo(e,t),i.arc(e,t,r,-o,-n,1),i.closePath(),i.stroke(),i.fill()},drawBar:function(e,t,r,o){var n,a=this,i=a.ctx,l=[{x:e.left,y:e.bottom},{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.right,y:e.bottom}];a.setFillColor(r),a.SelectPen(t),i.fillRect(e.left,e.top,e.Width(),e.Height()),i.beginPath(),n=l[o],i.moveTo(n.x,n.y),n=l[++o%4],i.lineTo(n.x,n.y),n=l[++o%4],i.lineTo(n.x,n.y),n=l[++o%4],i.lineTo(n.x,n.y),i.stroke(),a.RestorePen(),a.resetFillStyle()},DrawPointMarker:function(e,t,r,o){function n(){var r,o=10===t?4:11===t?5:12===t?6:10,n=2*Math.PI/o,a=n/2,i=e.Width()/2,l=i/2,u=e.left+i,c=e.top+i,d=Math.PI/2,p=[];for(r=0;o>r;r++)p.push(u+Math.cos(d)*i,c-Math.sin(d)*i),d+=a,p.push(u+Math.cos(d)*l,c-Math.sin(d)*l),d+=a;s.drawPolyLine(p,1,1)}function a(){var n=r.clone();n.Color=o,s.SelectPen(n),s.drawLine(e.left,e.top,e.right,e.bottom),s.drawLine(e.left,e.bottom,e.right,e.top),9===t&&(i=(e.left+e.right)/2,s.drawLine(i,e.top,i,e.bottom),l=(e.top+e.bottom)/2,s.drawLine(e.left,l,e.right,l)),s.RestorePen()}var i,l,s=this,u=e.Width(),c=Math.min(4,(u-4)/2);switch(s.setFillColor(o),s.SelectPen(r),t){case 3:case 4:case 5:s.ellipse(e.left,e.top,e.Width(),e.Height(),1),4===t?s.circle((e.left+e.right)/2-1,(e.top+e.bottom)/2-1,2,2,0):5===t&&(u=Math.min(4,u/3),s.drawLine(e.left+u,e.top+u,e.right-u,e.bottom-u),s.drawLine(e.right-u,e.top+u,e.left+u,e.bottom-u));break;case 0:case 1:case 2:s.rectangle(e.left,e.top,e.Width(),e.Height(),1),1===t?s.drawPolyLine([e.left+c,e.top+u/2,e.left+u/2,e.bottom-c,e.right-c,e.top+c]):2===t&&(s.drawLine(e.left+c,e.top+c,e.right-c,e.bottom-c),s.drawLine(e.right-c,e.top+c,e.left+c,e.bottom-c));break;case 8:case 9:a();break;case 6:s.drawPolyLine([(e.left+e.right)/2,e.top,e.left,(e.top+e.bottom)/2,(e.left+e.right)/2,e.bottom,e.right,(e.top+e.bottom)/2],1,1);break;case 7:s.drawPolyLine([(e.left+e.right)/2,e.top,e.left,e.bottom,e.right,e.bottom],1,1);break;case 10:case 11:case 12:case 13:n()}s.RestorePen(),s.resetFillStyle()},_applyPen:function(){var e=this,t=e.pens[e.pens.length-1];e.ctx.lineWidth=t.Width,e.ctx.strokeStyle=S(t.Color),e.ctx.setLineDash(t.getDashStyle())}};var N=n.HtmlStyles=function(){this.items=[]};N.prototype={add:function(e,t){this.items.push({name:e,value:t})},addBackColor:function(e){this.add("background-color",S(e))},addCellBorder:function(e){var t=this;e.ShowColLine&&e.ShowRowLine&&F(e.ColLinePen,e.RowLinePen)?t.add("border",d(e.ColLinePen)):(e.ShowRowLine&&t.add("border-bottom",d(e.ColLinePen)),e.ShowColLine&&t.add("border-right",d(e.RowLinePen)))},addObjectPadding:function(e){var t="";return e.PaddingRight===e.PaddingLeft&&e.PaddingTop===e.PaddingBottom?(e.PaddingRight!==e.PaddingTop&&(t=m(e.PaddingTop)+" "),t+=m(e.PaddingRight)):t=m(e.PaddingTop)+" "+m(e.PaddingRight)+" "+m(e.PaddingBottom)+" "+m(e.PaddingLeft),this.add("padding",t)},addBorder:function(e){var t,r=this;e.Styles&&(t=d(e.Pen),15===e.Styles?r.add("border",t):(1&e.Styles&&r.add("border-left",t),4&e.Styles&&r.add("border-right",t),2&e.Styles&&r.add("border-top",t),8&e.Styles&&r.add("border-bottom",t))),e.Shadow&&(t=m(e.ShadowWidth)+" ",r.add("box-shadow",t+t+S(e.ShadowColor)))},addTextFormat:function(e,t){var r=this,o="text-align",n=e.WordWrap;1&e.TextAlign?r.add(o,"left"):2&e.TextAlign?r.add(o,"center"):4&e.TextAlign?r.add(o,"right"):r.add(o,"justify"),t&&(o="vertical-align",16&e.TextAlign?r.add(o,"top"):32&e.TextAlign?r.add(o,"middle"):r.add(o,"bottom")),e.EndEllipsis&&(r.add("text-overflow","ellipsis"),n=!1),n?r.add("white-space","normal"):(r.add("overflow","hidden"),r.add("white-space","nowrap")),e.CharacterSpacing&&r.add("letter-spacing",m(e.CharacterSpacing)),e.FirstCharIndent&&r.add("text-indent",m(e.FirstCharIndent)),e.ForeColor&&r.add("color",S(e.ForeColor))},getText:function(){var e="";return this.items.forEach(function(t){e+=t.name+":"+t.value+";"}),e},clear:function(){this.items=[]}};var H=n.HtmlElement=function(e,t){var r=this;r.tag=e,r.classes=[],t.addChild(this)};H.prototype={getStyles:function(){var e=this;return e._styles||(e._styles=new N),e._styles},addClass:function(e){this.classes.push(e)},addStyle:function(e,t){var r=this;r._styles||(r._styles=new N),r._styles.add(e,t)},addBackColorStyle:function(e){this.addStyle("background-color",S(e))},addAttribute:function(e,t){var r=this;r._attributes||(r._attributes=[]),r._attributes.push({name:e,value:t})},addChild:function(e){var t=this;t.children||(t.children=[]),t.children.push(e)},beginText:function(){var e=this,t="\r\n<"+e.tag;return e.classes.length>0&&(t+=' class="',e.classes.forEach(function(e,r){r>0&&(t+=" "),t+=e}),t+='"'),e._styles&&(t+=' style="'+e._styles.getText()+'"'),e._attributes&&e._attributes.forEach(function(e){t+=" "+e.name+'="'+e.value+'"'}),e.skipend&&(t+="/"),t+=">"},endText:function(){var e=this;return e.skipend?"":"</"+e.tag+">"}}}(),function(e){"use strict";var t=(gr.enum_,gr.const_),r=gr.common,o=gr.locale,n=gr.helper,a=r.DateTime,i=n.intFixed,l=n.confirmDateValue,s=n.confirmBooleanValue,u=n.rgba2color,c=n.color2rgba,d=n.decodeTextColor,p=gr.format={};p.BooleanFormatter=function(e){this.parse(e)},p.BooleanFormatter.prototype={parse:function(e){var t,r=this;e?(t=e.indexOf(":"),-1===t?(r.trueValueText=e,r.falseValueText=""):(r.trueValueText=e.substring(0,t),r.falseValueText=e.substring(t+1))):(r.trueValueText="true",r.falseValueText="false")},format:function(e){var t=this;return e=s(e),e?t.trueValueText:t.falseValueText}};var h=function(){this.defaultMe()};h.prototype={defaultMe:function(){var e=this;e.precision=9,e.leastPrecision=0,e.leastIntegerWidth=1,e.showPositive=!1,e.showNegative=!0,e.showSymbolAtHead=!0,e.negativeBracket=!1,e.intSepStep=0,e.asPercent=!1,e.asCurrency=!1,e.blankSepSymbol=!1,e.firstCurrencySymbol=!0,e.exponent=!1,e.textColor=0,e.prefix="",e.suffix=""},isCustomTextColor:function(){return 0!==this.textColor},parse:function(e){function t(e){return-1!=="0#.,+-()$%".indexOf(e)}var r,o,n,a,i,l=this;if(l.defaultMe(),e){if(r=d(e),r&&(e=e.substring(r.index),l.textColor=r.color),i=e.length,l.exponent="e"===e.charAt(0),!l.exponent){for(o=0;i>o&&!t(e.charAt(o));)++o;if(o>0&&(l.prefix=e.substring(0,o),e=e.substring(o),i=e.length),i>o){for(o=i-1;!t(e.charAt(o))&&o>0;)--o;i-1>o&&(l.suffix=e.substring(o+1),e=e.substring(0,o+1),i=e.length)}}for(a=e.indexOf("."),-1===a&&(a=i),o=e.indexOf(","),o>=0&&(l.intSepStep=a-o-1,l.intSepStep<0&&(l.intSepStep=3)),l.negativeBracket=e.indexOf("(")>=0&&e.indexOf(")")>=0,l.asPercent=e.indexOf("%")>=0,l.blankSepSymbol=e.indexOf(" ")>=0,o=e.indexOf("+"),l.showPositive=o>=0,n=e.indexOf("-"),l.showNegative=n>=0||!l.negativeBracket&&!l.isCustomTextColor(),n>o&&(o=n),n=e.indexOf("$"),l.asCurrency=n>=0,n>o&&(o=n),l.showSymbolAtHead=-1===o||a>o,l.asCurrency&&(l.negativeBracket?(o=e.indexOf(l.showSymbolAtHead?"(":")"),l.firstCurrencySymbol=o>n):l.firstCurrencySymbol=o>=n),l.leastIntegerWidth=0,o=0;a>o;++o)"0"===e.charAt(o)&&++l.leastIntegerWidth;for(l.leastPrecision=0,l.precision=0,o=a+1;i>o;++o)"0"===e.charAt(o)?(++l.leastPrecision,++l.precision):"#"===e.charAt(o)&&++l.precision}},format:function(e){var t,r,n,a,i,l,s,u,d,p,h,f=this,m="";if(e=+e,f.isCustomTextColor()&&(t=c(f.textColor),m="[_color#=rgb("+t.r+","+t.g+","+t.b+")]"),f.asPercent&&(e*=100),f.exponent){if(r=e,0>r&&(r=-r),n=0,0!==r){for(;r>=10;)r/=10,++n;for(;1>r;)r*=10,--n}return f.exponent=!1,0>e&&(r=-r),m+=f.format(r),m+="e",n>=0?m+="+":(m+="-",n=-n),m+=n,f.exponent=!0,m}if(h=e.toFixed(f.precision),p=h.length,f.precision>f.leastPrecision){for(a=p-1,i=a-f.precision+f.leastPrecision;a>i&&"0"===h.charAt(a);a--);"."!==h.charAt(a)&&a++,a<h.length&&(h=h.substring(0,a),p=a)}if(l=h.indexOf("."),0>l&&(l=p),m+=f.prefix,f.showSymbolAtHead?(f.asCurrency&&f.firstCurrencySymbol&&(m+=o.currencySymbol),0>e?f.negativeBracket&&(m+="("):f.showPositive&&e>0&&(m+="+"),f.asCurrency&&!f.firstCurrencySymbol&&(m+=o.currencySymbol),f.blankSepSymbol&&(m+=" ")):f.negativeBracket&&0>e&&(m+="("),a=0,s=l,u=f.leastIntegerWidth-s,0>e&&(--s,++a,f.showNegative&&(m+="-")),d=s,u>0)for(d+=u;d>s;)m+="0",d--,f.intSepStep>0&&d%f.intSepStep===0&&(m+=o.thousandSep);else for(;u--<0&&"0"===h.charAt(a);)a++;if(f.intSepStep>0)for(;d>0;)m+=h.charAt(a++),--d%f.intSepStep===0&&0!==d&&(m+=o.thousandSep);else m+=h.substring(a,l);return p>l&&(m+=h.substring(l)),f.showSymbolAtHead?f.negativeBracket&&0>e&&(m+=")"):(f.blankSepSymbol&&(m+=" "),f.asCurrency&&f.firstCurrencySymbol&&(m+=o.currencySymbol),0>e?m+=f.negativeBracket?")":"-":f.showPositive&&e>0&&(m+="+"),f.asCurrency&&!f.firstCurrencySymbol&&(m+=o.currencySymbol)),f.asPercent&&(m+="%"),m+=f.suffix}};var f=function(e){e=e.substring(1,e.length-1);for(var t=e.split(","),r=0;r<t.length;r++){var o=t[r],n=o.indexOf("=");this[o.substring(0,n)]=o.substring(n+1)}};f.prototype={format:function(t){var r=this[t];return r===e&&(r=""),r}};var m="$$",g="$$$";p.NumericFormatter=function(e){this.parse(e)},p.NumericFormatter.prototype={defaultMe:function(){var e=this;e.formatType=0,e.positiveAnalyser=new h,e.negativeAnalyser&&(e.negativeAnalyser=null),e.zeroAnalyser&&(e.zeroAnalyser=null),e.intEnumAnalyser&&(e.intEnumAnalyser=null)},parse:function(e){function t(e){var t,r;t=e.split(";"),r=t.length,o.positiveAnalyser.parse(t[0]),r>1&&""!==t[1]&&(o.negativeAnalyser=new h,o.negativeAnalyser.parse(t[1])),r>2&&""!==t[2]&&(o.zeroAnalyser=new h,o.zeroAnalyser.parse(t[2]))}var r,o=this;if(o.defaultMe(),e){var n=e.length;e&&(r=e.indexOf(g),-1!==r?(o.formatType=1,e=e.substring(0,r)+e.substring(r+g.length),""!==e&&t(e)):n>=2&&e.substring(0,2)===m?2===n?o.formatType=2:(o.formatType=3,t(e.substring(2))):"{"===e.charAt(0)&&"}"===e.charAt(n-1)?(o.formatType=4,o.intEnumAnalyser=new f(e)):t(e))}},format:function(r){function o(e){var r,o,n="",a=e.length;for(o=0;a>o;o++)r=parseInt(e.charAt(o)),isNaN(r)||(n+=t.BIG_AMT_NUMBER.charAt(r));return n}function n(e){var r,o,n,a,i,l=0>=e;return e>-.005&&.005>e?t.HZ_ZERO_YUAN:(l&&(e=-e),a=e.toFixed(2),r=a.indexOf("."),i=s(a,r),""!==i&&(i+=t.HZ_AMT_STEP.charAt(0)),o=parseInt(a.charAt(r+1)),n=parseInt(a.charAt(r+2)),0===o&&0===n?i+=t.HZ_AMT_UNIT[0]:(0===o&&""===i||(i+=t.BIG_AMT_NUMBER.charAt(o)),0!==o&&(i+=t.HZ_AMT_UNIT.charAt(1)),0!==n?(i+=t.BIG_AMT_NUMBER.charAt(n),i+=t.HZ_AMT_UNIT.charAt(2)):i+=t.HZ_AMT_UNIT.charAt(0)),l&&(i=t.HZ_NEGATIVE+i),i)}function a(e,r){var o,n,a,i,l=Math.max(0,r.precision),u=Math.min(l,r.leastPrecision),c=-.5*Math.pow(.1,l),d=c>=e;for(0>e&&(e=-e),a=e.toFixed(l),o=a.length,n=a.indexOf("."),-1===n&&(n=o),i=s(a,n),""===i&&(i=t.BIG_AMT_NUMBER.charAt(0)),o--;o>n+u&&"0"===a.charAt(o);o--);if(o>n)for(i+="点",n++;o>=n;n++)i+=t.BIG_AMT_NUMBER.charAt(parseInt(a.charAt(n)));return d&&(i=t.HZ_NEGATIVE+i),""!==r.prefix&&(i=r.prefix+i),""!==r.suffix&&(i+=r.suffix),i}var i,l=this,s=function(e,r){var o,n,a=!1,i=!1,l=0,s="";for(o=r-1;o>=0;o--,l++)n=parseInt(e.charAt(o)),l%4===0&&l>0&&(a=!0),0===n?i=!0:(i&&(""!==s&&(s=t.BIG_AMT_NUMBER.charAt(0)+s),i=!1),l>0&&(a&&l%4!==0&&(s=t.HZ_AMT_STEP.charAt(l-l%4)+s),a=!1,s=t.HZ_AMT_STEP.charAt(l)+s),s=t.BIG_AMT_NUMBER.charAt(n)+s);return s};if(isNaN(r))i="";else if(l.formatType<=1){if(l.zeroAnalyser&&r>-.5&&.5>r){var u=l.positiveAnalyser.precision;l.positiveAnalyser.asPercent&&(u+=2);var c=u;l.negativeAnalyser&&(c=l.negativeAnalyser.precision,l.negativeAnalyser.asPercent&&(c+=2));var d=Math.pow(.1,c)*-.5,p=.5*Math.pow(.1,u);r>d&&p>r&&(i=l.zeroAnalyser.format(0))}i===e&&(i=l.negativeAnalyser&&0>r?l.negativeAnalyser.format(r):l.positiveAnalyser.format(r)),1===l.formatType&&(i=o(i))}else i=4===l.formatType?l.intEnumAnalyser.format(r):2===l.formatType?n(r):a(r,l.positiveAnalyser);return i}},p.DateTimeFormatter=function(e){this.parse(e)},p.DateTimeFormatter.prototype={parse:function(r){function n(){for(w=1;D[F+1]===P;)F++,w++}function a(){var e=w;w%=2,e=(e-w)/2,e>0&&l(e)}function l(e){var t="",r=E.length;do t+=P;while(--e>0);r>0&&15===E[r-1].type?E[r-1].data+=t:E.push({type:15,data:t,funDisplayText:y})}function s(e,t){return i(e.getFullYear(),t.subtype)}function u(r,n){var a=r.getMonth();return n.subtype<=4?i(a+1,n.subtype):o.supportIntl?5===n.subtype?new Intl.DateTimeFormat(e,{month:"short"}).format(r):new Intl.DateTimeFormat(e,{month:"long"}).format(r):10>a?t.HZ_NUMBER.charAt(a):t.HZ_NUMBER.charAt(9)+t.HZ_NUMBER.charAt(a-10)+t.HZ_DATETIME_UNIT.charAt(5)}function c(e,t){return i(e.getDate(),t.subtype)}function d(r,n){var a;return o.supportIntl?5===n.subtype?new Intl.DateTimeFormat(e,{weekday:"short"}).format(r):new Intl.DateTimeFormat(e,{weekday:"long"}).format(r):(a=r.getDay(),(5===n.subtype?t.HZ_DATETIME_UNIT.substring(0,1):t.HZ_DATETIME_UNIT.substring(2,4))+(a>0?t.HZ_NUMBER.charAt(a-1):t.HZ_DATETIME_UNIT.charAt(1)))}function p(e,t){var r=e.getHours()%12;return r||(r=12),i(r,t.subtype)}function h(e,t){return i(e.getHours(),t.subtype)}function f(e,t){return i(e.getMinutes(),t.subtype)}function m(e,t){return i(e.getSeconds(),t.subtype)}function g(e,t){return e.toLocaleDateString()}function C(e,t){return e.toLocaleTimeString()}function x(e,t){return e.toLocaleString()}function y(e,t){return t.data}function T(e,t){return e.getHours()<12?o.textAM:o.textPM}function S(e,t){return o.dateSep}function b(e,t){return o.timeSep}var v,F,w,D,P,B,A,E=this.items=[];if(r){D=r.split(""),v=D.length,F=0;do{switch(P=D[F],n(),A={},P){case"d":3>w?(A.type=3,A.funDisplayText=c,A.subtype=1===w?0:2):(A.type=4,A.funDisplayText=d,A.subtype=3===w?5:6);break;case"M":A.type=2,A.funDisplayText=u,1===w?A.subtype=0:2===w?A.subtype=2:3===w?A.subtype=5:A.subtype=6;break;case"y":A.type=1,A.funDisplayText=s,A.subtype=3>w?2:0;break;case"h":A.type=5,A.funDisplayText=p,A.subtype=1===w?0:2;break;case"H":A.type=6,A.funDisplayText=h,A.subtype=1===w?0:2;break;case"m":A.type=7,A.funDisplayText=f,A.subtype=1===w?0:2;break;case"s":A.type=8,A.funDisplayText=m,A.subtype=1===w?0:2;break;case"t":2===w&&(A.type=20,A.funDisplayText=T);break;case"%":a(),w&&(B=D[F+1],++F,"d"===B?(A.type=10,A.funDisplayText=g):"t"===B?(A.type=11,A.funDisplayText=C):"g"===B?(A.type=12,A.funDisplayText=x):F--);break;case":":a(),w&&(A.type=22,A.funDisplayText=b);break;case"/":a(),w&&(A.type=21,A.funDisplayText=S);break;default:l(w)}A.type&&15!==A.type&&E.push(A)}while(++F<v)}else E.push({type:12,funDisplayText:x})},format:function(t){var r="";return t!==e&&(t=l(t),this.items.forEach(function(e){r+=e.funDisplayText(t,e)})),r}};var C=gr.utility={CreateDateTime:function(){return new a},DateTimeFormat:function(e,t){return new p.DateTimeFormatter(t).format(l(e))},NumberFormat:function(e,t){return new p.NumericFormatter(t).format(e)},NumberFormatToBigHZ:function(e,t){var r,o="$$0";if(t>0)for(o+=".",r=0;t>r;r++)o+="0";return C.NumberFormat(e,o)},NumberFormatToBigHZAmount:function(e){return C.NumberFormat(e,"$$")},NumberRound45:function(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r},NumberRound465:function(e,t){var r,o,n,a=Math.pow(10,t+2);return e=Math.floor(e*a),r=e%10,o=e%100-r,e-=o+r,o>=60?e+=100:50===o&&(r>0?e+=100:(n=e%1e3/100,n%2&&(e+=100))),e/a},ColorFromRGB:function(t,r,o,n){return n===e&&(n=1),u(t,r,o,n)}}}(),function(undefined){"use strict";function FixedText(e){this.text=e}var grenum=gr.enum_,grhelper=gr.helper,grformat=gr.format,grutility=gr.utility,ensureNameText=grhelper.ensureNameText,enumName2Value=grhelper.enumName2Value,enumValue2Name=grhelper.enumValue2Name,prototypeCopyExtend=grhelper.prototypeCopyExtend,grexp=gr.exp={},FIELD_LEFT_BRECKET="[#",FIELD_RIGHT_BRECKET="#]",FIELD_BRECKET_LEN=2,Summary=grexp.Summary=function(){};
Summary.prototype={init:function(e,t){var r=this;switch(e&&(r.paramExp=new Expression(r.report,e)),t&&(r.displayField=r.report.RunningFieldByName(t)),r.SummaryFun){case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 15:case 16:case 17:case 20:case 21:case 22:case 23:case 24:case 25:case 14:case 18:case 19:r.values=[]}},getAsFloat:function(){var e=this;return e.valueField?e.valueField.AsFloat:e.value},getValue:function(){return this.getAsFloat()},setValue:function(e){var t=this;t.valueField?t.valueField.AsFloat=e:t.value=e},getDisplayText:function(){return this.getValue()+""},isDateTimeValue:function(){var e=this;return e.argExp&&e.argExp.isSingleVariable()&&e.argExp.varItems[0].varField.isDateTimeValue()},beginSummaryValue:function(){var e=this;e.recordCount=0,4===e.SummaryFun||5===e.SummaryFun?e.value=null:27!==e.SummaryFun&&28!==e.SummaryFun&&(e.value=0),e.values&&(e.values=[])},summaryCurRecord:function(){var e,t=this;switch(++t.recordCount,t.SummaryFun){case 1:case 2:case 27:case 28:e=t.paramExp?t.paramExp.calculate():0,isNaN(e)||(t.value+=e);break;case 4:case 5:t.paramExp&&!t.paramExp.isNull()&&(e=t.Calculate(),null===t.value?t.value=e:(5===t.SummaryFun&&t.value<e||4===t.SummaryFun&&t.value>vl)&&(t.value=e,t.displayField&&(t.stringValue=t.displayField.DisplayText)));break;case 6:case 7:case 8:case 9:case 10:case 11:t.values.push_back(t.Calculate());break;case 12:case 13:t.paramExp&&t.paramExp.isNull()&&(t.value+=1);break;case 16:case 17:case 15:case 20:case 21:case 22:case 23:case 24:case 25:t.paramExp&&!t.paramExp.isNull()&&t.values.push(t.Calculate());break;case 14:t.paramExp&&t.values.push(t.paramExp.getTextForDistinct());break;case 19:t.paramExp&&(e=t.paramExp.getTextForDistinct(),0===t.value?t.value=e:t.value.localeCompare(e)<0&&(t.value=e));break;case 18:t.paramExp&&(e=t.paramExp.getTextForDistinct(),0===t.value?t.value=e:t.value.localeCompare(e)>0&&(t.value=e));break;case 26:t.value+=Math.abs(t.Calculate())}},endSummaryValue:function(){var e=this,t=e.values?e.values.length:0;switch(e.SummaryFun){case 2:e.recordCount>0?e.value/=e.recordCount:e.value=null;break;case 3:e.value=e.recordCount;break;case 6:case 20:e.value=t>1?e.devSq()/(t-1):null;break;case 7:case 21:e.value=t>1?e.devSq()/t:null;break;case 8:case 22:e.value=t>1?Math.sqrt(e.devSq()/(t-1)):null;break;case 9:case 23:e.value=t>1?Math.sqrt(e.devSq()/t):null;break;case 10:case 24:e.value=e.aveDev();break;case 11:case 25:e.value=e.devSq();break;case 16:case 17:if(e.values.sort(function(e,t){return e-t}),t<e.rankNo)return null;e.value=e.values[17===e.SummaryFun?t-e.rankNo:e.rankNo];break;case 13:e.value=e.recordCount-e.value;break;case 15:e.value=e.average();break;case 14:e.value=e.distinct()}},average:function(){var e=this,t=e.values.length,r=0;return e.values.forEach(function(e){r+=e}),t?r/t:null},aveDev:function(){var e=this,t=e.values.length,r=average(),o=0;return e.values.forEach(function(e){o+=Math.abs(e-r)}),t?o/t:null},devSq:function(){var e=(average(),0);return this.values.forEach(function(t){var r=t-ave;e+=r*r}),e},distinct:function(){var e,t,r=1,o=self.values.length,n=o;for(self.values.sort(function(e,t){return e.localeCompare(t)}),e=self.values[0];o>r;)t=self.values[r++],e===t?n--:e=t;return n}};var MemoTextSummaryFun=function(e,t,r){var o,n=this,a=r.split(",");n.report=e,n.SummaryFun=enumName2Value(grenum.SummaryFun,t),a.length>0&&(o=a[0]),a.length>1&&(n.RankNo=parseInt(a[1])),n.init(o)};MemoTextSummaryFun.prototype={type:4,getExpText:function(){var e=this;return enumValue2Name(grenum.SummaryFun,e.SummaryFun)+"("+e.paramExp?e.paramExp.getExpText():""+e.RankNo?","+e.RankNo:")"}},prototypeCopyExtend(MemoTextSummaryFun,Summary);var MemoTextSystemVar=function(e,t){var r=this,o=t.split(",");r["var"]=enumName2Value(grenum.SystemVarType,o[0]),o.length>1&&(r.groupIndex=parseInt(o[1])),r.report=e};MemoTextSystemVar.prototype={type:3,getAsFloat:function(){var e=this;return e.report.SystemVarValue2(e["var"],e.groupIndex)},getValue:function(){return this.getAsFloat()},getDisplayText:function(){return this.getAsFloat()+""},getExpText:function(){var e=this;return"SystemVar("+enumValue2Name(grenum.SystemVarType,e["var"])+e.groupIndex?","+e.groupIndex:")"},isDateTimeValue:function(){return 1===this["var"]}};var MemoTextParameter=function(e){this.oParameter=e};MemoTextParameter.prototype={type:2,getAsFloat:function(){return this.oParameter.AsFloat},getValue:function(){return this.oParameter.Value},getDisplayText:function(){var e=this;return e.valueField?e.valueField.DisplayText:e.oParameter.DisplayText},getExpText:function(){return ensureNameText(this.oParameter.Name)},isDateTimeValue:function(){return 6==this.oParameter.DataType}};var MemoTextField=function(e){this.object=e};MemoTextField.prototype={type:1,getAsFloat:function(){return this.object.AsFloat},getValue:function(){return this.object.Value},getDisplayText:function(){return this.object.DisplayText},getExpText:function(){return ensureNameText(this.object.Name)},isDateTimeValue:function(){return 6==this.object.FieldType}};var MemoTextTextControl=function(e){this.object=e};MemoTextTextControl.prototype={type:5,getAsFloat:function(){return parseFloat(this.object.DisplayText)},getValue:function(){return this.getDisplayText()},getDisplayText:function(){return this.object.DisplayText},getExpText:function(){return ensureNameText(this.object.Name)},isDateTimeValue:function(){return t0}};var VarItem=function(e,t,r){var o=this;o.varField=e,o.beginIndex=t,o.endIndex=r},ExpressionBase=function(e,t){function r(){for(u=c[n];C.test(u);)u=c[++n]}function o(e,r){var o=u===e;return o&&(n=t.indexOf(r,a),-1===n?g=!1:(d=t.substring(a+1,n),i=++n)),o}var n,a,i,l,s,u,c,d,p,h,f,m=this,g=!0,C=/\s/,x=/[\d.]/,y=/[()+-\/%*]/,T=/[()+-\/%*\s]/;for(c=t.split(""),s=c.length,m.expText=t,m.varItems=[],n=0;s>n&&g;)if(r(),y.test(u)||x.test(u))n++;else{if(a=n,o("{","}"))h=m.decodeVariable(e,d,1);else{if(!o("[","]")){for(;s>n&&!T.test(c[n]);)n++;i=n,d=t.substring(a,i)}if(r(),"("===u){for(l=++n,f=1;s>n;)if(u=c[n++],")"===u){if(f--,0>=f)break}else"("===u&&f++;p=t.substring(l,n-1),i=n,h=m.decodeFunction(e,d,p)}else h=m.decodeVariable(e,d,0)}h?m.varItems.push(new VarItem(h,a,i)):g=!1}m.valid=g};ExpressionBase.prototype={calculate:function(){var self=this,begin=0,realizedexp="value=",value=NaN;if(self.valid)try{self.varItems.forEach(function(e){begin<e.beginIndex&&(realizedexp+=self.expText.substring(begin,e.beginIndex)),begin=e.endIndex,realizedexp+=e.varField.getAsFloat()+""}),realizedexp+=self.expText.substring(begin),eval(realizedexp),(value>=Number.POSITIVE_INFINITY||value<=Number.NEGATIVE_INFINITY)&&(value=NaN)}catch(e){value=NaN}return value},isSingleVariable:function(){var e=this;return 1===e.varItems.length&&0===e.varItems[0].beginIndex&&e.varItems[0].endIndex===e.expText.length}};var Expression=grexp.Expression=function(e,t){ExpressionBase.call(this,e,t)};Expression.prototype={decodeVariable:function(e,t,r){var o,n=null;return r?(o=e.ParameterByName(t))&&(n=new MemoTextParameter(o)):(o=e.RunningFieldByName(t))?n=new MemoTextField(o):(o=e.ParameterByName(t))?n=new MemoTextParameter(o):(o=e.ControlByName(t))&&(n=new MemoTextTextControl(o)),n},decodeFunction:function(e,t,r){var o=new MemoTextSummaryFun(e,t,r);return o.SummaryFun<0&&("SystemVar"===t?(o=new MemoTextSystemVar(e,r),o["var"]<0&&(o=null)):o=null),o},getExpText:function(){var e=this,t=0,r="";return e.varItems.forEach(function(o){t<o.beginIndex&&(r+=e.expText.substring(t,o.beginIndex)),t=o.endIndex,r+=o.varField.getExpText()}),r+=e.expText.substring(t)},getTextForDistinct:function(){var e=this;return e.isSingleVariable()?varItems[0].getDisplayText():e.calculate()+""},isNull:function(){return this.varItems.some(function(e){return e.IsNull})}},prototypeCopyExtend(Expression,ExpressionBase);var TextExpression=function(e,t){var r,o,n,a=this,i=0,l="";for(r=t.indexOf(":");r>=0&&(o=t.indexOf("[",i),!(-1===o||o>r))&&(o=t.indexOf("]",r),-1!==o);)i=o+1,r=t.indexOf(":",i);r>=0&&(l=t.substring(r+1),t=t.substring(0,r)),ExpressionBase.call(a,e,t),!l&&a.isSingleVariable()||(n=a.isSingleVariable()&&a.varItems[0].varField.isDateTimeValue(),!n&&l&&(n=/[yMdthHms]/.test(l)&&!/[0#e$]/.test(l)),a.formater=n?new grformat.DateTimeFormatter(l):new grformat.NumericFormatter(l))};TextExpression.prototype={getDisplayText:function(){function e(e){return'"'+e.expText+'" 不是有效的运算表达式'}var t,r=this;return r.valid?r.formater?(t=r.isSingleVariable()?r.varItems[0].varField.getValue():r.calculate(),r.formater.format(t)):r.varItems[0].varField.getDisplayText():e(this)}},prototypeCopyExtend(TextExpression,ExpressionBase);var MemoTextExpression=function(e,t){TextExpression.call(this,e,t)};MemoTextExpression.prototype={decodeVariable:Expression.prototype.decodeVariable,decodeFunction:Expression.prototype.decodeFunction,isPureNumeric:function(){var e=this;return grformat.NumericFormatter.prototype.isPrototypeOf(e.formater)||e.isSingleVariable()&&!e.varItems[0].varField.isDateTimeValue()}},prototypeCopyExtend(MemoTextExpression,TextExpression);var ChartParameter=function(e){this.oParameter=e};ChartParameter.prototype={getAsFloat:function(){return this.oParameter.AsFloat},getValue:function(){return this.oParameter.Value},getDisplayText:function(){return this.oParameter.DisplayText},isDateTimeValue:function(){return 6==this.oParameter.DataType}};var ChartVarFun=function(e,t){var r=this;r.textBuilder=e,r.varType=t};ChartVarFun.prototype={getAsFloat:function(){function e(){var e,t,r=n.graphs,o=r.length;for(e=0;o>e&&(t=r[e],!t.some(function(e){return e===a}));e++);return t}var t,r=this,o=r.textBuilder,n=o.chart,a=o.seriesIndex,i=o.groupIndex;if(n.IsScatterGraph())switch(t=n.Value(a,i),r.varType){case 1:t=t.x;break;case 2:t=t.y;break;case 3:t=t.z;break;case 5:t=t.z/n.GetSeriesTotalValue(a);break;case 7:t=n.GetSeriesTotalValue(a)}else switch(t=n.Value(a,i),r.varType){case 4:t/=n.GetGroupTotalValue(e(),i);break;case 6:t=n.GetGroupTotalValue(e(),i);break;case 5:t/=n.GetSeriesTotalValue(a);break;case 7:Val=n.GetSeriesTotalValue(a)}return t},getValue:function(){return this.getAsFloat()},getDisplayText:function(){var e=this,t=e.varType,r=e.textBuilder,o=r.seriesIndex,n=r.groupIndex,a=r.chart,i=a.IsScatterGraph(),l=a.graphSerieses[o],s=e.getAsFloat(),u=0;if(i)switch(t){case 1:u=1;break;case 2:u=2;break;case 3:case 7:u=3;break;case 5:u=5;break;case 8:u=4}else switch(t){case 1:case 8:case 9:u=4;break;case 2:case 6:case 7:u=2;break;case 4:case 5:u=5}switch(u){case 1:s=a.XAxis.ScaleFormatParser.format(s);case 2:s=i?a.YAxisOfSeries(l).ScaleFormatParser.format(s):l.ValueFormatParser.format(s);break;case 3:s=l.ValueFormatParser.format(s);break;case 4:s=8===t?a.SeriesLabel(o):a.GroupLabel(n);break;case 5:s=grutility.NumberFormat(s,"0.00%")}return s},isDateTimeValue:function(){return 0}};var ChartTextExpression=grexp.ChartTextExpression=function(e,t){TextExpression.call(this,e,t)};ChartTextExpression.prototype={decodeVariable:function(e,t,r){var o=e.chart.report.ParameterByName(t);return o?new ChartParameter(o):null},decodeFunction:function(e,t,r){var o;return"chartvar"===t.toLowerCase()&&(r=enumName2Value(grenum.ChartVarType,r),r>0&&(o=new ChartVarFun(e,r))),o}},prototypeCopyExtend(ChartTextExpression,TextExpression),FixedText.prototype={getDisplayText:function(){return this.text}};var TextBuilder=grexp.TextBuilder=function(e,t){var r,o=this,n=e.XAxis?ChartTextExpression:MemoTextExpression,a=0,i=0,l=0;for(o.items=[],e.XAxis&&(o.chart=e,e=this);(i=t.indexOf(FIELD_LEFT_BRECKET,l))>=0;)l=t.indexOf(FIELD_RIGHT_BRECKET,i+FIELD_BRECKET_LEN),l>=0&&(r=new n(e,t.substring(i+FIELD_BRECKET_LEN,l)),l+=FIELD_BRECKET_LEN,r.valid&&(i>a&&o.items.push(new FixedText(t.substring(a,i))),a=l,o.items.push(r)),i=l);a<t.length&&o.items.push(new FixedText(t.substring(a)))};TextBuilder.prototype={forEach:function(e){this.items.forEach(e)},generateDisplayText:function(){var e="";return this.forEach(function(t){e+=t.getDisplayText()}),e},generateChartDisplayText:function(e,t){var r=this;return r.seriesIndex=e,r.groupIndex=t,r.generateDisplayText()},isStaticText:function(){var e=this;return 1==e.items.length&&FixedText.prototype.isPrototypeOf(e.items[0])}}}(),function(undefined){"use strict";function CrossColumnKindByOrderNoText(e){return e===csz_HTotal_Suffix?4:null===e?1:"_S"===e.substring(0,2)?3:2}function CrossSummaryGetFieldSuffix(e){switch(e){case 2:return csz_HAverage_Suffix;case 15:return csz_HAverageA_Suffix;case 3:return csz_HCount_Suffix;case 13:return csz_HCountA_Suffix;case 4:return csz_HMin_Suffix;case 5:return csz_HMax_Suffix}return""}function CalcPointMarkerRect(e,t,r){return new Rect(e-r,t-r,e+r,t+r)}gr.dom={};var grenum=gr.enum_,grconst=gr.const_,grhelper=gr.helper,grformat=gr.format,grexp=gr.exp,assignJSONMembers=grhelper.assignJSONMembers,enumMemberValid=grhelper.enumMemberValid,enumBitMemberValid=grhelper.enumBitMemberValid,colorMemberValid=grhelper.colorMemberValid,fontString=grhelper.fontString,fontHeight=grhelper.fontHeight,intFixed=grhelper.intFixed,pixelsToHtml=grhelper.pixelsToHtml,percentToHtml=grhelper.percentToHtml,confirmDateValue=grhelper.confirmDateValue,cloneDate=grhelper.cloneDate,strimDate=grhelper.strimDate,incDate=grhelper.incDate,incDate2=grhelper.incDate2,confirmBooleanValue=grhelper.confirmBooleanValue,ensureNameText=grhelper.ensureNameText,enumName2Value=grhelper.enumName2Value,enumValue2Name=grhelper.enumValue2Name,rgba2color=grhelper.rgba2color,colorAlpha=grhelper.colorAlpha,color2rgba=grhelper.color2rgba,colorValue2Html=grhelper.colorValue2Html,prototypeLinkExtend=grhelper.prototypeLinkExtend,prototypeCopyExtend=grhelper.prototypeCopyExtend,createArray=grhelper.createArray,assignObjectEx=grhelper.assignObjectEx,assignObject=grhelper.assignObject,assignObjectAtom=grhelper.assignObjectAtom,parseXML=grhelper.parseXML,getRelativePosition=grhelper.getRelativePosition,addEvent=grhelper.addEvent,bindEvents=grhelper.bindEvents,toDegree=grhelper.toDegree,toRadians=grhelper.toRadians,grcommon=gr.common,Summary=grexp.Summary,DateTime=grcommon.DateTime,Rect=grcommon.Rect,Pen=grcommon.Pen,Border=grcommon.Border,Font=grcommon.Font,FontWrapper=grcommon.FontWrapper,TextFormat=grcommon.TextFormat,Context=grcommon.Context,HtmlStyles=grcommon.HtmlStyles,HtmlElement=grcommon.HtmlElement,uidCanvas=function(){var e=0;return function(){return"-gr-canvas-"+e++}}(),calcSectionsPercentWidth=function(e){var t=0,r=0;e.length&&(e.forEach(function(e){t+=e.pxHeight}),e.forEach(function(e){e.pctHeight=Math.round(100*e.pxHeight/t),r+=e.pctHeight}),e[0].pctHeight+=100-r)},Collection=function(e){var t=this;t.owner=e,t.items=[]};Collection.prototype={loadFromJSON:function(e){var t;if(e)for(var t=0,r=e.length;r>t;)this._doloadItem(e[t++])},assign:function(e){var t=this;t.RemoveAll(),e.forEach(function(e){t.Add().assign(e)})},prepare:function(){for(var e=this.items,t=e.length;t--;)e[t].prepare()},unprepare:function(){for(var e=this.items,t=e.length;t--;)e[t].unprepare()},generate:function(e){for(var t=this.items,r=0,o=t.length;o>r;)t[r++].generate(e)},itemByName:function(e){var t,r,o=this.items;if(e)for(t=o.length;t--;)if(r=o[t],r.Name===e)return r},indexOfCOMIndex:function(e){return e?("number"!=typeof e&&(e=this.IndexByName(e||"")),--e):e=-1,e},indexOf:function(e){for(var t=this.items,r=t.length;r--;)if(e===t[r])return r;return-1},decodeItems:function(e){var t,r=this,o=[];return e&&(t=e.split(";"),t.forEach(function(e){var t;e=e.trim(),t=r.itemByName(e),t&&o.push(t)})),o},forEach:function(e){this.items.forEach(e)},_doloadItem:function(e){this.Add().loadFromJSON(e)},get Count(){return this.items.length},Item:function(e){var t=this;return t.items[t.indexOfCOMIndex(e)]},Add:function(){var e=this,t=e._createItem();return e.items.push(t),t},Remove:function(e){var t=this;e=t.indexOfCOMIndex(e),e>=0&&t.items.splice(e,1)},RemoveAll:function(){this.items=[]},IndexByName:function(e){var t=this.items,r=t.length;if(e)for(;r--;)if(t[r].Name===e)return r+1;return-1},ItemAt:function(e){var t=this.items;return e--,e>=0&&e<t.length?t[e]:null},ChangeItemOrder:function(e,t){var r=this.items;if(o,len=r.length,t=Math.max(1,Math.min(len,t))-1,e!=t&&e>0&&e<=len)if(e-=1,o=r[e],t>e){do r[e]=r[e+1];while(++e<t)}else{do r[e]=r[e-1];while(--e>t);r[t]=o}}};var Controls=function(e){Collection.call(this,e)};Controls.prototype={_doloadItem:function(e){var t=this.Add(enumName2Value(grenum.ControlType,e.Type));t&&t.loadFromJSON(e)},assign:function(e){var t=this;t.RemoveAll(),e.forEach(function(e){t.Add(e.ControlType).assign(e)})},prepare:function(){for(var e,t=this,r=t.owner,o=t.items,n=r.isSingleDockControl&&r.isSingleDockControl()?0:t.owner.getRect(),a=0,i=o.length;i>a;)e=o[a++],e.prepare(),n&&e.layout(n)},generate:function(e){for(var t,r=this.items,o=r.length;o--;)t=r[o],t.Visible&&t.generate(e)},attachData:function(){for(var e=this.items,t=e.length;t--;)e[t].attachData()},Add:function(e){function t(e,t){var r=null;switch(e){case 1:r=new StaticBox(t);break;case 2:r=new ShapeBox(t);break;case 10:r=new Line(t);break;case 3:r=new SystemVarBox(t);break;case 4:r=new FieldBox(t);break;case 5:r=new SummaryBox(t);break;case 7:r=new PictureBox(t);break;case 8:r=new MemoBox(t);break;case 9:r=new SubReport(t);break;case 11:r=new Chart(t);break;case 12:r=new Barcode(t);break;case 13:r=new FreeGrid(t)}return r}var r=this,o=t(e,r.owner);return o&&r.items.push(o),o}},prototypeLinkExtend(Controls,Collection);var Columns=function(e){Collection.call(this,e)};Columns.prototype={_doloadItem:function(e){var t=this;t.items.push(new Column(t.owner).loadFromJSON(e))},addTo:function(e){var t,r,o=this,n=o.owner.ColumnContent.ContentCells,a=new Column(o.owner);return o.items.push(a),t=new ColumnTitleCell(e,!1),e.items.push(t),a.TitleCell=t,t.Column=a,r=new ColumnContentCell(n),n.items.push(r),a.ContentCell=r,r.Column=a,a},Add:function(){return this.addTo(self.owner.ColumnTitle.TitleCells)},Remove:function(e){function t(e,r){var o,n,a=e.indexOf(e);if(a>=0)return e.splice(a,1),1;for(a=e.length,n=0;a>n;n++)if(o=e[n],o.GroupTitle&&t(o.SubTitles.items,r))return 1;return 0}var r,o=this,n=o.owner,a=n.ColumnContent.ContentCells.items;e=o.indexOfCOMIndex(e),e>=0&&(r=o.items[e],a.splice(a.indexOf(r.ContentCell),1),t(n.ColumnTitle.TitleCells.items,r.TitleCell),o.items.splice(e,1))},RemoveAll:function(){var e=this,t=e.owner;e.items=[],t.ColumnContent.ContentCells.items=[],t.ColumnTitle.TitleCells.items=[]}},prototypeLinkExtend(Columns,Collection);var ColumnTitleCells=function(e,t){var r=this;Collection.call(r,e),r.supcell=t};ColumnTitleCells.prototype={_doloadItem:function(e){var t=this;t.items.push(new ColumnTitleCell(t,e.GroupTitle).loadFromJSON(e))},assign:function(e){var t=this;t.items=[],e.forEach(function(e){var r=new ColumnTitleCell(t,e.GroupTitle);t.items.push(r),r.assign(e),e.GroupTitle&&r.SubTitles.assign(e.SubTitles)})},AddGroup:function(e,t){var r=this,o=new ColumnTitleCell(r,!0);return o.Name=e,o.Text=t,r.items.push(o),o},RemoveGroup:function(e){},Add:function(){},Remove:function(e){},RemoveAll:function(){}},prototypeLinkExtend(ColumnTitleCells,Collection);var ColumnContentCells=function(e){Collection.call(this,e)};ColumnContentCells.prototype={_doloadItem:function(e){var t=this;t.items.push(new ColumnContentCell(t).loadFromJSON(e))},assign:function(e){var t=this;t.items=[],e.forEach(function(e){var r=new ColumnContentCell(t);t.items.push(r),r.assign(e)})},Add:function(){},ChangeItemOrder:function(e,t){},Remove:function(e){},RemoveAll:function(){}},prototypeLinkExtend(ColumnContentCells,Collection);var Fields=function(e){Collection.call(this,e)};Fields.prototype._createItem=function(){return new Field(this.owner)},prototypeLinkExtend(Fields,Collection);var Groups=function(e){Collection.call(this,e)};Groups.prototype={_createItem:function(){return new Group(this.owner)},_doloadItem:function(e){e.PageGroup||this.Add().loadFromJSON(e)}},prototypeLinkExtend(Groups,Collection);var ReportHeaders=function(e){Collection.call(this,e)};ReportHeaders.prototype._createItem=function(){return new ReportHeader(this.owner)},prototypeLinkExtend(ReportHeaders,Collection);var ReportFooters=function(e){Collection.call(this,e)};ReportFooters.prototype._createItem=function(){return new ReportFooter(this.owner)},prototypeLinkExtend(ReportFooters,Collection);var Parameters=function(e){Collection.call(this,e)};Parameters.prototype._createItem=function(){return new Parameter(this.owner)},prototypeLinkExtend(Parameters,Collection);var Object=function(e){var t=this;t.owner=e,t.report=e.report,t.Tag=""};Object.prototype={afterLoad:function(e){},loadFromJSON:function(e){var t=this;return e&&(assignJSONMembers(t,e),t.afterLoad(e)),t},assign:function(e){var t,r,o=this;for(var n in e)o.hasOwnProperty(n)&&(t=e[n],r=typeof t,"object"!==r&&"array"!==r&&(o[n]=t));o.Font&&o.Font.assign(e.Font),o.children&&o.children.forEach(function(t){var r=e[t];r&&(r.owner?o[t].assign(r):assignObject(o[t],r))})},getUsingFont:function(){return this.Font.UsingFont()},toFillBack:function(){var e=this;return e.BackColor!==e.owner.BackColor}};var CellBase=function(e){var t=this;Object.call(t,e),t.BorderCustom=!1,t.BackColor=e.BackColor,t.CanGrow=!1,t.CanShrink=!1,t.Font=new FontWrapper(e.Font),t.FreeCell=!0,t.setFreeCell(!1)};CellBase.prototype={loadFromJSON:function(e){var t=this;return e&&(t.setFreeCell(!!e.FreeCell),assignJSONMembers(t,e),t.afterLoad(e)),t},afterLoad:function(e){var t=this;colorMemberValid(t,"BackColor",t.report.viewer.alpha.background),colorMemberValid(t,"ForeColor",t.report.viewer.alpha.text),t.Font.loadFromJSON(e.Font),t.BorderCustom&&(t.Border=new Border(12),t.Border.loadFromJSON(e.Border,t.report.viewer.alpha.border)),e.FreeCell?t.Controls.loadFromJSON(e.Control):t.TextFormat.loadFromJSON(e)},assign:function(e){var t=this;t.setFreeCell(e.FreeCell),Object.prototype.assign.call(t,e),t.Font.assign(e.Font),e.Border&&(t.Border=new Border(0),assignObject(t.Border,e.Border)),e.FreeCell?t.Controls.assign(e.Controls):assignObject(t.TextFormat,e.TextFormat)},attachControlsData:function(){var e=this;e.FreeCell?e.Controls.attachData():e._getWrapperClass().attachData.call(e)},prepare:function(){var e=this,t=e.report.viewer,r=e.Font.font;e.FreeCell&&(e.Controls.prepare(),e.isSingleDockControl()||2!==t.options.controlPosition&&Section.prototype.buildTableLayout.call(e,NaN,NaN)),r&&(e.defaultFontStyle=t.selectFontItem(r)),e.tableRows&&e.tableRows.forEach(function(e){e.defaultStyle=t.selectSectionItem(e)}),e.defaultStyle=t.selectCellItem(e)},unprepare:function(){var e=this;e.FreeCell?e.Controls.unprepare():e._getWrapperClass().unprepare.call(e),delete e.defaultFontStyle,delete e.defaultStyle},generate:function(e){var t=this;e=new HtmlElement(t.htmlTag,e),t.generateContent(e)},generateContent:function(e){var t=this,r=t.report.viewer,o=t.Font.font;e.addClass(r.selectCell(t)),o&&e.addClass(r.selectFont(o,t.defaultFontStyle)),t.addStyles&&t.addStyles(e),t.FreeCell?t.isSingleDockControl()?t.Controls.items[0].generateInCell(e):t.tableRows?(e.addStyle("padding","0px"),e=new HtmlElement("table",e),e.addStyle("border-collapse","collapse"),Section.prototype.generateTableRows.call(t,e)):(e.addStyle("position","relative"),t.Controls.generate(e)):t._getWrapperClass().generateInCell.call(t,e)},setFreeCell:function(e){var t,r=this;r.FreeCell!==e&&(r.FreeCell=e,e?(r.Controls=new Controls(r),delete r.ControlType):(t=r._getWrapperClass(),t.createWrapper.call(r),r.ControlType=t.ControlType,delete r.Controls))},setForeColor:function(e){var t=this;t.FreeCell?t.Controls.forEach(function(t){t.ForeColor=e}):t.ForeColor=e},getDisplayText:function(){var e=this;return e._getWrapperClass().getDisplayText.call(e)},getControls:function(){var e=this;return e.FreeCell?e.Controls.items:[e]},isSingleDockControl:function(){var e=this.Controls.items;return 1===e.length&&5===e[0].Dock},isControlPositionClass:function(){return 0},_getDisplayText:function(){var e=this;return e._getWrapperClass()._getDisplayText.call(e)}},prototypeCopyExtend(CellBase,Object);var FreeGridCell=function(e,t,r){var o=this;CellBase.call(o,e),o.row=t,o.col=r,o.ColSpan=1,o.RowSpan=1,o.DataName=""};FreeGridCell.prototype={generate:function(e){var t=this;e=new HtmlElement("td",e),t.ColSpan>1&&e.addAttribute("colspan",t.ColSpan+""),t.RowSpan>1&&e.addAttribute("rowspan",t.RowSpan+""),t.generateContent(e)},getOwnerGrid:function(){return this.owner},_getWrapperClass:function(){return MemoBox.prototype},getRect:function(){for(var e=this,t=e.owner,r=e.col,o=e.row,n=r+e.ColSpan,a=o+e.RowSpan,i=0,l=0;n>r;)i+=t.columns[r++].pxWidth;for(;a>o;)l+=t.rows[o++].pxHeight;return new Rect(0,0,i,l)}},prototypeCopyExtend(FreeGridCell,CellBase);var ColumnCell=function(e){var t=this;CellBase.call(t,e),t.Column=""};ColumnCell.prototype={afterLoad:function(e){var t=this;CellBase.prototype.afterLoad.call(t,e),t.Column=t.owner.owner.Columns.itemByName(t.Column)},getOwnerGrid:function(){return this.owner.owner}},prototypeCopyExtend(ColumnCell,CellBase);var ColumnContentCell=function(e){ColumnCell.call(this,e.owner)};ColumnContentCell.prototype={htmlTag:"td",_getWrapperClass:function(){return FieldBox.prototype},afterLoad:function(e){var t=this;ColumnCell.prototype.afterLoad.call(t,e),t.Column.ContentCell=t},isControlPositionClass:function(){return this.FreeCell},get Name(){return this.Column.Name},set Name(e){this.Column.Name=e},getRect:function(){var e=this;return new Rect(0,0,e.Column.pxWidth,e.owner.pxHeight)}},prototypeCopyExtend(ColumnContentCell,ColumnCell);var ColumnTitleCell=function(e,t){var r=this;ColumnCell.call(r,e.owner),r.SupCell=e.supcell,r.Visible=!0,r.GroupTitle=t,t&&(r._name="",r.SubTitles=new ColumnTitleCells(r.owner,r))};ColumnTitleCell.prototype={htmlTag:"th",_getWrapperClass:function(){return MemoBox.prototype},afterLoad:function(e){var t=this;ColumnCell.prototype.afterLoad.call(t,e),t.GroupTitle?(t._name=e.Name,t.SubTitles.loadFromJSON(e.ColumnTitleCell)):t.Column.TitleCell=t},assign:function(e){var t=this;ColumnCell.prototype.assign.call(t,e),t.GroupTitle&&t.SubTitles.assign(e.SubTitles)},prepare:function(){var e=this;ColumnCell.prototype.prepare.call(e),e.SubTitles&&e.SubTitles.prepare()},addStyles:function(e){var t=this,r=t.GroupTitle?1:t.owner.layerCount-t.owner.generatingLayer;t.colspan>1&&e.addAttribute("colspan",t.colspan+""),r>1&&e.addAttribute("rowspan",r+"")},findFirstColumn:function(){var e=this;return e.GroupTitle?e.SubTitles.items[0].findFirstColumn():e.Column},findLastColumn:function(){var e,t=this,r=t.Column;return t.GroupTitle&&(e=t.SubTitles.items,r=e[e.length-1].findLastColumn()),r},encloseColumnObject:function(e){var t=this;t.owner.owner.MoveColumnTo(e,t)},get Name(){var e=this;return e.GroupTitle?e._name:e.Column.Name},set Name(e){var t=this;t.GroupTitle?t._name=e:t.Column.Name=e},getRect:function(){var e=this,t=e.GroupTitle?1:e.owner.layerCount-e.layer,r=e.GroupTitle?e.Column.pxWidth:e.findLastColumn().pxRight-e.findFirstColumn().pxLeft;return new Rect(0,0,r,e.owner.pxHeight*t)},EncloseColumn:function(e){var t=this;t.owner.owner.ColumnMoveTo(ColumnIndex,t)},AddSubGroupTitle:function(e,t){return this.SubTitles.AddGroup(e,t)}},prototypeCopyExtend(ColumnTitleCell,ColumnCell);var Control=function(e){var t=this;Object.call(t,e),t.Left=0,t.Top=0,t.Width=0,t.Height=0,t.Anchor=3,t.Dock=0,t.Center=0,t.AlignColumnSide=3,t.AlignColumn="",t.AlignColumnEx="",t.Locked=!1,t.ShiftMode=1,t.PaddingLeft=0,t.PaddingRight=0,t.PaddingTop=0,t.PaddingBottom=0,t.BackColor=e.BackColor,t.BackStyle=2,t.ForeColor=e.ForeColor?e.ForeColor:colorAlpha(0,t.report.viewer.alpha.text),t.Visible=!0,t.Border=new Border(0),t.Font=new FontWrapper(e.Font),t.Name=""};Control.prototype={children:["Border"],attachData:function(){},afterLoad:function(e){var t=this;enumMemberValid(t,"Dock",grenum.DockStyle),enumMemberValid(t,"Center",grenum.CenterStyle),enumMemberValid(t,"AlignColumnSide",grenum.AlignColumnSideStyle),enumMemberValid(t,"ShiftMode",grenum.ShiftMode),enumMemberValid(t,"BackStyle",grenum.BackStyle),enumBitMemberValid(t,"Anchor",grenum.AnchorStyle),colorMemberValid(t,"BackColor",t.report.viewer.alpha.background),colorMemberValid(t,"ForeColor",t.report.viewer.alpha.text),t.Font.loadFromJSON(e.Font),t.Border.loadFromJSON(e.Border,t.report.viewer.alpha.border)},layout:function(e){var t,r=this,o=r.report,n=o.size2Pixel(r.Width),a=o.size2Pixel(r.Height),i=new Rect(o.size2Pixel(r.Left),o.size2Pixel(r.Top),n,a),l=o.getRunningColumnByName(r.AlignColumn),s=o.getRunningColumnByName(r.AlignColumnEx);if(i.right+=i.left,i.bottom+=i.top,l&&!l.Visible&&(l=null),s&&!s.Visible&&(s=null),l||s)switch(l&&s?s.pxLeft<l.pxLeft&&(t=s,s=l,l=t):s?l=s:s=l,r.AlignColumnSide){case 1:i.left=l.pxLeft,i.right=i.left+n;break;case 2:i.right=s.pxRight,i.left=i.right-n;break;default:i.left=l.pxLeft,i.right=s.pxRight}else{if(0!==r.Dock)switch(i=e.clone(),r.Dock){case 5:e.left=e.right,e.top=e.bottom;break;case 1:i.right=Math.min(e.right,e.left+n),e.left=i.right;break;case 2:i.bottom=Math.min(e.bottom,e.top+a),e.top=i.bottom;break;case 3:i.left=Math.max(e.left,e.right-n),e.right=i.left;break;case 4:i.top=Math.max(e.top,e.bottom-a),e.bottom=i.top}0!==r.Center&&5!==r.Dock&&(1!==r.Center&&3!==r.Center||(n=i.Width(),i.left=(e.left+e.right-n)/2,i.right=i.left+n),2!=r.Center&&3!=r.Center||(a=i.Height(),i.top=(e.top+e.bottom-a)/2,i.bottom=i.top+a))}r.pxRect=i},prepare:function(){var e=this,t=e.report.viewer,r=!e.owner.isSingleDockControl;e.defaultStyle=t.selectControlItem(e),e.Font.font&&(e.defaultFontStyle=t.selectFontItem(e.Font.font)),r&&e.owner.isControlPositionClass()&&(e.defaultPositionStyle=t.selectPositionItem(e))},unprepare:function(){var e=this;delete e.defaultStyle,delete e.defaultFontStyle,delete e.defaultPositionStyle},generate:function(e){var t,r=this,o=r.report.viewer,n=r.pxRect;r.Visible&&(t=new HtmlElement("span",e),t.addClass(o.selectControl(r)),r.Font.font&&t.addClass(o.selectFont(r.Font.font,r.defaultFontStyle)),r.defaultPositionStyle?t.addClass(o.selectPosition(r)):(t.addStyle("left",pixelsToHtml(n.left)),t.addStyle("top",pixelsToHtml(n.top)),t.addStyle("width",pixelsToHtml(r.getContentWidth())),t.addStyle("height",pixelsToHtml(r.getContentHeight()))),r.generateContent(t))},toFillBack:function(){var e=this;return 1===e.BackStyle&&e.BackColor!==e.owner.BackColor},getContentWidth:function(){var e=this;return e.pxRect.Width()-e.PaddingLeft-e.PaddingRight-e.Border.getLeftWidth()-e.Border.getRightWidth()},getContentHeight:function(){var e=this;return e.pxRect.Height()-e.PaddingTop-e.PaddingBottom-e.Border.getTopWidth()-e.Border.getBottomWidth()}},prototypeCopyExtend(Control,Object);var TextBox=function(e){var t=this;Control.call(t,e),t.createWrapper(),t.AsTextBox=t};TextBox.prototype={children:["Border","TextFormat"],afterLoad:function(e){var t=this;Control.prototype.afterLoad.call(t,e),t.TextFormat.loadFromJSON(e)},createWrapper:function(){var e=this;e.PaddingLeft=2,e.PaddingRight=1,e.PaddingTop=1,e.PaddingBottom=1,e.CanGrow=!1,e.CanShrink=!1,e.ShrinkFontToFit=!1,e.ForeColor=e.owner.ForeColor?e.owner.ForeColor:colorAlpha(0,e.report.viewer.alpha.text),e.TextFormat=new TextFormat,e.GetDisplayTextScript=""},generateContent:function(e){var t=this;16&t.TextFormat.TextAlign||(t.TextFormat.WordWrap||64&t.TextFormat.TextAlign?(e.addStyle("display","table"),e=new HtmlElement("span",e),e.addStyle("display","table-cell"),e.addStyle("vertical-align",32&t.TextFormat.TextAlign?"middle":"bottom")):e.addStyle("line-height",pixelsToHtml(t.getContentHeight()))),t.generateInCell(e)},generateInCell:function(e){var t="<br />",r=this.getDisplayText();/[\r\n &<>"]/.test(r)&&(r=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/"/g,"&quot;").replace(/\r\n/g,t).replace(/\r/g,t).replace(/\n/g,t)),e.innerText=r},getDisplayText:function(){var e=this;return e.displayTextAssigned=!1,e.doingGetDisplayText||(e.doingGetDisplayText=!0,e.report.fireTextBoxGetDisplayText(e),e.doingGetDisplayText=!1),e.displayTextAssigned?e.assignedDisplayText:e._getDisplayText()},setDisplayText:function(e){var t=this;t.assignedDisplayText=e,
t.displayTextAssigned=!0}},prototypeCopyExtend(TextBox,Control);var StaticBox=function(e){var t=this;TextBox.call(t,e),t.Text="",t.Parameter=""};StaticBox.prototype={ControlType:1,_getDisplayText:function(){var e=this;return e.valueField?e.valueField.DisplayText:e.oParameter?e.oParameter.DisplayText:e.Text},attachData:function(){var e=this;e.Parameter&&(e.oParameter=e.report.ParameterByName(e.Parameter))},unprepare:function(){var e=this;TextBox.prototype.unprepare.call(e),delete e.oParameter},get DisplayText(){return this.getDisplayText()},set DisplayText(e){this.setDisplayText(e)},get AsStaticBox(){return this}},prototypeCopyExtend(StaticBox,TextBox);var MemoBox=function(e){var t=this;TextBox.call(t,e),t.Text=""};MemoBox.prototype={ControlType:8,createWrapper:function(){var e=this;TextBox.prototype.createWrapper.call(e),e.Text=""},_getDisplayText:function(){return this.textBuilder.generateDisplayText()},attachData:function(){var e=this;e.textBuilder=new grexp.TextBuilder(e.report,e.Text)},getSummaryExpFields:function(){var e=[];return this.textBuilder.forEach(function(t){t.varItems&&t.varItems.forEach(function(t){4===t.varField.type&&e.push(t.varField)})}),e},getParameterExpFields:function(){var e=[];return this.textBuilder.forEach(function(t){t.varItems&&t.varItems.forEach(function(t){2===t.varField.type&&e.push(t.varField)})}),e},isPureNumericExpression:function(){var e=this;return e.prepare(),e.textBuilder&&1===e.textBuilder.items.length&&e.textBuilder.items[0].isPureNumeric()},get DisplayText(){return this.getDisplayText()},set DisplayText(e){this.setDisplayText(e)},get AsFloat(){var e=this.textBuilder.items[0].calculate();return isNaN(e)?0:e},get Value(){return this.getDisplayText()},get AsMemoBox(){return this}},prototypeCopyExtend(MemoBox,TextBox);var FieldBox=function(e){var t=this;TextBox.call(t,e),t.DataField=""};FieldBox.prototype={ControlType:4,createWrapper:function(){var e=this;TextBox.prototype.createWrapper.call(e),e.DataField=""},attachData:function(){var e=this;e.oDataField=e.report.RunningFieldByName(e.DataField)},unprepare:function(){var e=this;TextBox.prototype.unprepare.call(e),delete e.oDataField},_getDisplayText:function(){var e=this.oDataField;return e?e.DisplayText:""},get DisplayText(){return this.getDisplayText()},set DisplayText(e){this.setDisplayText(e)},get AsFieldBox(){return this}},prototypeCopyExtend(FieldBox,TextBox);var SummaryBox=function(e){var t=this;TextBox.call(t,e),t.SummaryFun=1,t.RankNo=1,t.DataField="",t.DisplayField="",t.Format=""};SummaryBox.prototype={ControlType:5,afterLoad:function(e){var t=this;TextBox.prototype.afterLoad.call(t,e),enumMemberValid(t,"SummaryFun",grenum.SummaryFun)},attachData:function(){var e,t,r=this,o=r.Format;r.init(r.DataField,r.DisplayField),o||(e=r.report.RunningFieldByName(r.DataField),e&&(o=e.Format)),t=r.paramExp,t&&1===t.varItems.length&&1===t.varItems[0].type&&6===t.varItems[0].object.FieldType?r.formater=new grformat.DateTimeFormatter(o):r.formater=new grformat.NumericFormatter(o)},_getDisplayText:function(){var e,t=this,r=t.valueField;if(18===t.SummaryFun||19===t.SummaryFun||t.displayFieldObject)e=r?r.DisplayText:t.stringValue;else{if(r){if(r.IsNull)return"";e=r.AsFloat}else e=t.Value;e=t.formater.format(e)}return e},get DisplayText(){return this.getDisplayText()},set DisplayText(e){this.setDisplayText(e)},get Value(){return this.getValue()},set Value(e){this.setValue(e)},get AsSummaryBox(){return this}},prototypeCopyExtend(SummaryBox,TextBox),prototypeCopyExtend(SummaryBox,Summary);var SystemVarBox=function(e){var t=this;TextBox.call(t,e),t.SystemVar=1,t.GroupIndex=1,t.Format=""};SystemVarBox.prototype={ControlType:3,afterLoad:function(e){var t=this;TextBox.prototype.afterLoad.call(t,e),enumMemberValid(t,"SystemVar",grenum.SystemVarType)},attachData:function(){var e=this;1===e.SystemVar?e.formater=new grformat.DateTimeFormatter(e.Format):e.formater=new grformat.NumericFormatter(e.Format)},_getDisplayText:function(){var e=this;return e.formater.format(e.report.SystemVarValue2(e.SystemVar,e.GroupIndex))},get DisplayText(){return this.getDisplayText()},set DisplayText(e){this.setDisplayText(e)},get AsSystemVarBox(){return this}},prototypeCopyExtend(SystemVarBox,TextBox);var Line=function(e){var t=this;Control.call(t,e),t.L2R=!0,t.U2D=!0,t.LinePen=new Pen};Line.prototype={ControlType:10,children:["LinePen"],afterLoad:function(e){var t=this;Control.prototype.afterLoad.call(t,e),t.LinePen.loadFromJSON(e.Pen,t.report.viewer.alpha.stroke)},generateContent:function(e){var t=this;t.report.registerCanvas(t,e)},generateInCell:function(e){this.generateContent(e)},draw:function(e){var t,r=this,o=r.canvas,n=new Context(o.getContext("2d")),a=0,i=0,l=o.width,s=o.height;n.SelectPen(r.LinePen),r.L2R||(t=a,a=l,l=t),r.U2D||(t=i,i=s,s=t),n.drawLine(a,i,l,s)},get AsLine(){return this}},prototypeCopyExtend(Line,Control);var ShapeBox=function(e){var t=this;Control.call(t,e),t.ShapeType=4,t.FillColor=0,t.FillStyle=2,t.CornerDx=4,t.CornerDy=4,t.LinePen=new Pen};ShapeBox.prototype={ControlType:2,children:["LinePen"],afterLoad:function(e){var t=this;Control.prototype.afterLoad.call(t,e),enumMemberValid(t,"ShapeType",grenum.ShapeBoxType),enumMemberValid(t,"FillStyle",grenum.BackStyle),colorMemberValid(t,"FillColor",t.report.viewer.alpha.background),t.LinePen.loadFromJSON(e.Pen,t.report.viewer.alpha.stroke)},generateContent:function(e){var t=this;t.report.registerCanvas(t,e)},generateInCell:function(e){this.generateContent(e)},draw:function(e){var t,r,o,n=this,a=n.canvas,i=a.width,l=a.height,s=new Context(a.getContext("2d")),u=n.LinePen.Width/2,c=1===n.FillStyle;switch(s.SelectPen(n.LinePen),c&&s.setFillColor(n.FillColor),n.ShapeType){case 7:s.drawLine(0,u,i,u);break;case 1:t=s.circle;break;case 2:t=s.ellipse;break;case 3:t=s.rectangle;break;case 6:t=s.square;break;case 4:t=s.roundRectangle,r=1;break;case 5:t=s.roundSquare,r=1}t&&(o=[u,u,i-2*u,l-2*u],r&&o.push(n.CornerDx,n.CornerDy),o.push(c),t.apply(s,o)),c&&s.resetFillStyle(),s.RestorePen()},get AsShapeBox(){return this}},prototypeCopyExtend(ShapeBox,Control);var PictureBox=function(e){var t=this;Control.call(t,e),t.SizeMode=3,t.TransparentMode=0,t.RotateMode=0,t.ImageIndex=0,t.Picture="",t.ImageFile="",t.DataField=""};PictureBox.prototype={ControlType:7,afterLoad:function(e){var t=this;Control.prototype.afterLoad.call(t,e),enumMemberValid(t,"SizeMode",grenum.PictureSizeMode),enumMemberValid(t,"TransparentMode",grenum.PictureTransparentMode),enumMemberValid(t,"RotateMode",grenum.PictureRotateMode)},attachData:function(){var e=this;e.oDataField=e.report.RunningFieldByName(e.DataField)},generateContent:function(e){var t,r,o,n,a,i,l,s,u,c=this;c.Picture?a="data:image;base64,"+c.Picture:c.oDataField?(a=c.oDataField.AsString,a.length>256&&(a="data:image;base64,"+a)):c.ImageFile&&(a=c.ImageFile),a&&(5===c.SizeMode?e.addStyle("background-image","url("+a+")"):(e.addStyle("text-align","center"),e.addStyle("vertical-align","middle"),i=new HtmlElement("img",e),2===c.SizeMode?(l="100%",s="100%"):(u=document.createElement("img"),u.src=a,r=c.pxRect,r?(o=r.Width(),n=r.Height()):(t=c.owner.getRect(),o=t.Width(),n=t.Height()),3===c.SizeMode||u.width>o||u.height>n?u.width*n>o*u.height?l="100%":s="100%":u.width&&u.height?(l=u.width+"",s=u.height+""):(l="100%",s="100%")),l&&i.addStyle("width",l),s&&i.addStyle("height",s),i.addAttribute("src",a)))},generateInCell:function(e){this.generateContent(e)},set Text(e){this[e.length>256?"Picture":"ImageFile"]=e},get AsPictureBox(){return this},LoadFromFile:function(e){this.ImageFile=e}},prototypeCopyExtend(PictureBox,Control);var Barcode=function(e){var t=this;Control.call(t,e),t.Text="",t.BarcodeType=4,t.BarWidth=0,t.BarRatio=2,t.CheckSum=!1,t.Direction=1,t.Alignment=2,t.CaptionPosition=3,t.CaptionAlignment=2,t.PDF417Rows=0,t.PDF417Columns=0,t.PDF417ErrorLevel=0,t.PDF417Simple=!1,t.QRCodeVersion=0,t.QRCodeErrorLevel=1,t.QRCodeMask=0,t.DtmxEncoding=2,t.DtmxMatrixSize=2,t.DtmxModuleSize=0};Barcode.prototype={ControlType:12,attachData:function(){var e=this;e.textBuilder=new grexp.TextBuilder(e.report,e.Text)},afterLoad:function(e){var t=this;Control.prototype.afterLoad.call(t,e),enumMemberValid(t,"BarcodeType",grenum.BarcodeType),enumMemberValid(t,"Direction",grenum.BarcodeDirection),enumMemberValid(t,"Alignment",grenum.StringAlignment),enumMemberValid(t,"CaptionPosition",grenum.BarcodeCaptionPosition),enumMemberValid(t,"CaptionAlignment",grenum.StringAlignment),enumMemberValid(t,"DtmxEncoding",grenum.DtmxEncoding),enumMemberValid(t,"DtmxMatrixSize",grenum.DtmxMatrixSize)},getDisplayText:function(){return this.textBuilder.generateDisplayText()},get Value(){return this.getDisplayText()},get AsBarcode(){return this}},prototypeCopyExtend(Barcode,Control);var RichTextBox=function(e){var t=this;Control.call(t,e),t.CanGrow=!1,t.CanShrink=!1};RichTextBox.prototype={ControlType:6,attachData:function(){},get AsRichTextBox(){return this}},prototypeCopyExtend(RichTextBox,Control);var SubReport=function(e){var t=this;Control.call(t,e),t.CanGrow=!1,t.CanShrink=!1,t.HideOnRecordsetEmpty=!1};SubReport.prototype={ControlType:9,attachData:function(){},get AsSubReport(){return this}},prototypeCopyExtend(SubReport,Control);var FreeGridColumn=function(e){var t=this;Object.call(t,e),t.Visible=!0,t.FixedWidth=!1,t.Width=t.report.cm2Size(3)};FreeGridColumn.prototype={prepare:function(){self.pxWidth=this.report.size2Pixel(self.Width)},get FreeGrid(){return this.owner}},prototypeCopyExtend(FreeGridColumn,Object);var FreeGridRow=function(e){var t=this;Object.call(t,e),t.Visible=!0,t.Height=t.report.cm2Size(.58)};FreeGridRow.prototype={prepare:function(){self.pxHeight=this.report.size2Pixel(self.Height)},get FreeGrid(){return this.owner}},prototypeCopyExtend(FreeGridRow,Object);var FreeGrid=function(e){var t=this;Control.call(t,e),t.ColumnCount=5,t.RowCount=5,t.TitleRows=1,t.ShowColLine=!0,t.ShowRowLine=!0,t.ColLinePen=new Pen,t.RowLinePen=new Pen,t.columns=[],t.rows=[],t.cells=[]};FreeGrid.prototype={ControlType:13,attachData:function(){var e,t,r,o=this;for(t=o.cells.length,e=0;t>e;e++)r=o.cells[e],r&&r.forEach(function(e){e.attachControlsData(),e.prepare()})},prepare:function(){var e,t,r,o,n=this,a=n.report,i=new HtmlStyles;for(i.addCellBorder(n),n.blankCellStyle=a.viewer.addCustomStyle(i),t=n.columns.length,r=0,e=0;t>e;e++)o=n.columns[e],o.pxWidth=a.size2Pixel(o.Width),r+=o.Width;for(n.Width=r,t=n.rows.length,r=0,e=0;t>e;e++)o=n.rows[e],o.pxHeight=a.size2Pixel(o.Height),r+=o.Height;n.Height=r},assign:function(e){var t=this;Control.prototype.assign.call(t,e),e.columns.forEach(function(e,r){var o=new FreeGridColumn(t);o.assign(e),t.columns[r]=o}),e.rows.forEach(function(e,r){var o=new FreeGridRow(t);o.assign(e),t.rows[r]=o}),e.cells.forEach(function(e,r){e.forEach(function(e,o){var n=new FreeGridCell(t,r,o);n.assign(e),t.cells[r]||(t.cells[r]=[]),t.cells[r][o]=n})})},afterLoad:function(e){var t,r,o,n,a=this;for(Control.prototype.afterLoad.call(a,e),r=a.ColumnCount,t=0;r>t;t++)a.columns.push(new FreeGridColumn(a));for(r=a.cells.length=a.RowCount,t=0;r>t;t++)a.rows.push(new FreeGridRow(a));if(e.FreeGridColumn)for(r=e.FreeGridColumn.length,t=0;r>t;t++)n=e.FreeGridColumn[t],a.columns[n.index-1].loadFromJSON(n);if(e.FreeGridRow)for(r=e.FreeGridRow.length,t=0;r>t;t++)n=e.FreeGridRow[t],a.rows[n.index-1].loadFromJSON(n);if(e.FreeGridCell)for(r=e.FreeGridCell.length,t=0;r>t;t++)n=e.FreeGridCell[t],--n.row,--n.col,o=a.cells[n.row],o||(o=a.cells[n.row]=[],o.length=a.ColumnCount),o=o[n.col]=new FreeGridCell(a,n.row,n.col),o.loadFromJSON(n)},generateInCell:function(e){var t,r,o,n,a=this,i=new HtmlElement("table",e),l=new HtmlElement("colgroup",i),s=[];for(a.Font.font&&i.addClass(a.report.viewer.selectFont2(a.Font.font)),i.getStyles().addBorder(a.Border),i.addStyle("border-collapse","collapse"),i.addStyle("width","100%"),a.toFillBack()&&i.addBackColorStyle(a.BackColor),n=a.ColumnCount,o=0;n>o;o++)t=new HtmlElement("col",l),t.skipend=1,t.addStyle("width",percentToHtml(100*a.columns[o].pxWidth/a.pxRect.Width()));for(o=0;o<a.RowCount;o++)r=[],r.length=a.ColumnCount,s.push(r);a.cells.forEach(function(e,t){e.forEach(function(e){function t(){for(var t,r=e.row,o=r+e.RowSpan,n=e.col+e.ColSpan;o>r;r++)for(t=e.col;n>t;t++)s[r][t]=1}(e.ColSpan>1||e.RowSpan>1)&&t(),s[e.row][e.col]=e})}),s.forEach(function(e,t){var r,o=a.ColumnCount,n=0,l=new HtmlElement("tr",i);l.addStyle("height",pixelsToHtml(a.rows[t].pxHeight));do{for(;o>n&&!e[n];)r=new HtmlElement("td",l),r.addClass(a.blankCellStyle.getStyleName()),n++;for(;o>n&&1===e[n];)n++;o>n&&(r=e[n])&&(r.generate(l),n=r.col+r.ColSpan)}while(o>n)})},get AsFreeGrid(){return this}},prototypeCopyExtend(FreeGrid,Control);var SectionRoot=function(e){var t=this;Object.call(t,e),t.Visible=!0,t.CanGrow=!1,t.CanShrink=!1,t.Height=e.report.cm2Size(t.defaultHeight()),t.BackColor=e.BackColor,t.FormatScript="",t.Font=new FontWrapper(t.getParentFont())};SectionRoot.prototype={afterLoad:function(e){var t=this;e.BackColor||(t.BackColor=t.getParentBackColor()),colorMemberValid(t,"BackColor",t.report.viewer.alpha.background),t.Font.loadFromJSON(e.Font)},prepare:function(){var e=this;e.pxHeight=e.report.size2Pixel(e.Height)},unprepare:function(){delete self.defaultStyle},generate:function(e){var t=this;t.report.fireSectionFormat(t),t.pxHeight=t.report.size2Pixel(t.Height),t.isToGenerate()&&t.doGenerate(e)},defaultHeight:function(){return 3},getParentBackColor:function(e){return this.owner.BackColor},getParentFont:function(){return this.owner.Font},isControlPositionClass:function(){return 0},isToGenerate:function(){var e=this;return e.Visible&&e.Height>0}},prototypeCopyExtend(SectionRoot,Object);var Section=function(e){var t=this;SectionRoot.call(t,e),t.Controls=new Controls(t)};Section.prototype={children:["Controls"],afterLoad:function(e){var t=this;SectionRoot.prototype.afterLoad.call(t,e),t.Controls.loadFromJSON(e.Control)},prepare:function(){var e=this,t=e.report,r=t.viewer;SectionRoot.prototype.prepare.call(e),e.Controls.prepare(),2!==r.options.controlPosition&&e.buildTableLayout(t.getReportWidth(),e.pxHeight),e.tableRows&&(t.fitToHolder&&calcSectionsPercentWidth(e.tableRows),e.tableRows.forEach(function(e){e.defaultStyle=r.selectSectionItem(e)})),e.defaultStyle=r.selectSectionItem(e)},buildTableLayout:function(e,t){function r(e,t,r,o){var n,a,i,s=[];for(l.forEach(function(r){s.push({pos:r.pxRect[e],count:1},{pos:r.pxRect[t],count:1})}),s.sort(function(e,t){return e.pos-t.pos}),n=s.length,a=0;n>a&&s[a].pos<r;)s[a++]=null;if(a>0&&(s.unshift({pos:r,count:a}),++n),!isNaN(o)){for(a=n-1;a>=0&&s[a]&&s[a].pos>o;)s[a--]=null;a=n-1-a,a>=0&&s.push({pos:o,count:a})}return i={pos:-98765},s.forEach(function(e,t){e&&(i.pos===e.pos?(i.count++,s[t]=null):i=e)}),i={pos:-98765},s.forEach(function(e,t){e&&(e.pos-i.pos<8?i.count>e.count?(i.count+=e.count,s[t]=null):(e.count+=i.count,s[a]=null,i=e,a=t):(i=e,a=t))}),s=s.filter(function(e){return e}),n=s.length,n>1&&(s[0].pos<r+4&&(s[0].pos=r),s[0].pos!==r&&(s.unshift({pos:r,count:0}),n++),isNaN(o)||(n--,o-s[n].pos<4&&(s[n].pos=o),s[n].pos!==o&&s.push({pos:o,count:0}))),s}function o(e,t,r){var o=0,n=r.length;l.sort(function(t,r){return t.pxRect[e]-r.pxRect[e]}),l.forEach(function(a){for(var i=a.pxRect[e];n>o&&r[o].pos<i;)o++;(o>=n||o>0&&i-r[o-1].pos<r[o].pos-i)&&--o,a.cell[t]=o})}var n,a,i,l,s,u,c,d=this,p=d.report.viewer,h=d.getMergedColumns?d.getMergedColumns():0,f=[],m=[];if(l=d.Controls.items.filter(function(e){return e.cell={control:e},e.Visible}),s=r("top","bottom",0,t),a=s.length-1,d.getTableColEdges)u=d.getTableColEdges(),i=u.length-1;else for(u=r("left","right",0,e),i=u.length-1,d.tableCols=[],n=0;i>n;)d.tableCols.push(u[n+1].pos-u[n++].pos);for(o("top","beginRow",s),o("bottom","endRow",s),o("left","beginCol",u),o("right","endCol",u),l.forEach(function(e){var t=e.cell;t.endCol<=t.beginCol&&t.endCol<i&&t.endCol++,t.endRow<=t.beginRow&&t.endRow<a&&t.endRow++}),n=0;a>n;)m.push({section:d,pxHeight:s[n+1].pos-s[n++].pos,cells:[]});for(l=l.filter(function(e){var t=e.cell;return t.beginCol<t.endCol&&t.beginRow<t.endRow}),l.sort(function(e,t){var r=e.cell.beginRow-t.cell.beginRow;return r?r:e.cell.beginCol-t.cell.beginCol}),n=0;a>n;n++)c=[],c.length=i,f.push(c);h&&h.forEach(function(e){var t=e.index;f.forEach(function(e){e[t]=1})}),n=0,l.forEach(function(e){for(var t,r,o=e.cell,a=f[o.beginRow];o.beginCol<o.endCol&&a[o.beginCol];)o.beginCol++;for(;o.endCol>o.beginCol&&a[o.endCol-1];)o.endCol--;if(o.beginCol<o.endCol){for(t=o.beginRow;t<o.endRow;t++)for(r=o.beginCol;r<o.endCol;r++)f[t][r]=1;a[o.beginCol]=e,n++}}),c=l.length,!c||n/c>.75||h||1===p.options.controlPosition?(f.forEach(function(e,t){var r,o,n,a=m[t].cells;r=o=0;do{for(;i>o&&!e[o];)o++;for(o>r&&(a.push({beginCol:r,endCol:o}),r=o);i>o&&1===e[o];)o++;r=o,i>r&&(n=e[r])&&(n=n.cell,a.push(n),r=o=n.endCol)}while(i>o)}),d.tableRows=m):(delete d.tableCols,delete d.tableRows)},unprepare:function(){var e=this;SectionRoot.prototype.unprepare.call(e),e.Controls.unprepare()},doGenerate:function(e){var t=this,r=t.report.viewer;e=new HtmlElement(t.tableRows?"table":"div",e),e.addClass(r.selectSection(t)),t.tableRows?(e.addStyle("border-collapse","collapse"),t.generateTableRows(e)):(e.addStyle("position","relative"),t.Controls.generate(e))},generateTableRows:function(e,t){var r,o,n=this,a=n.report,i=a.viewer,l=a.fitToHolder,s=n.tableCols,u=0;s&&(r=new HtmlElement("colgroup",e),l&&s.forEach(function(e){u+=e}),s.forEach(function(e){o=new HtmlElement("col",r),o.skipend=1,o.addStyle("width",l?percentToHtml(100*e/u):pixelsToHtml(e))})),n.tableRows.forEach(function(r,o){function a(e){e.ContentCell.generate(l),e.mergingElement=l.children[l.children.length-1],e.ContentCell.getUsingFont()!==n.getUsingFont()&&e.mergingElement.addClass(i.selectFont2(e.ContentCell.getUsingFont())),e.ContentCell.BackColor!==n.BackColor&&e.mergingElement.addBackColorStyle(e.ContentCell.BackColor),e.mergedHeader.todoMerge=0}var l;l=new HtmlElement("tr",e),l.addClass(i.selectSection(r)),r.cells.forEach(function(e){var r,n,s,u=e.control;if(!o&&t)for(;(s=t[0])&&s.index<=e.beginCol;)a(s),t.shift();r=new HtmlElement("td",l),n=e.endCol-e.beginCol,n>1&&r.addAttribute("colspan",n+""),e.endRow&&(n=e.endRow-e.beginRow,n>1&&r.addAttribute("rowspan",n+""),u.Visible&&(13!==u.ControlType?(r.addClass(i.selectControl(u)),u.Font.font&&r.addClass(i.selectFont(u.Font.font,u.defaultFontStyle))):r.addStyle("padding","0px"),u.generateInCell(r)))}),!o&&t&&t.forEach(function(e){a(e)})})},getRect:function(){var e=this;return new Rect(0,0,e.report.getReportWidth(),e.pxHeight)}},prototypeCopyExtend(Section,SectionRoot);var ReportHeader=function(e){var t=this;Section.call(t,e),t.Name=""};ReportHeader.prototype={},prototypeCopyExtend(ReportHeader,Section);var ReportFooter=function(e){var t=this;Section.call(t,e),t.Name=""};ReportFooter.prototype={},prototypeCopyExtend(ReportFooter,Section);var ColumnSection=function(e){SectionRoot.call(this,e)};ColumnSection.prototype={defaultHeight:function(){return.58}},prototypeCopyExtend(ColumnSection,SectionRoot);var ColumnContent=function(e){var t=this;ColumnSection.call(t,e),t.ContentCells=new ColumnContentCells(t),t.AlternatingBackColor=t.BackColor};ColumnContent.prototype={afterLoad:function(e){var t=this;ColumnSection.prototype.afterLoad.call(t,e),e.AlternatingBackColor?colorMemberValid(t,"AlternatingBackColor",t.report.viewer.alpha.background):t.AlternatingBackColor=t.BackColor,t.ContentCells.loadFromJSON(e.ColumnContentCell)},prepare:function(){var e,t=this,r=t.report.viewer;ColumnSection.prototype.prepare.call(t),t.defaultStyle=r.selectSectionItem(t),t.AlternatingBackColor!==t.BackColor&&(e=t.BackColor,t.BackColor=t.AlternatingBackColor,t.altSectionStyle=r.selectSectionItem(t),t.BackColor=e),t.ContentCells.prepare()},generate:function(e,t){var r=this;r.owner.Recordset.MoveTo(t),ColumnSection.prototype.generate.call(r,e)},doGenerate:function(e){var t,r=this,o=r.owner,n=r.report.viewer;t=new HtmlElement("tr",e),r.altSectionStyle&&o.Recordset.RecordNo%2?(r._BackColor=r.BackColor,r._defaultStyle=r.defaultStyle,r.BackColor=r.AlternatingBackColor,r.defaultStyle=r.altSectionStyle,t.addClass(n.selectSection(r)),r.BackColor=r._BackColor,r.defaultStyle=r._defaultStyle):t.addClass(n.selectSection(r)),o.showingColumns.forEach(function(e){o.hasMergedColumn&&e.mergedHeader?e.mergedHeader.todoMerge&&(e.ContentCell.generate(t),e.mergingElement=t.children[t.children.length-1]):e.ContentCell.generate(t)}),o.hasMergedColumn&&o.Groups.forEach(function(e){e.GroupHeader.todoMerge&&(e.GroupHeader.todoMerge=0)})},SetCellsBackColor:function(e){this.ContentCells.forEach(function(t){t.BackColor=e})},SetCellsForeColor:function(e){this.ContentCells.forEach(function(t){t.setForeColor(e)})}},prototypeCopyExtend(ColumnContent,ColumnSection);var ColumnTitle=function(e){var t=this;ColumnSection.call(t,e),t.TitleCells=new ColumnTitleCells(t,null)};ColumnTitle.prototype={afterLoad:function(e){var t=this;ColumnSection.prototype.afterLoad.call(t,e),t.TitleCells.loadFromJSON(e.ColumnTitleCell)},prepare:function(){function e(t){var n=1;return t.showingItems=[],t.forEach(function(a){var i,l,s;a.layer=o,a.GroupTitle?a.Visible&&(o++,i=e(a.SubTitles)+1,o--,l=a.SubTitles.showingItems,l.length>0&&(t.showingItems.push(a),i>n&&(n=i),a.colspan=0,l.forEach(function(e){a.colspan+=e.colspan}))):(s=a.Column,s.Visible&&s.pxWidth>0&&(t.showingItems.push(a),a.colspan=1,s.pxLeft=r.columnsTotalWidth,s.index=r.showingColumns.length,r.columnsTotalWidth+=s.pxWidth,r.showingColumns.push(s)))}),n}var t=this,r=t.owner,o=0;ColumnSection.prototype.prepare.call(t),r.columnsTotalWidth=0,r.showingColumns=[],t.layerCount=e(t.TitleCells),t.pxHeight/=t.layerCount,t.TitleCells.prepare(),t.defaultStyle=t.report.viewer.selectSectionItem(t)},unprepare:function(){},doGenerate:function(e){function t(e){e.forEach(function(e){e.layer===o.generatingLayer&&e.generate(r),e.GroupTitle&&t(e.SubTitles.showingItems)})}var r,o=this,n=o.report.viewer;for(o.pxHeight/=o.layerCount,o.generatingLayer=0;o.generatingLayer<o.layerCount;)r=new HtmlElement("tr",e),r.addClass(n.selectSection(o)),t(o.TitleCells.showingItems),o.generatingLayer++},FindColumnTitlesOfTitleCell:function(e){function t(r){var o,n,a,i=r.items.length;for(o=0;i>o;o++){if(n=r.items[o],n===e)return r;if(n.GroupTitle&&(a=t(n.SubTitles)))return a}return null}return t(self.TitleCells)},SetCellsBackColor:function(e){function t(r){r.forEach(function(r){r.BackColor=e,r.GroupTitle&&t(r.SubTitles)})}t(this.TitleCells)},SetCellsForeColor:function(e){function t(r){r.forEach(function(r){r.setForeColor(e),r.GroupTitle&&t(r.SubTitles)})}t(this.TitleCells)}},prototypeCopyExtend(ColumnTitle,ColumnSection);var GroupSection=function(e){Section.call(this,e)};GroupSection.prototype={generate:function(e,t){var r=this,o=r.owner;o.recordset.MoveTo(t),o.owner.Recordset.MoveTo((r===o.Header?o.beginNoField:o.endNoField).Value),Section.prototype.generate.call(r,e)},doGenerate:function(e){var t,r,o=this;o.tableRows?o.generateTableRows(e):(t=new HtmlElement("tr",e),r=new HtmlElement("td",t),t.addClass(o.report.viewer.selectSection(o)),r.addAttribute("colspan",o.owner.owner.showingColumns.length+""),r.addStyle("position","relative"),o.Controls.generate(r))},prepare:function(){var e=this;e.groupMergedColumns||Section.prototype.prepare.call(e)},getTableColEdges:function(){var e,t=this.owner.owner.showingColumns;return e=t.map(function(e){return{pos:e.pxLeft,count:1}}),e.push({pos:t[t.length-1].pxRight,count:1}),e},getMergedColumns:function(){var e,t,r=this;return e=r.owner.index,t=r.owner.owner.showingColumns.filter(function(t){var o,n,a=t.mergedHeader;return a&&((n=(o=a.owner).index)<e||n===e&&r===o.GroupFooter&&o.GroupHeader.IncludeFooter)}),0===t.length&&(t=0),t},getParentBackColor:function(e){return this.owner.owner.BackColor},getParentFont:function(){return this.owner.owner.Font}},prototypeCopyExtend(GroupSection,Section);var GroupHeader=function(e){var t=this;GroupSection.call(t,e),t.OccupiedColumns="",t.OccupyColumn=!1,t.SameAsColumn=!0,t.IncludeFooter=!1,t.VAlign=1};GroupHeader.prototype={afterLoad:function(e){var t=this;GroupSection.prototype.afterLoad.call(t,e),enumMemberValid(t,"VAlign",grenum.OCGroupHeaderVAlign)},prepare:function(){var e,t=this;t.OccupiedColumns&&(e=t.owner.owner.Columns.decodeItems(t.OccupiedColumns),e=e.filter(function(e){return e.Visible}),e.length>0&&(t.groupMergedColumns=e,e.forEach(function(e){e.mergedHeader=t,t.owner.owner.hasMergedColumn=1}))),GroupSection.prototype.prepare.call(t)},unprepare:function(){},generate:function(e,t){var r=this;r.groupMergedColumns?(r.curItemBegin=e.children.length,r.todoMerge=1):GroupSection.prototype.generate.call(r,e,t)},doGenerate:function(e){var t,r=this,o=r.owner.owner;o.hasMergedColumn&&(t=[],o.showingColumns.forEach(function(e){e.mergedHeader&&e.mergedHeader.todoMerge&&t.push(e)}),t.length||(t=undefined)),t?r.tableRows?r.generateTableRows(e,t):r.Controls.generate(e):GroupSection.prototype.doGenerate.call(r,e)}},prototypeCopyExtend(GroupHeader,GroupSection);var GroupFooter=function(e){GroupSection.call(this,e)};GroupFooter.prototype={generate:function(e,t){var r,o=this,n=o.owner.GroupHeader,a=n.groupMergedColumns;GroupSection.prototype.generate.call(o,e,t),a&&(r=e.children.length-n.curItemBegin,!n.IncludeFooter&&o.isToGenerate()&&r--,r>1&&a.forEach(function(e){e.mergingElement.addAttribute("rowspan",r+"")}))}},prototypeCopyExtend(GroupFooter,GroupSection);var Field=function(e){var t=this;Object.call(t,e),t.FieldType=1,t.Name="",t.DBFieldName="",t.Format="",t.RTrimBlankChars=!1,t.GetDisplayTextScript=""};Field.prototype={afterLoad:function(e){var t=this;e.Type&&(t.FieldType=e.Type),enumMemberValid(t,"FieldType",grenum.FieldType)},prepare:function(){var e=this,t=e.FieldType;6===t?e.formater=new grformat.DateTimeFormatter(e.Format):5===t?e.formater=new grformat.BooleanFormatter(e.Format):2!==t&&3!==t&&4!==t||(e.formater=new grformat.NumericFormatter(e.Format))},unprepare:function(){delete this.formater},isNumeric:function(){var e=this.FieldType;return 2===e||3===e||4===e},get Value(){var e,t=this,r=t.owner.curRecord;return r&&(e=r[t.RunningDBField]),e},set Value(e){var t=this,r=t.owner.curRecord;if(r){if(e!==undefined&&null!==e)switch(t.FieldType){case 2:case 3:case 4:e=+e;break;case 5:e=confirmBooleanValue(e);break;case 6:e=cloneDate(e);break;default:e+=""}else e=undefined;r[t.RunningDBField]=e}},get AsBoolean(){return confirmBooleanValue(this.Value)},set AsBoolean(e){this.Value=e},get AsCurrency(){return+this.Value},set AsCurrency(e){this.Value=e},get AsDateTime(){return cloneDate(this.Value)},set AsDateTime(e){this.Value=e},get AsFloat(){var e,t=this;if(6===t.FieldType){var r=new DateTime;r.value=t.Value,e=r.AsFloat}else e=+t.Value;return isNaN(e)?0:e},set AsFloat(e){var t,r=this;6===r.FieldType&&(t=new DateTime,t.AsFloat=e,e=t.value),r.Value=e},get AsInteger(){return Math.floor(this.AsFloat)},set AsInteger(e){this.AsFloat=Math.floor(+e)},get AsString(){var e=this;return e.IsNull?"":e.Value+""},set AsString(e){this.Value=e},get DisplayText(){var e=this,t=e.FieldType,r=e.Value;return e.displayTextAssigned=0,e.doingGetDisplayText||(e.doingGetDisplayText=1,e.report.fireFieldGetDisplayText(e),e.doingGetDisplayText=0),e.displayTextAssigned?e.assignedDisplayText:e.IsNull?"":1===t||7===t?r+"":e.formater.format(r)},set DisplayText(e){var t=this;t.assignedDisplayText=e+"",t.displayTextAssigned=1},get IsNull(){var e=this.Value;return e===undefined||null===e},get RunningDBField(){var e=this;return e.DBFieldName?e.DBFieldName:e.Name},Clear:function(){this.Value=null}},prototypeCopyExtend(Field,Object);var Recordset=function(e){var t=this;Object.call(t,e),t.Fields=new Fields(t),t.SortAsc=!0,t.SortCaseSensitive=!1,t.SortFields="",t.XmlTableName="",t.FetchRecordScript="",t.BeforePostRecordScript="",t.ProcessRecordScript="",t._dataTable=[],t.recordNo=0};Recordset.prototype={children:["Fields"],afterLoad:function(e){this.Fields.loadFromJSON(e.Field)},attachDataTable:function(e){var t=this;t._dataTable=e,t.MoveTo(0)},prepareTableData:function(){var e,t,r,o,n,a,i,l,s=this,u=s._dataTable,c=s.Fields.items,d={};for(e=c.length;e--;)d[c[e].RunningDBField]=undefined;for(e=u.length;e--;)for(r=u[e],t=c.length;t--;){if(o=c[t],n=o.RunningDBField,l=d[n],l===undefined&&r.hasOwnProperty(n)){switch(i=0,o.FieldType){case 1:i="string";break;case 2:case 3:case 4:i="number";break;case 5:i="boolean";break;case 6:l=!Date.prototype.isPrototypeOf(r[n]);break;default:l=!1}i&&(l=typeof r[n]!==i),d[n]=l}if(l&&r.hasOwnProperty(n))if(a=r[n],""===a||null===a||a===undefined)r[n]=null;else switch(o.FieldType){case 1:r[n]=a+"";break;case 2:case 3:case 4:r[n]=+a;break;case 5:r[n]=confirmBooleanValue(a);break;case 6:r[n]=confirmDateValue(a)}}s.SortFields&&s.Resort(s.SortFields,s.SortAsc,s.SortCaseSensitive)},prepare:function(){var e,t=this,r=t._dataTable,o=r.length;if(t.Fields.prepare(),t.prepareTableData(),t.isDetailGridRecordset()){for(e=0;o>e;e++)t.MoveTo(e),t.report.fireBeforePostRecord();t.MoveTo(0)}},unprepare:function(){this.Fields.unprepare()},decodeFields:function(e){return this.Fields.decodeItems(e)},isDetailGridRecordset:function(){var e=this;return e.owner===e.report.DetailGrid},isAppendingRecord:function(){return 1===this.editStatus},keepValue:function(){var e=this;e.keepedRecord=e.curRecord},fieldsKeepedValueChanged:function(e){var t=this;return e.some(function(e){var r=e.RunningDBField,o=t.keepedRecord[r],n=t.curRecord[r];return n>o||o>n})},sortRecords:function(e,t){for(var r=this,o=r._dataTable,n=o.length,a=0,i=[];n>a;)i.push(a++);return e.length>0&&(e.forEach(function(e){e.fieldName=e.field.RunningDBField}),i.sort(function(t,r){var n;return e.some(function(e){var a=o[t][e.fieldName],i=o[r][e.fieldName];return a!==undefined&&i!==undefined?1===e.field.FieldType?(e["case"]||(a=a.toUpperCase(),i=i.toUpperCase()),n=a.localeCompare(i)):n=i>a?-1:a>i?1:0:n=a===undefined&&i===undefined?0:a===undefined?-1:1,e.asc||(n=-n),n}),n})),t?i:(a=[],i.forEach(function(e){a.push(o[e])}),r._dataTable=a,void r.MoveTo(0))},get RecordCount(){var e=this;return e._dataTable?e._dataTable.length:0},get RecordNo(){return this.recordNo},FieldByName:function(e){return this.Fields.itemByName(e)},FieldByDBName:function(e){var t,r=this.Fields.items,o=r.length;for(e=e.toUpperCase(),t=0;o>t;t++)if(r[t].RunningDBField.toUpperCase()===e)return r[t];return null},Append:function(){var e=this;e.editStatus=1,e.recordNo=e._dataTable.length,e.curRecord={}},Edit:function(){var e,t,r=this,o=r.Fields.items,n=o.length,a=r.curRecord,i={};if(r.recordNo>=0&&r.recordNo<r._dataTable.length){for(r.editStatus=2;n--;)e=o[n],t=e.RunningDBField,a[t]!==undefined&&(6===e.FieldType?i[t]=cloneDate(a[t]):i[t]=a[t]);r.curRecord=i}},Cancel:function(){var e=this;e.editStatus&&(1===e.editStatus?e.Last():e.curRecord=e._dataTable[e.recordNo],e.editStatus=0)},Post:function(){var e=this;e.editStatus&&(e.isDetailGridRecordset()&&e.report.fireBeforePostRecord(),1===e.editStatus?e._dataTable.push(e.curRecord):e._dataTable[e.recordNo]=e.curRecord,e.editStatus=0)},First:function(){this.MoveTo(0)},Next:function(){var e=this;e.MoveTo(e.recordNo+1)},Prior:function(){var e=this;e.MoveTo(e.recordNo-1)},Last:function(){var e=this;e.MoveTo(e._dataTable.length-1)},MoveBy:function(e){var t=this;t.MoveTo(t.recordNo+e)},Bof:function(){var e=this;return e.recordNo<0||!e._dataTable.length},Eof:function(){var e=this;return e.recordNo>=e._dataTable.length},MoveTo:function(e){var t=this,r=t._dataTable;t.recordNo=e,t.curRecord=r[Math.min(Math.max(0,e),r.length-1)]},Empty:function(){this.attachDataTable([])},AddField:function(e,t){var r=this.Fields.Add();return r.Name=e,r.FieldType=t,r},RemoveAllFields:function(){this.Fields.RemoveAll()},Resort:function(e,t,r){function o(){var o=[],n=e.split(";");return n.forEach(function(e){function n(e){e=e.trim().toUpperCase(),"ASC"===e?l.asc=!0:"DESC"===e?l.asc=!1:"CASE"===e?l["case"]=!0:"CASEIN"===e&&(l["case"]=!1)}var a,l={};e=e.trim(),a=e.split(" "),a[0]=a[0].trim(),l.field=i.Fields.Item(a[0]),
l.field&&(l.asc=t,l["case"]=r,a.length>1&&n(a[1]),a.length>2&&n(a[2]),o.push(l))}),o}var n,a,i=this,l=[];e&&(n=o(),a=n.length,a>0&&(i.report.fireBeforeSort(e,i),i.isDetailGridRecordset()&&(i.owner.Groups.forEach(function(e){i.decodeFields(e.ByFields).forEach(function(e){l.indexOf(e)<0&&l.push(e)})}),n.forEach(function(e){var t=l.indexOf(e.field);0>t?l.push(e):l[t]=e}),l.forEach(function(e,o){e.field||(l[o]={field:e,asc:t,"case":r})}),n=l,a=n.length)),i.sortRecords(n,0))}},prototypeCopyExtend(Recordset,Object);var Column=function(e){var t=this;Object.call(t,e),t.Name="",t.Visible=!0,t.FixedWidth=!1,t.Width=0};Column.prototype={prepare:function(){var e=this;e.pxWidth=e.report.size2Pixel(e.Width)},get pxRight(){var e=this;return e.pxLeft+e.pxWidth}},prototypeCopyExtend(Column,Object);var Group=function(e){var t=this;Object.call(t,e),t.GroupHeader=new GroupHeader(t),t.GroupFooter=new GroupFooter(t),t.Name="",t.ByFields="",t.SortSummaryBox="",t.SortAsc=!1,t.GroupBeginScript="",t.GroupEndScript=""};Group.prototype={children:["GroupHeader","GroupFooter"],afterLoad:function(e){var t=this;t.GroupHeader.loadFromJSON(e.GroupHeader),t.GroupFooter.loadFromJSON(e.GroupFooter)},prepare:function(e){function t(e){e.forEach(function(e){function o(e){function n(e){var t,o,n,a=r.summaryItems.length+"",i="";r.summaryItems.push(e),e.SummaryFun?(e.value=0,28==e.SummaryFun&&(t=r.owner.Groups.indexOf(r),t>0&&(o=new Summary,o.SummaryFun=grconst.GROUP_SUMACC_INSUP,o.init(),r.owner.Groups.items[t-1].summaryItems.push(o))),e.displayField?(n=e.displayField.FieldType,i=e.displayField.Format):n=18===e.SummaryFun||19===e.SummaryFun?1:3):(n=e.oParameter.DataType,i=e.oParameter.Format),e.valueField=r.recordset.AddField(a,n),e.valueField.Format=i}var a=e.ControlType;5==a?n(e):8==a?(e.getSummaryExpFields().forEach(function(e){n(e)}),e.getParameterExpFields().forEach(function(e){n(e)})):1==a?e.oParameter&&n(e):13==a&&e.cells.forEach(function(e){e.forEach(function(e){e.FreeCell?t(e.Controls):o(e)})})}o(e)})}var r=this;r.index=e,r.GroupHeader.prepare(),r.GroupFooter.prepare(),r.oByFields=r.owner.Recordset.decodeFields(r.ByFields),r.SortSummaryBox&&(r.sortSummaryBoxObj=r.GroupFooter.Controls.itemByName(r.SortSummaryBox),r.sortSummaryBoxObj||(r.sortSummaryBoxObj=r.GroupHeader.Controls.itemByName(r.SortSummaryBox)),r.sortSummaryBoxObj&&5!==r.sortSummaryBoxObj.ControlType&&delete r.sortSummaryBoxObj),r.recordset=new Recordset(r),r.beginNoField=r.recordset.AddField("b",2),r.endNoField=r.recordset.AddField("e",2),r.groupItemNo=0,r.summaryItems=[],t(r.GroupHeader.Controls),t(r.GroupFooter.Controls),r.recordset.prepare()},unprepare:function(){},inphaseByDetail:function(e){var t=this,r=t.recordset;if(!r.isAppendingRecord()&&r.RecordCount){for(;t.beginNoField.Value>e&&!r.Bof();)r.Prior();for(;t.endNoField.Value<e&&!r.Eof();)r.Next()}}},prototypeCopyExtend(Group,Object);var DetailGrid=function(e){var t=this;Object.call(t,e),t.FixCols=0,t.CenterView=!1,t.BackColor=e.BackColor,t.ShowColLine=!0,t.ShowRowLine=!0,t.Font=new FontWrapper(e.Font),t.Border=new Border(15),t.ColLinePen=new Pen,t.RowLinePen=new Pen,t.Recordset=new Recordset(t),t.ColumnContent=new ColumnContent(t),t.ColumnTitle=new ColumnTitle(t),t.Columns=new Columns(t),t.Groups=new Groups(t)};DetailGrid.prototype={children:["Border","ColLinePen","RowLinePen","Recordset","Groups"],afterLoad:function(e){var t=this;colorMemberValid(t,"BackColor",t.report.viewer.alpha.background),t.Border.loadFromJSON(e.Border,t.report.viewer.alpha.border),t.ColLinePen.loadFromJSON(e.ColLine,t.report.viewer.alpha.stroke),t.RowLinePen.loadFromJSON(e.RowLine,t.report.viewer.alpha.stroke),t.Font.loadFromJSON(e.Font),t.Recordset.loadFromJSON(e.Recordset),t.Groups.loadFromJSON(e.Group),t.Columns.loadFromJSON(e.Column),t.ColumnContent.loadFromJSON(e.ColumnContent),t.ColumnTitle.loadFromJSON(e.ColumnTitle),t.IsCrossTab=e.IsCrossTab,e.IsCrossTab&&t.CrossTab.loadFromJSON(e.CrossTab)},assign:function(e){function t(e,o){o.forEach(function(o){var n;o.GroupTitle?(n=e.AddGroup("",""),n.assign(o),t(n.SubTitles,o.SubTitles)):(n=r.Columns.addTo(e),n.assign(o.Column),n.TitleCell.assign(o),n.ContentCell.assign(o.Column.ContentCell))})}var r=this;Object.prototype.assign.call(r,e),r.ColumnContent.assign(e.ColumnContent),r.ColumnTitle.assign(e.ColumnTitle),t(r.ColumnTitle.TitleCells,e.ColumnTitle.TitleCells),r.IsCrossTab=e.IsCrossTab,r.IsCrossTab&&r.CrossTab.assign(e.CrossTab)},attachControlsData:function(){function e(t){t.forEach(function(t){t.attachControlsData(),t.GroupTitle&&e(t.SubTitles)})}var t=this;t.Recordset.prepare(),t.ColumnContent.ContentCells.forEach(function(e){e.attachControlsData()}),e(t.ColumnTitle.TitleCells),t.Groups.forEach(function(e){e.GroupHeader.Controls.attachData(),e.GroupFooter.Controls.attachData()})},buildColumnsOrder:function(){function e(t){t.forEach(function(t){t.GroupTitle?e(t.SubTitles):(t.Column.orderNo=r.length,r.push(t.Column))})}var t=this,r=[];e(t.ColumnTitle.TitleCells),t.Columns.items=r},beginGroupItem:function(e){var t=this;t.rows.push({header:e.GroupHeader,recordNo:e.groupItemNo}),e.recordset.Append(),e.beginNoField.Value=t.Recordset.recordNo,e.groupRecordCount=0,e.summaryItems.forEach(function(e){e.SummaryFun&&e.beginSummaryValue()}),t.report.fireGroupBegin(e)},endGroupItem:function(e){var t=this,r=t.report;t.rows.push({footer:e.GroupFooter,recordNo:e.groupItemNo++}),e.summaryItems.forEach(function(e){e.SummaryFun&&e.endSummaryValue()}),e.summaryItems.forEach(function(e){var t=e.SummaryFun;t?grconst.GROUP_SUMACC_INSUP!==t&&(e.displayField||18===t||19===t?e.stringValue&&(e.valueField.AsString=e.stringValue):e.value!==undefined&&(e.valueField.AsFloat=e.value)):e.valueField.Value=e.oParameter.Value}),r.fireGroupEnd(e),r.DetailGrid.CrossTab&&r.DetailGrid.CrossTab.GroupEndProcess(e),e.endNoField.Value=t.Recordset.recordNo,e.recordset.Post()},prepare:function(){function e(){function e(t){t.forEach(function(t){function o(t){var n=t.ControlType;5==n?r.globalSummaryItems.push(t):8==n?MemoBox.prototype.getSummaryExpFields.call(t).forEach(function(e){r.globalSummaryItems.push(e)}):13==n&&t.cells.forEach(function(t){t.forEach(function(t){t.FreeCell?e(t.Controls):o(t)})})}o(t)})}function t(e){e.summaryItems.forEach(function(e){e.SummaryFun&&e.summaryCurRecord()}),e.groupRecordCount++}function o(e){function t(){var t,r=l.length,o=e.owner.rows,n=[];1>=r||(t=l[0].beginRowNo,l.forEach(function(t){e.recordset.MoveTo(t.groupItemNo),t.sortValue=e.sortSummaryBoxObj.valueField.AsFloat}),l.sort(function(t,r){return e.SortAsc?t.sortValue-r.sortValue:r.sortValue-t.sortValue}),l.forEach(function(e){n=n.concat(o.slice(e.beginRowNo,e.endRowNo))}),n.forEach(function(e){o[t++]=e}))}var r,o,n,a=e.owner.rows,i=a.length,l=[];for(r=0;i>r;){for(n={},o=a[r],o.footer&&o.footer.owner.index<e.index&&(t(),l=[],r++);i>r;)if(o=a[r++],o.header&&o.header.owner.index===e.index){n.beginRowNo=r-1,n.groupItemNo=o.recordNo;break}for(;i>r;)if(o=a[r++],o.footer&&o.footer.owner.index===e.index){n.endRowNo=r,l.push(n);break}}t()}var n,a,i,l=r.report,s=r.Recordset,u=r.Groups.items,c=u.length,d=0;for(r.globalSummaryItems=[],l.ReportHeaders.items.concat(l.ReportFooters.items).forEach(function(t){e(t.Controls)}),r.rows=[],r.globalSummaryItems.forEach(function(e){e.beginSummaryValue()}),s.First(),r.Recordset.keepValue(),u.forEach(function(e){r.beginGroupItem(e)});!s.Eof();){for(n=0;c>n&&!s.fieldsKeepedValueChanged(u[n].oByFields);n++);if(c>n){for(s.Prior(),a=c-1;a>=n;a--)r.endGroupItem(u[a]);for(s.Next(),a=n;c>a;a++)r.beginGroupItem(u[a])}l.fireProcessRecord(s),u.forEach(function(e){t(e)}),r.globalSummaryItems.forEach(function(e){e.summaryCurRecord()}),r.rows.push(s.recordNo),s.keepValue(),s.Next()}for(l.fireProcessEnd(),a=c-1;a>=0;a--)r.endGroupItem(u[a]);r.globalSummaryItems.forEach(function(e){e.endSummaryValue()}),u.forEach(function(e){e.sortSummaryBoxObj&&(o(e),d=1)}),d&&(i=[],a=0,r.sortedTable=[],u.forEach(function(e){e.sortedTable=[],e.groupItemNo=0}),r.rows.forEach(function(e){var t;e.header?(t=e.header.owner,t.recordset.MoveTo(e.recordNo),t.recordset.Edit(),t.beginNoField.Value=a,e.recordNo=t.groupItemNo):e.footer?(t=e.footer.owner,t.endNoField.Value=a,t.recordset.Post(),t.sortedTable.push(t.recordset._dataTable[e.recordNo]),e.recordNo=t.groupItemNo++):(r.sortedTable.push(r.Recordset._dataTable[e]),e=a++),i.push(e)}),r.rows=i,r.Recordset.attachDataTable(r.sortedTable),delete r.sortedTable,u.forEach(function(e){e.recordset.attachDataTable(e.sortedTable),delete e.sortedTable}))}function t(){r.buildColumnsOrder(),r.Recordset.prepareTableData(),r.CrossTab.prepare()}var r=this;r.CrossTab?t():(r.Columns.prepare(),r.ColumnContent.prepare(),r.ColumnTitle.prepare(),r.Groups.forEach(function(e,t){e.prepare(t)}),e())},unprepare:function(){},generate:function(e){function t(e){e.header?e.header.generate(a,e.recordNo):e.footer?e.footer.generate(a,e.recordNo):o.ColumnContent.generate(a,e)}var r,o=this,n=o.report.viewer,a=new HtmlElement("table",e),i=new HtmlElement("colgroup",a);o.Font.font&&a.addClass(n.selectFont2(o.Font.font)),a.getStyles().addBorder(o.Border),a.addStyle("border-collapse","collapse"),a.addStyle("width",n.options.gridFitWidth?"100%":pixelsToHtml(o.columnsTotalWidth+o.Border.getLeftWidth()+o.Border.getRightWidth())),o.toFillBack()&&a.addBackColorStyle(o.BackColor),o.showingColumns.forEach(function(e){r=new HtmlElement("col",i),r.skipend=1,r.addStyle("width",percentToHtml(100*e.pxWidth/o.columnsTotalWidth))}),o.ColumnTitle.generate(a),o.rows.forEach(function(e,r){o.generatingRowNo=r,t(e)})},clearColumns:function(){var e=this;e.ColumnContent.ContentCells.RemoveAll(),e.ColumnTitle.TitleCells.RemoveAll(),e.Columns.RemoveAll()},MoveColumnTo:function(e,t){var r=this,o=r.ColumnTitle.FindColumnTitlesOfTitleCell(e.TitleCell),n=t?t.SubTitles:r.ColumnTitle.TitleCells;r.MoveTitleTo(e.TitleCell,o,n,-1)},MoveTitleTo:function(e,t,r,o){t.items.splice(t.items.indexOf(e),1),0>o?r.items.push(e):r.items.splice(o,0,e)},get IsCrossTab(){return!!this.CrossTab},set IsCrossTab(e){var t=this;e?t.CrossTab||(t.CrossTab=new CrossTab(t)):delete t.CrossTab},AddColumn:function(e,t,r,o){var n=this.Columns.Add();return n.Name=e,n.Width=o,n.ContentCell.DataField=r,n.TitleCell.Text=t,n},ClearColumns:function(){this.Columns.RemoveAll()},ColumnMoveTo:function(e,t){var r=this,o=r.Columns.Item(e);o&&r.MoveColumnTo(o,t)},StartNewGroup:function(e){var t,r=this,o=r.Recordset,n=r.Groups.items,a=n.length,i=r.Groups.Item(e);if(i){for(o.Prior(),t=a-1;t>=i.index;t--)r.endGroupItem(n[t]);for(o.Next(),t=i.index;a>t;t++)r.beginGroupItem(n[t])}}},prototypeCopyExtend(DetailGrid,Object);var Parameter=function(e){var t=this;Object.call(t,e),t.DataType=1,t.Name="",t.Format="",t.Value=null};Parameter.prototype={afterLoad:function(e){var t=this;enumMemberValid(t,"DataType",grenum.ParameterDataType),null!==t.Value&&t.setValue(t.Value)},prepare:function(){var e=this;6===e.DataType?e.formater=new grformat.DateTimeFormatter(e.Format):5===e.DataType?e.formater=new grformat.BooleanFormatter(e.Format):2!==e.DataType&&3!==e.DataType||(e.formater=new grformat.NumericFormatter(e.Format))},unprepare:function(){delete this.formater},setValue:function(e){var t=this;if(null!==e||e!==undefined)switch(t.DataType){case 2:e=Math.floor(+e);break;case 3:e=+e;break;case 5:e=confirmBooleanValue(e);break;case 6:e=confirmDateValue(e);break;default:e+=""}t.Value=e},get AsBoolean(){return!!this.Value},set AsBoolean(e){this.setValue(e)},get AsDateTime(){return cloneDate(this.Value)},set AsDateTime(e){this.setValue(e)},get AsFloat(){var e=this,t=e.Value;if(6===e.DataType){var r=new DateTime;r.value=t,t=r.AsFloat}else t=+t;return isNaN(t)?0:t},set AsFloat(e){var t,r=this;6===r.DataType&&(t=new DateTime,t.AsFloat=e,e=t.value),r.setValue(e)},get AsInteger(){return Math.floor(this.AsFloat)},set AsInteger(e){this.AsFloat=Math.floor(+e)},get AsString(){return this.Value+""},set AsString(e){this.setValue(e)},get DisplayText(){var e=this,t=e.Value;if(null===t)return"";switch(e.DataType){case 1:return t+"";default:return e.formater.format(t)}},get IsNull(){return null===this.Value},Clear:function(){this.Value=null}},prototypeCopyExtend(Parameter,Object);var Report=function(e){var t=this;t.viewer=e,t.report=t,t.Version="",t.Font=new FontWrapper(null),t.Font.font=new Font,t.Parameters=new Parameters(t),t.ReportHeaders=new ReportHeaders(t),t.ReportFooters=new ReportFooters(t),t.XmlTableName="",t.Unit=1,t.BackColor=16777215|e.alpha.background<<24,t.designWidth=16,t.InitializeScript="",t.ProcessBeginScript="",t.ProcessEndScript="",t.BeforeSortScript=""};Report.prototype={loadFromJSON:function(e){var t=this,r={Width:21,Height:29.7,LeftMargin:2.5,RightMargin:2.5,Oriention:"Portrait"};if(t.Clear(),assignJSONMembers(t,e),colorMemberValid(t,"BackColor",t.report.viewer.alpha.background),t.Font.loadFromJSON(e.Font),t.Parameters.loadFromJSON(e.Parameter),t.ReportHeaders.loadFromJSON(e.ReportHeader),t.ReportFooters.loadFromJSON(e.ReportFooter),e.DetailGrid){var o=t.InsertDetailGrid();o.loadFromJSON(e.DetailGrid)}e.Printer&&(assignObjectAtom(r,e.Printer),t.designWidth=("Portrait"===r.Oriention?r.Width:r.Height)-r.LeftMargin-r.RightMargin)},generate:function(){function e(t){t&&(r.push(t.beginText()),t.children?t.children.forEach(function(t){e(t)}):r.push(t.innerText),r.push(t.endText()))}var t=this,r=(t.viewer,[]),o={htmlElements:[],addChild:function(e){o.htmlElements.push(e)}};t.fireInitialize(),t.matchTables(),t.DetailGrid&&t.fireFetchRecord(),t.fireProcessBegin(),t.prepare(),t.singleChart?t.singleChart.generateContent(o):(t.fitToHolder&&calcSectionsPercentWidth(t.ReportHeaders.items.concat(t.ReportFooters.items)),t.ReportHeaders.generate(o),t.ReportFooters.generate(o)),t.RunningDetailGrid?t.RunningDetailGrid.generate(o):t.fireProcessEnd(),o.htmlElements.forEach(function(t){e(t)}),t.viewer.html=r.join("")},attachDataTable:function(e){var t,r,o=this,n=e[0];for(var a in n)if(t=n[a],r=o.ParameterByName(a))r.setValue(t);else if(r=o.ControlByName(a))switch(r.ControlType){case 1:case 8:case 12:case 7:r.Text=t+""}},matchTables:function(){var e=this,t=e.viewer.tables,r=[],o=function(e,t){var r=this;r.recordCount=t.length,r.tableName=e,r.table=t,r.matchWeight=0};o.prototype={buildFieldNames:function(){for(var e,t=this,r=t.fieldNames=[],o=Math.min(t.recordCount,50),n=t.table;o--;){e=n[o];for(var a in e)a=a.toUpperCase(),r.indexOf(a)<0&&r.push(a)}},isFullMatched:function(){return this.matchWeight>=200},turnToFullMatched:function(){this.matchWeight=200},isMatched:function(){return this.matchWeight>=40}};for(var n in t)r.push(new o(n,t[n]));1===r.length&&r[0].recordCount>1&&e.DetailGrid?e.DetailGrid.Recordset.attachDataTable(r[0].table):e.smartMatchTables(r)},smartMatchTables:function(e){function t(e){var t,r;if(e)for(C.push(new x(!1,e)),e.DetailGrid&&(t=e.DetailGrid.Recordset,C.push(new x(!0,t))),r=e.FindFirstControl();r;)11===r.ControlType?(t=r.Recordset,t.Fields.Count>0&&C.push(new x(!0,t))):9===r.ControlType,r=e.FindNextControl()}function r(e,t,r){function o(e,t){var r,o=e.length,n=0;for(r=0;o>r;r++)t.indexOf(e[r])>=0&&n++;return 100*n/o}var n=t.recordCount,a=t.fieldNames,i=0;if(e.length&&t.fieldNames.length){if(i=o(e,a),!i)return 0;100===i&&e.length===a.length?i=200:i+=o(a,e),i+=r&&n>1||!r&&1===n?5:-5}return i}function o(e){return e>=200}function n(){var e,t,r,o=g,n=[];for(e=o.Parameters.items.length;e--;)n.push(o.Parameters.items[e].Name.toUpperCase());for(t=o.FindFirstControl();t;)r=t.ControlType,1===r||8===r||7===r||12===r?n.push(t.Name.toUpperCase()):13===r&&t.cells.forEach(function(e){e.forEach(function(e){e.DataName&&n.push(e.DataName.toUpperCase())})}),t=o.FindNextControl();return n}function a(e){for(var t=e[0],r=1,o=e.length;o>r;r++)e[r].weight>t.weight&&(t=e[r]);return t}function i(e,t,r){r.matchWeight<e&&(r.matchWeight=e,r.reportTableInfo=t)}var l,s,u,c,d,p,h,f,m,g=this,C=[],x=function(e,t){var r=this;r.isRecordset=e,r.tableName=t.XmlTableName,r.object=t};for(t(g),l=e.length;l--;)e[l].buildFieldNames();for(s=C.length,l=0;s>l;++l){if(c=C[l],c.tableName){if(u=e.indexOf(c.tableName),u>=0){e[u].turnToFullMatched();continue}c.tableName=""}if(c.isRecordset){for(f=c.object.Fields.items,m=[],u=f.length;u--;)m.push(f[u].RunningDBField.toUpperCase());for(p=[],u=e.length;u--;)if(d=e[u],!d.isFullMatched()){if(h=r(m,d,!0),o(h)){i(h,c,d),p=[];break}h>0&&p.push({dataTableInfo:d,weight:h})}p.length&&(u=a(p),i(u.weight,c,u.dataTableInfo))}}if(e.some(function(e){return!e.isMatched()}))for(s=C.length,l=0;s>l;++l)if(c=C[l],!c.isRecordset&&!c.tableName){for(m=n(),p=[],u=e.length;u--;)if(d=e[u],!d.isFullMatched()){if(h=r(m,d,!1),o(h)){i(h,c,d),p=[];break}h>0&&p.push({dataTableInfo:d,weight:h})}p.length&&(u=a(p),i(u.weight,c,u.dataTableInfo))}for(s=e.length,l=0;s>l;l++)d=e[l],c=d.reportTableInfo,c&&c.object.attachDataTable(d.table)},prepare:function(){function e(e){e.forEach(function(e){e.Controls.attachData()})}var t=this;t.DetailGrid&&t.DetailGrid.attachControlsData(),e(t.ReportHeaders),e(t.ReportFooters),t.Parameters.prepare(),t.DetailGrid&&t.DetailGrid.prepare(),t.ReportHeaders.prepare(),t.ReportFooters.prepare(),t.viewer.options.singleChartFill&&!t.DetailGrid&&t.ReportHeaders.Count+t.ReportFooters.Count===1&&(t.singleChart=(t.ReportHeaders.items[0]||t.ReportFooters.items[0]).Controls.items[0],t.singleChart.ControlType!==gr.enum_.ControlType.Chart&&delete t.singleChart)},unprepare:function(){var e=this;e.Parameters.unprepare(),e.DetailGrid&&(e.DetailGrid.unprepare(),e.RunningDetailGrid=e.DetailGrid),delete e.singleChart,delete e.canvasControls},getUsingFont:function(){return this.Font.font},getRunningColumnByName:function(e){var t=this;return t.RunningDetailGrid?t.RunningDetailGrid.Columns.itemByName(e):null},getReportWidth:function(){var e=this;return e.RunningDetailGrid?e.RunningDetailGrid.columnsTotalWidth:e.size2Pixel(e.designWidth)},get fitToHolder(){var e=this;return!e.RunningDetailGrid&&e.viewer.options.fitToHolder},get toFillHolder(){var e=this;return e.fitToHolder||e.singleChart},pixel2Size:function(e){return e/=96,1===this.Unit&&(e*=2.54),e},size2Pixel:function(e){return 1===this.Unit&&(e/=2.54),96*e},cm2Size:function(e){return 1===this.Unit?e:e/2.54},registerCanvas:function(e,t){var r=this,o=new HtmlElement("canvas",t),n=uidCanvas();o.addAttribute("id",n),r.toFillHolder?(o.addStyle("width","100%"),o.addStyle("height","100%"),o.addStyle("display","block")):(o.addAttribute("width",e.pxRect.Width()+""),o.addAttribute("height",e.pxRect.Height()+"")),r.canvasControls||(r.canvasControls=[]),e.canvasID=n,r.canvasControls.push(e)},prepareCanvas:function(){for(var e,t,r=this,o=r.canvasControls.length;o-- >0;)e=r.canvasControls[o],e.canvas=t=document.getElementById(e.canvasID),e.prepareCanvas&&e.prepareCanvas()},resizeCanvas:function(){for(var e,t=this,r=t.canvasControls.length;r-- >0;)e=t.canvasControls[r],e.resize&&e.resize()},renderCanvas:function(){for(var e=this,t=e.canvasControls.length;t-- >0;)e.canvasControls[t].draw(1)},executeEventScript:function(scriptText,scriptName,Sender){var Report=this;if(scriptText)try{eval(scriptText)}catch(e){alert("执行报表脚本 '"+scriptName+"' 失败"+(Sender.Name?"\n对象名称: "+Sender.Name:"")+"\n错误信息: "+e.toString()+"\n脚本代码:\n"+scriptText)}},fireInitialize:function(){var e=this;e.executeEventScript(e.InitializeScript,"InitializeScript",e),e.OnInitialize&&e.OnInitialize()},fireFetchRecord:function(){var e=this;e.executeEventScript(e.FetchRecordScript,"FetchRecordScript",e.DetailGrid.Recordset),e.OnFetchRecord&&e.OnFetchRecord()},fireBeforePostRecord:function(e){var t=this,r=t.DetailGrid.Recordset;t.executeEventScript(r.BeforePostRecordScript,"BeforePostRecordScript",r),t.OnBeforePostRecord&&t.OnBeforePostRecord()},fireBeforeSort:function(e,t){var r=this;r.executeEventScript(r.BeforeSortScript,"BeforeSortScript",t),r.OnBeforeSort&&t.isDetailGridRecordset()&&r.OnBeforeSort()},fireProcessBegin:function(){var e=this;e.executeEventScript(e.ProcessBeginScript,"ProcessBeginScript",e),e.OnProcessBegin&&e.OnProcessBegin()},fireProcessEnd:function(){var e=this;e.executeEventScript(e.ProcessEndScript,"ProcessEndScript"),e.OnProcessEnd&&e.OnProcessEnd()},fireGroupBegin:function(e){var t=this;t.executeEventScript(e.GroupBeginScript,"GroupBeginScript",e),t.OnGroupBegin&&t.OnGroupBegin(e)},fireGroupEnd:function(e){var t=this;t.executeEventScript(e.GroupEndScript,"GroupEndScript",e),t.OnGroupEnd&&t.OnGroupEnd(e)},fireProcessRecord:function(e){var t=this;t.executeEventScript(e.ProcessRecordScript,"ProcessRecordScript",e),t.OnProcessRecord&&t.OnProcessRecord()},fireSectionFormat:function(e){var t=this;t.executeEventScript(e.FormatScript,"FormatScript",e),t.OnSectionFormat&&t.OnSectionFormat(e)},fireFieldGetDisplayText:function(e){var t=this;t.executeEventScript(e.GetDisplayTextScript,"FieldGetDisplayTextScript",e),t.OnFieldGetDisplayText&&t.DetailGrid&&t.RunningDetailGrid.Recordset===e.owner&&t.OnFieldGetDisplayText(e)},fireTextBoxGetDisplayText:function(e){var t=this;t.executeEventScript(e.GetDisplayTextScript,"TextBoxGetDisplayTextScript",e),t.OnTextBoxGetDisplayText&&t.OnTextBoxGetDisplayText(e)},fireControlCustomDraw:function(e){},fireChartRequestData:function(e){var t=this;t.OnChartRequestData&&t.OnChartRequestData(e)},get Utility(){return gr.utility},ControlByName:function(e){function t(r){function o(r){function o(r){return r.FreeCell?t(r.Controls):r.DataName===e?r:null}for(var n,a,i,l,s=r.length;s--;)if(i=r[s])for(n=i.length;n--;)if(l=i[n],a=l?o(l):0)return a;return null}for(var n,a=r.items,i=a.length;i--;){if(n=a[i],n.Name===e)return n;if(13===n.ControlType&&(n=o(n.cells)))return n}return null}function r(e){return e.FreeCell?t(e.Controls):null}function o(e){for(var t,n,a=e.items.length;a--;)if(t=e.items[a],n=r(t),t.GroupTitle&&!n&&(n=o(t.SubTitles)),n)return n;return null}function n(e){for(var r=e.length;r--;)if(s=t(e[r].Controls))return s}var a,i,l,s,u=this;if(s=n(u.ReportHeaders.items)||n(u.ReportFooters.items))return s;if(u.DetailGrid){for(a=u.DetailGrid.Groups.items,i=a.length;i--;)if(l=a[i],s=t(l.GroupHeader.Controls)||t(l.GroupFooter.Controls))return s;for(a=u.DetailGrid.ColumnContent.ContentCells.items,i=a.length;i--;)if(s=r(a[i]))return s;return o(u.DetailGrid.ColumnTitle.TitleCells)}return null},ColumnByName:function(e){var t=this;return t.DetailGrid?t.DetailGrid.Columns.itemByName(e):null},FieldByName:function(e){return this.RunningFieldByName(e)},FieldByDBName:function(e){var t=this;return t.DetailGrid?t.RunningDetailGrid.Recordset.FieldByDBName(e):null},ParameterByName:function(e){return this.Parameters.itemByName(e)},FindFirstControl:function(){function e(e){e.FreeCell&&l.concat(e.Controls.items)}function t(r){r.forEach(function(r){e(r),r.GroupTitle&&t(r.SubTitles)})}var r,o,n,a=this,i=a.DetailGrid,l=[];for(o=a.ReportHeaders.Count,r=0;o>r;r++)l=l.concat(a.ReportHeaders.items[r].Controls.items);for(o=a.ReportFooters.Count,r=0;o>r;r++)l=l.concat(a.ReportFooters.items[r].Controls.items);if(i){for(o=i.Groups.Count,r=0;o>r;r++)n=i.Groups.items[r],l=l.concat(n.GroupHeader.Controls.items),l=l.concat(n.GroupFooter.Controls.items);i.ColumnContent.ContentCells.forEach(function(t){e(t)}),t(i.ColumnTitle.TitleCells)}return l.length>0&&(a.findControls=l,a.findControlIndex=-1),a.FindNextControl()},FindNextControl:function(){var e=this;return e.findControls&&(++e.findControlIndex,e.findControlIndex>=e.findControls.length&&(delete e.findControls,delete e.findControlIndex)),e.findControls?e.findControls[e.findControlIndex]:null},RunningFieldByName:function(e){var t=this;return t.DetailGrid?t.RunningDetailGrid.Recordset.FieldByName(e):null},PixelsToUnit:function(e){return this.pixel2Size(e)},UnitToPixels:function(e){return this.size2Pixel(e)},SystemVarValue:function(e){return this.SystemVarValue2(e,0)},SystemVarValue2:function(e,t){var r,o,n,a=this,i=a.RunningDetailGrid;if(1===e)r=new Date;else if(i)switch(o=i.Recordset,e){case 4:r=o.RecordNo+1;break;case 19:r=o.RecordCount;break;case 8:r=i.generatingRowNo+1;break;default:n=i.Groups.items[t-1],n&&(21===e?r=n.recordset.RecordCount:(n.inphaseByDetail(o.RecordNo),r=20===e?n.recordset.isAppendingRecord()?n.recordset.RecordCount:n.recordset.RecordNo:22===e?o.RecordNo-n.beginNoField.Value:n.endNoField.Value-n.beginNoField.Value,r++))}return r},AddParameter:function(e,t){var r=this.Parameters.Add();return r.Name=e,r.DataType=t,r},InsertDetailGrid:function(){var e=this;return e.DetailGrid||(e.DetailGrid=new DetailGrid(e),e.RunningDetailGrid=e.DetailGrid),e.DetailGrid},Clear:function(){var e=this;Report.call(e,e.viewer),e.DeleteDetailGrid()},DeleteDetailGrid:function(){var e=this;e.DetailGrid=null,e.RunningDetailGrid=null}};var csz_HTotal_Suffix="",csz_HAverage_Suffix="_hta",csz_HAverageA_Suffix="_htaa",csz_HCount_Suffix="_htc",csz_HCountA_Suffix="_htca",csz_HMin_Suffix="_htn",csz_HMax_Suffix="_htx",csz_HPercent_Suffix="_hp",csz_VPercent_Suffix="_vp",csz_HTotalPercent_Suffix="_htp",csz_VTotalPercent_Suffix="_vtp",csz_HTotalAverage_Tag="AVG",csz_CalendarReport_Tag="CALENDAR",HSummaryFlag=function(){this.Flag=0};HSummaryFlag.prototype={get CalcHTotal(){return 1&this.Flag},set CalcHTotal(e){var t=this;e?t.Flag|=1:t.Flag&=-2},get CalcHAverage(){return 2&this.Flag},set CalcHAverage(e){var t=this;e?t.Flag|=2:t.Flag&=-3},get CalcHAverageA(){return 4&this.Flag},set CalcHAverageA(e){var t=this;e?t.Flag|=4:t.Flag&=-5},get CalcHCount(){return 8&this.Flag},set CalcHCount(e){var t=this;e?t.Flag|=8:t.Flag&=-9},get CalcHCountA(){return 16&this.Flag},set CalcHCountA(e){var t=this;e?t.Flag|=16:t.Flag&=-17},get CalcHMin(){return 32&this.Flag},set CalcHMin(e){var t=this;e?t.Flag|=32:t.Flag&=-33},get CalcHMax(){return 64&self.Flag},set CalcHMax(e){var t=this;e?t.Flag|=64:t.Flag&=-65},onBySummaryFun:function(e){var t=this;t.CalcHTotal=!0,2===e?t.CalcHAverage=!0:15==e?t.CalcHAverageA=!0:3==e?t.CalcHCount=!0:13==e?t.CalcHCountA=!0:4==e?t.CalcHMin=!0:5==e&&(t.CalcHMax=!0)}};var DataFieldInfo=function(e){var t=this;t.originObject=null,t.HTotalFlag=new HSummaryFlag,t.HSubtotalFlag=new HSummaryFlag,t.MiscFlag=0,t.DatafieldIndex=-1,t.TotalValue=0,t.EntireTotalValue=0,e&&assignObjectEx(t,e,0)};DataFieldInfo.prototype={CopyAddField:function(e,t){var r=this,o=e.Fields.Add();return r.originObject.FieldType?(o.assign(r.originObject),r.originObject.isNumeric()&&(o.FieldType=3)):r.NumericField&&(o.FieldType=3,o.Format=r.originObject.textBuilder.items[0].format),o.Name=t,o.DBFieldName="",o},CombineCalcFlag:function(e){var t=this;t.HTotalFlag.Flag|=e.HTotalFlag.Flag,t.HSubtotalFlag.Flag|=e.HSubtotalFlag.Flag,t.MiscFlag|=e.MiscFlag},SetFlagBySummaryFun:function(e,t){var r=this;3===t?r.HSubtotalFlag.onBySummaryFun(e):r.HTotalFlag.onBySummaryFun(e)},get CalcHPercent(){return 1&this.MiscFlag},set CalcHPercent(e){var t=this;e?t.MiscFlag|=1:t.MiscFlag&=-2},get CalcVPercent(){return 2&this.MiscFlag},set CalcVPercent(e){var t=this;e?t.MiscFlag|=2:t.MiscFlag&=-3},get CalcTotalHPercent(){return 4&this.MiscFlag},set CalcTotalHPercent(e){var t=this;e?t.MiscFlag|=4:t.MiscFlag&=-5},get CalcTotalVPercent(){return 8&this.MiscFlag},set CalcTotalVPercent(e){var t=this;e?t.MiscFlag|=8:t.MiscFlag&=-9},get CalcHTotalExclude(){return 16&this.MiscFlag},set CalcHTotalExclude(e){var t=this;e?t.MiscFlag|=16:t.MiscFlag&=-17},get NumericField(){return 32&this.MiscFlag},set NumericField(e){var t=this;e?t.MiscFlag|=32:t.MiscFlag&=-33}};var HPercentSum=function(e,t){var r=this;r.Group=e,r.DataFieldInfo=t,r.DataSumBoxes=[]},DynamicTitleCellInfo=function(e){var t=this;t.PriorCrossTitleCell=null,t.OriginTextBox=e,t.PriorTitleText=""},CrossTab=function(e){var t=this;Object.call(t,e),t.HCrossFields="",t.VCrossFields="",t.ListCols=1,t.TotalCols=0,t.SubtotalCols=0,t.HResort=!0,t.HSortAsc=!0,t.VResort=!0,t.VSortAsc=!0,t.HTotalAtFirst=!1,t.HPercentColumns="",t.VPercentColumns="",t.TotalExcludeColumns="",t.TotalHPercentColumns="",t.TotalVPercentColumns="",t.PercentFormat="0.##%",t.HCrossPeriodType=0,t.BeginDateParameter="",t.EndDateParameter="",t.GroupAutoSum=!0};CrossTab.prototype={loadFromJSON:function(e){var t=this;e&&(Object.prototype.loadFromJSON.call(t,e),enumMemberValid(t,"HCrossPeriodType",grenum.PeriodType))},prepare:function(){function e(){var e=l.ParameterByName(i.BeginDateParameter),t=l.ParameterByName(i.EndDateParameter),r={};return e&&(r.begin=e.AsDateTime),t?(r.end=t.AsDateTime,e||(r.begin=cloneDate(r.end))):r.end=cloneDate(r.begin),r.end<r.begin&&(e=r.begin,r.begin=r.end,r.end=e),r}function t(){function t(){function e(e){var t=e.orderNo;return Y>t?1:X>t?2:Z>t?3:4}function t(t,r){function o(e){S.some(function(t){return t.originObject!==e.originObject?!1:(t.CombineCalcFlag(e),!0)})||(e.NumericField=e.originObject.isNumeric(),S.push(e))}function n(e,t){e?e.varItems.forEach(function(e){var r=e.varField;1===r.type&&(t.originObject=r.object,o(t))}):(t.originObject=S[0].originObject,o(t))}var a,i=new DataFieldInfo,l=e(r),s=1!==l,u=t.ControlType;4===l?(i.HTotalFlag.CalcHTotal=1,oe.indexOf(r)>=0&&(i.CalcHTotalExclude=1),te.indexOf(r)>=0&&(i.CalcTotalHPercent=1),re.indexOf(r)>=0&&(i.CalcTotalVPercent=1)):3==l?i.HSubtotalFlag.CalcHTotal=1:2==l&&(Q.indexOf(r)>=0&&(i.CalcHPercent=1),ee.indexOf(r)>=0&&(i.CalcVPercent=1),i.CalcHPercent&&(i.HTotalFlag.CalcHTotal=1)),4===u||7===u?s&&(i.originObject=t.oDataField,i.originObject&&o(i)):5===u?(i.SetFlagBySummaryFun(t.SummaryFun,l),n(t.paramExp,i)):12===u?s&&(i.originObject=t,S.push(i)):8===u&&(a=!1,t.textBuilder.forEach(function(e){e.varItems&&e.varItems.forEach(function(e){var t,r=e.varField;4===r.type?(t=new DataFieldInfo(i),t.SetFlagBySummaryFun(r.SummaryFun,l),n(r.paramExp,t),a=!0):1===r.type&&s&&(t=new DataFieldInfo(i),t.originObject=r.object,o(t))}),!a&&s&&(i.originObject=t,i.NumericField=t.isPureNumericExpression(),S.push(i))}))}function r(e){e.forEach(function(e){e.GroupTitle?r(e.SubTitles.items):e.Column.ContentCell.getControls().forEach(function(r){t(r,e.Column)})})}function o(r){r.Controls.forEach(function(r){var o=m.itemByName(r.AlignColumn)||m.itemByName(r.AlignColumnEx);o&&1!==e(o)&&t(r,o)})}r(C),g.forEach(function(e){o(e.GroupFooter),o(e.GroupHeader)}),a=0,S.forEach(function(e){e.DatafieldIndex=a,++a,e.CalcHPercent&&++a,e.CalcVPercent&&++a})}function r(){S.forEach(function(e){e.originObject.FieldType&&c.Fields.Remove(e.originObject.Name)})}function P(e){var t=c.Fields.Add();return t.Name=e,t.FieldType=3,t}function B(){function e(e){e.Controls.items=e.Controls.items.filter(function(e){var t=p.itemByName(e.AlignColumn)||p.itemByName(e.AlignColumnEx);return!t||t.orderNo<i.ListCols})}n.forEach(function(t){e(t.GroupFooter),e(t.GroupHeader)})}function A(e,t,r,o,a,f){function m(e,t){var r,o;e.FreeCell?(t.setFreeCell(!0),assignObjectAtom(t,e),e.Controls.forEach(function(e){function n(){return 2===i.HCrossPeriodType||3===i.HCrossPeriodType||4===i.HCrossPeriodType||6===i.HCrossPeriodType||7===i.HCrossPeriodType}function a(){function e(e){var t=new DateTime;return t.value=e,Math.floor(t.AsFloat)}var t,r=i.CurPeriodBeginDate.getFullYear(),o=i.CurPeriodBeginDate.getMonth()+1,n=i.CurPeriodBeginDate.getDate();switch(i.HCrossPeriodType){case 2:t="第"+Math.floor((e(i.CurPeriodBeginDate)-e(z.begin))/7+1)+"周";break;case 3:t=11>n?"上":21>n?"中":"下",t=o+"月"+t+"旬";break;case 4:t=16>n?"上":"下",t=o+"月"+t+"半月";break;case 6:t=intFixed(r,2)+"-"+(o+2)/3+"季度";break;case 7:t=7>o?"上":"下",t=intFixed(r,"00")+"-"+t+"半年"}return t}var s,u;r=e.ControlType,e.TextFormat?(o=t.Controls.Add(1),o.assign(e),s=n()&&4===r&&e.DataField===i.HCrossFields?a():e.getDisplayText(),o.Text=s):(o=t.Controls.Add(r),o.assign(e),7===r?e.DataField&&(o.DataField="",u=l.FieldByName(e.DataField),u&&(7==u.FieldType?o.Picture=u.Value:(s=u.DisplayText,o.ImageIndex=parseInt(s),isNaN(o.ImageIndex)&&(o.ImageIndex=0,o.ImageFile=s)))):12===r&&(o.Text=e.get_DisplayText()))})):t.assign(e)}function C(){var n,i,l=0;2===T&&(n=ne[f-q],i=n?n[o]:0,l=i&&i.PriorCrossTitleCell&&i.PriorTitleText===i.OriginTextBox.getDisplayText()&&!a),l?t=i.PriorCrossTitleCell:(t=(t?t.SubTitles:d).AddGroup("",""),m(e,t),t.Name=y,i&&(i.PriorCrossTitleCell=t,i.PriorTitleText=i.OriginTextBox.getDisplayText())),
e.SubTitles.forEach(function(e){A(e,t,r,o+1,!l,f)})}function x(){function o(e){var t;return S.some(function(r){return r.originObject.Name!==e?!1:(t=r,!0)}),t}function a(e,t){var r;return i.HPercentSums.some(function(o){return o.Group!==e||o.DataFieldInfo!==t?!1:(r=o,!0)}),r}function d(e,t){var o,n=CrossSummaryGetFieldSuffix(e);return 4===T||1===T?n?(t+=csz_HTotal_Suffix+n,o=t):E.CalcHPercent?(o=t+csz_HTotal_Suffix,t+=csz_HTotalPercent_Suffix):E.CalcVPercent?(t+=csz_VTotalPercent_Suffix,o=t):(t+=csz_HTotal_Suffix,o=t):3==T?(t+=r+n,o=t):(t+=r,o=t,E.CalcHPercent?t+=csz_HPercent_Suffix:E.CalcVPercent&&(t+=csz_VPercent_Suffix,o=t)),o=ensureNameText(o),{DataField:t,SummaryDataField:o}}function f(e,t){var r,o=0,n="";return e.varItems.forEach(function(a){o<a.beginIndex&&(n+=e.expText.substring(o,a.beginIndex)),1===a.varField.type?(r=d(t,a.varField.object.Name),n+=r.SummaryDataField):n+=a.varField.getExpText(),o=a.endIndex}),n+=e.expText.substring(o)}function C(e,t){return e="[#"+e,t&&(e+=":"+t),e+="#]"}function x(e,t){var r,o=0,n="";return e.varItems.forEach(function(a){var i=a.varField,l=i.type;o<a.beginIndex&&(n+=e.expText.substring(o,a.beginIndex)),4===l?(r=f(i.paramExp,i.SummaryFun),n+=t?enumValue2Name(grenum.SummaryFun,i.SummaryFun)+"("+r+(i.RankNo?","+i.RankNo:"")+")":r):n+=i.getExpText(),o=a.endIndex}),n+=e.expText.substring(o)}function b(){n.forEach(function(e,t){function r(e,t){t.isToGenerate()&&e.Controls.forEach(function(e){var r,o,n,a=e.ControlType,i=e.AlignColumn||e.AlignColumnEx;i===A.Name&&(r=t.Controls.Add(a),r.assign(e),r.AlignColumn=B.Name,r.AlignColumnEx="",5===a?e.DataField&&(r.DataField=f(e.paramExp,e.SummaryFun),r.Tag=e.DataField,s.push(r)):8===a?(o="",e.textBuilder.forEach(function(e){o+=e.varItems?C(x(e,!0),e.format):e.text}),r.Text=o):4===a&&(n=l.FieldByName(r.DataField),n&&(r.DataField=d(0,originFieldName).SummaryDataField)))})}var n,s=[];n=g[t],r(n.GroupFooter,e.GroupFooter),r(n.GroupHeader,e.GroupHeader),s.forEach(function(t){var r,n;E.CalcHPercent&&(t.Format=i.PercentFormat,r=o(t.Tag),n=a(e,r),n||(n=new HPercentSum(e,r),i.HPercentSums.push(n)),P?n.TotalSumBox=t:n.DataSumBoxes.push(t))})})}var v,F,w=1!==T,D=i.GroupAutoSum&&w,P=r===csz_HTotal_Suffix,B=p.addTo(t?t.SubTitles:u.ColumnTitle.TitleCells),A=e.Column,E=new DataFieldInfo;B.assign(A),B.Name=y,m(e,B.TitleCell),B.ContentCell.assign(A.ContentCell),v=B.ContentCell.getControls(),F=1===v.length,P?(te.indexOf(A)>=0&&(E.CalcHPercent=1),re.indexOf(A)>=0&&(E.CalcVPercent=1)):(Q.indexOf(A)>=0&&(E.CalcHPercent=1),ee.indexOf(A)>=0&&(E.CalcVPercent=1)),v.forEach(function(e,t){function l(t){n.forEach(function(r,n){function l(e,t){return e.isToGenerate()&&e.Controls.items.some(function(e){return e.AlignColumn===t.Name||e.AlignColumnEx===t.Name})}function s(r){var o,n,a,i;return r.isToGenerate()&&(o=r.Controls.Add(5),o.assign(e),o.Dock=0,o.TextAlign=e.TextAlign,o.AlignColumn=B.Name,o.DataField=t.summaryDataField,h.ShowColLine&&(n=o.Border,n.Styles|=4,a=h.ColLinePen.Width,i=e.Border,i&&4&i.Styles&&i.Pen.Width>0?a+=i.Pen.Width:n.Pen.Color=h.ColLinePen.Color,n.Pen.Width=a),F?(o.Top=0,o.Height=r.Height,16777215!==B.ContentCell.BackColor&&16777215===r.BackColor&&(o.BackStyle=1,o.BackColor=B.ContentCell.BackColor)):(o.Top=e.Top,o.Height=e.Height,1===e.BackStyle()&&(o.BackStyle=1,o.BackColor=e.BackColor))),o}var u,c,d,p=g[n];l(p.GroupFooter,A)||l(p.GroupHeader,A)||(u=s(r.GroupFooter),u||(u=s(r.GroupHeader)),u&&(u.Format=t.format,E.CalcHPercent&&(u.Format=i.PercentFormat,c=o(t.originDataField),d=a(r,c),d||(d=new HPercentSum(r,c),i.HPercentSums.push(d)),P?d.TotalSumBox=u:d.DataSumBoxes.push(u))))})}function u(){var r,o,n=e.DataField,a=e.SummaryFun;5===m&&(n||(n=S[0].originObject.Name),o=e.Format,B.ContentCell.Controls?(e=new FieldBox(B.ContentCell),e.assign(v[t]),B.ContentCell.Controls.items[t]=e):B.ContentCell.assign(v[t])),f=d(a,n),e.DataField=f.DataField,7!==m&&(o&&(r=c.Fields.Item(f.DataField),r&&(r.Format=o)),D&&l({summaryDataField:f.SummaryDataField,originDataField:n,format:""}))}function p(){var o,n,a,i,u=!1;u=s&&k(e,r),u||(n=A.ContentCell.getControls()[t],o=(a=n.textBuilder.items[0])&&a.varItems.some(function(e){return 4===e.varField.type}),o?(i=x(a,!1),e.Text=C(i,a.format),D&&l({summaryDataField:ensureNameText(i),originDataField:"",format:a.format})):w&&(f=d(0,e.Name),e.Text="[#"+f.DataField+"#]",D&&l({summaryDataField:f.SummaryDataField,originDataField:e.Name,format:""})))}var f,m=e.ControlType;4===m||5===m||7===m?u():12===m?1!==T&&(f=d(e.Name,0),e.Text="[#"+f.DataField+"#]"):8===m&&p()}),w&&b()}var y=e.Name+(r?r:""),T=CrossColumnKindByOrderNoText(r);e.GroupTitle?C():x()}function E(){var e=f.Fields;c.Fields.forEach(function(t){b.push({crossField:t,originField:e.itemByName(t.Name)})})}function R(){S.forEach(function(e){function t(e,t,o){r=e.CopyAddField(c,t+o),r.GetDisplayTextScript="",v.push(r)}var r,o=e.HTotalFlag,n=e.originObject.Name;o.CalcHTotal&&t(e,n,csz_HTotal_Suffix),o.CalcHAverage&&t(e,n,csz_HAverage_Suffix),o.CalcHAverageA&&t(e,n,csz_HAverageA_Suffix),o.CalcHCount&&t(e,n,csz_HCount_Suffix),o.CalcHCountA&&t(e,n,csz_HCountA_Suffix),o.CalcHMin&&t(e,n,csz_HMin_Suffix),o.CalcHMax&&t(e,n,csz_HMax_Suffix),e.CalcTotalHPercent&&(r=P(n+csz_HTotalPercent_Suffix),r.Format=i.PercentFormat,v.push(r)),e.CalcTotalVPercent&&(r=P(n+csz_VTotalPercent_Suffix),r.Format=i.PercentFormat,v.push(r))})}function L(){var e=C.length;for(o=$;e>o;o++)A(C[o],null,csz_HTotal_Suffix,0,!0,-1)}function M(e){var t,r=e.getControls();e.GroupTitle&&1===r.length&&(t=r[0],t.TextFormat&&(ne[ne.length-1].push(new DynamicTitleCellInfo(t)),1===e.SubTitles.items.length&&M(e.SubTitles.items[0])))}function V(){var e=[];i.HResort&&x.forEach(function(t){e.push({field:t,asc:i.HSortAsc,"case":1})}),W=f.sortRecords(e,1)}function G(e){var t,r;for(t="_"+e,x.forEach(function(e){r=c.Fields.Add(),r.assign(e),r.Name+=t,r.DBFieldName="",F.push(r)}),S.forEach(function(e){var o=e.originObject.Name+t;v.push(e.CopyAddField(c,o)),e.CalcHPercent&&(r=P(o+csz_HPercent_Suffix),r.Format=i.PercentFormat,v.push(r)),e.CalcVPercent&&(r=P(o+csz_VPercent_Suffix),r.Format=i.PercentFormat,v.push(r))}),o=q;K>o;o++)A(C[o],null,t,0,!1,o)}function N(){function e(){var e;return C[q].GroupTitle&&1===ne.length&&ne[0].length>=1&&(e=ne[0][0]).PriorCrossTitleCell&&e.PriorTitleText!==e.OriginTextBox.getDisplayText()}function t(){var e,t;for(w.push(T),e="_S"+w.length,S.forEach(function(r){t=r.originObject.Name+e,D.push(r.CopyAddField(c,t+csz_HTotal_Suffix)),r.HSubtotalFlag.CalcHAverage&&D.push(r.CopyAddField(c,t+csz_HAverage_Suffix)),r.HSubtotalFlag.CalcHAverageA&&D.push(r.CopyAddField(c,t+csz_HAverageA_Suffix)),r.HSubtotalFlag.CalcHCount&&D.push(r.CopyAddField(c,t+csz_HCount_Suffix)),r.HSubtotalFlag.CalcHCountA&&D.push(r.CopyAddField(c,t+csz_HCountA_Suffix)),r.HSubtotalFlag.CalcHMin&&D.push(r.CopyAddField(c,t+csz_HMin_Suffix)),r.HSubtotalFlag.IsCalcHMax&&D.push(r.CopyAddField(c,t+csz_HMax_Suffix))}),o=K;$>o;o++)A(C[o],null,e,0,!1,-1)}W.forEach(function(r,o){(r<i.VAddedItemRecordOffsetBegin||r>=i.VAddedItemRecordOffsetEnd)&&(f.MoveTo(r),o&&!f.fieldsKeepedValueChanged(x)||(i.SubtotalCols>0&&o&&e()&&(f.MoveTo(W[o-1]),t(),f.MoveTo(r)),f.keepValue(),G(++T)),f.curRecord._CrossNo_=T)}),i.SubtotalCols>0&&t()}function H(){function t(){function t(){function t(e,t){function r(){11>s?++s:(++u,s=0)}var o=z.begin.getDate(),n=z.begin.getMonth(),a=z.begin.getFullYear(),l=o,s=n,u=a;switch(i.HCrossPeriodType){case 3:10>=o?(o=1,l=11):20>=o?(o=11,l=21):(o=21,r(),l=1);break;case 4:15>=o?(o=1,l=16):(o=16,r(),l=1);break;case 5:o=l=1,r();break;case 6:o=l=1,n-=n%3,s=n,r(),r(),r();break;case 7:o=l=1,n=6>n?0:6,s=6>n?6:0,s||u++;break;case 8:o=l=1,n=s=0,u++}i.CurPeriodBeginDate=new Date(a,n,o),i.CurPeriodEndDate=new Date(u,s,l)}return z=e(),strimDate(z.begin),strimDate(z.end),incDate(z.end),i.HCrossPeriodType<=2?(i.CurPeriodBeginDate=cloneDate(z.begin),i.CurPeriodEndDate=cloneDate(z.begin),incDate2(i.CurPeriodEndDate,1===i.HCrossPeriodType?1:7)):t(),i.CurPeriodBeginDate<z.end}function r(){function e(){11>a?++a:(++l,a=0)}var t=i.CurPeriodBeginDate.getDate(),r=i.CurPeriodBeginDate.getMonth(),o=i.CurPeriodBeginDate.getFullYear(),n=t,a=r,l=o;switch(i.HCrossPeriodType){case 3:10>=t?(t=11,n=21):20>=t?(t=21,n=1,e()):(t=1,n=11,e(),o=l,r=a);break;case 4:15>=t?(t=16,n=1,e()):(t=1,n=16,e(),o=l,r=a);break;case 5:e(),o=l,r=a,e();break;case 6:e(),e(),e(),o=l,r=a,t=n,e(),e(),e();break;case 7:r?(r=0,o++,a=6):(r=6,a=0),l++;break;case 8:o++,l++,l++}i.CurPeriodBeginDate=new Date(o,r,t),i.CurPeriodEndDate=new Date(l,a,n)}return z?(i.HCrossPeriodType<=2?(i.CurPeriodBeginDate=cloneDate(i.CurPeriodEndDate),incDate2(i.CurPeriodEndDate,1===i.HCrossPeriodType?1:7)):r(),i.CurPeriodBeginDate<z.end):t()}for(var r,o,n=W.length,a=0;t();)for(r=x[0].AsDateTime,x[0].AsDateTime=i.CurPeriodBeginDate,G(++T),x[0].AsDateTime=r;n>a&&(f.MoveTo(W[a]),o=x[0].AsDateTime,!(o<i.CurPeriodBeginDate||o>=i.CurPeriodEndDate));)f.curRecord._CrossNo_=T,a++}function I(){i.HPercentSums.forEach(function(e){function t(e){e.isToGenerate()&&(r=e.Controls.Add(5),r.DataField=o)}var r,o;e.TotalSumBox||(o=e.DataFieldInfo.originObject.Name+csz_HTotal_Suffix,t(e.Group.GroupFooter),r||t(e.Group.GroupHeader),r.Visible=!1,e.TotalSumBox=r)})}function O(){var e=v.splice(0,_);v=v.concat(e)}function k(e,t){var r,o=e.Text,n=o.indexOf(":");return n>0&&o.substring(2,n)===x[0].Name?(r="G"===t?"[#"+J:o.substring(0,n)+t,r+=o.substring(n),e.Text=r,1):0}function j(){function e(){var e,t=x[0],r=new Date(2009,7,30),o=t.AsDateTime;for(e=0;7>e;++e)t&&(t.AsDateTime=r),G(++T),incDate(r);t.AsDateTime=o}function t(e){var t=x[0];e.Controls.forEach(function(e){4===e.ControlType?t.Name===e.DataField&&(e.DataField=J):8===e.ControlType&&k(e,"G")})}var r,o,n=u.Groups.items[0];e(),n&&(r=c.Fields.Add(),r.FieldType=2,r.Name=U,y.push(r),n.ByFields=U,r=c.Fields.Add(),r.FieldType=6,r.Format=x[0].Format,r.Name=J,y.push(r),t(n.GroupHeader),t(n.GroupFooter)),m.Count>1&&(o=m.items[1].ContentCell.BackColor,p.Item(1).ContentCell.BackColor=o,p.Item(7).ContentCell.BackColor=o)}var _,W,z,U="_Month_",J="_Date_",Y=0,X=1,Z=1,q=-1,K=-1,$=-1,Q=[],ee=[],te=[],re=[],oe=[],ne=[];if(s){if(i.GroupAutoSum=!1,f.Fields.forEach(function(e){6===e.FieldType&&x.push(e)}),!x.length)throw new Error("None date field!")}else{if(Q=m.decodeItems(i.HPercentColumns),ee=m.decodeItems(i.VPercentColumns),te=m.decodeItems(i.TotalHPercentColumns),re=m.decodeItems(i.TotalVPercentColumns),oe=m.decodeItems(i.TotalExcludeColumns),x=f.decodeFields(i.HCrossFields),!x.length)throw new Error("生成交叉表不成功，没有定义'横向交叉数据字段'！");y=f.decodeFields(i.VCrossFields),Y=i.ListCols,Z=m.Count-i.TotalCols,X=Z-i.SubtotalCols}if(K=C.length,$=K,C.forEach(function(e,t){var r=e.findFirstColumn().orderNo;r===Y&&(q=t),r===X&&(K=t),r===Z&&($=t)}),t(),r(),u.clearColumns(),s)j();else{if(!S.length)throw new Error("生成交叉表不成功，不存在交叉数据项！");if(0>=q)throw new Error("生成交叉表不成功，不存在交叉数据列！");for(u.buildColumnsOrder(),V(),B(),o=0;q>o;++o)A(C[o],null,null,0,!0,-1);for(E(),R(),_=v.length,i.HTotalAtFirst&&L(),o=q;K>o;o++)ne.push([]),M(C[o]);0===i.HCrossPeriodType?N():H(),i.HTotalAtFirst||L(),_>0&&O(),I()}}function r(){function t(){var e=[];i.VResort&&(y.forEach(function(t){e.push({field:t,asc:i.VSortAsc,"case":1})}),x.forEach(function(t){e.push({field:t,asc:i.HSortAsc,"case":1})})),d=f.sortRecords(e,1)}function r(e,t){x.forEach(function(t,r){var o=x.length*e+r;F[o].IsNull&&(F[o].Value=t.Value)}),S.forEach(function(r,o){var n,i=a*e+r.DatafieldIndex;r.NumericField?(n=r.originObject.AsFloat,v[i].AsFloat+=n,r.CalcHTotalExclude&&r.TotalValue||(r.TotalValue+=n,t&&(t[e*S.length+o]+=n))):v[i].IsNull&&(v[i].Value=r.originObject.Value)})}function o(){c.Append(),b.forEach(function(e){e.crossField.Value=e.originField.Value}),S.forEach(function(e){e.TotalValue=0})}function n(){function e(e,t,i,l,s){function u(){var s,u,c=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(r=e;t>r;++r)s=v[a*r+i.DatafieldIndex],s.IsNull||(u=s.AsFloat,isNaN(u)||(c>u&&(c=u),u>d&&(d=u)));l.CalcHMin&&(c<Number.MAX_VALUE&&(n[o].AsFloat=c),o++),l.CalcHMax&&(d>-Number.MAX_VALUE&&(n[o].AsFloat=d),o++)}var c=t-e,d=c;if(l.CalcHAverageA||l.CalcHCountA)for(r=e;t>r;r++)v[a*r+i.DatafieldIndex].IsNull&&--d;n[o].AsFloat=s,o++,l.CalcHAverage&&(c>0&&(n[o].AsFloat=s/c),o++),l.CalcHAverageA&&(d>0&&(n[o].AsFloat=s/d),o++),l.CalcHCount&&(n[o].AsFloat=c,o++),l.CalcHCountA&&(n[o].AsFloat=d,o++),(l.CalcHMin||l.CalcHMax)&&u()}function t(){var t=D.length/w.length,i=0;w.forEach(function(l,s){var u=createArray(S.length,0);for(r=i;l>r;++r)S.forEach(function(e,t){u[t]+=v[a*r+e.DatafieldIndex].AsFloat});n=D,o=t*s,S.forEach(function(t,r){e(i,l,t,t.HSubtotalFlag,u[r])}),i=l})}var r,o=a*T,n=v;for(S.forEach(function(t){t.HTotalFlag.Flag&&(e(0,T,t,t.HTotalFlag,t.TotalValue,v),t.CalcTotalHPercent&&(n[o].AsFloat=1,o++),t.CalcTotalVPercent&&o++,t.EntireTotalValue+=t.TotalValue)}),r=0;T>r;++r)S.forEach(function(e){e.CalcHPercent&&(o=a*r+e.DatafieldIndex,0!=e.TotalValue?v[o+1].AsFloat=v[o].AsFloat/e.TotalValue:v[o+1].Clear())});w.length&&t(),c.Post()}function l(){var e,t,r,o,n,i,l;for(c.First();!c.Eof();){for(c.Edit(),e=0,t=0,r=0,o=0;T>o;++o)S.forEach(function(r,s){r.CalcVPercent&&(n=a*o+r.DatafieldIndex,i=v[n].AsFloat,l=p[o*S.length+s],r.CalcHPercent&&++n,++n,l&&(v[n].AsFloat=i/l),e+=i,t+=l)}),o===w[r]&&(S.forEach(function(o){o.CalcVPercent&&(n=a*r+o.DatafieldIndex+1+(o.CalcHPercent?1:0),t&&(D[n].AsFloat=e/t))}),r++);n=a*T,S.forEach(function(e){var t=e.HTotalFlag;i=v[n].AsFloat,t.CalcHTotal&&++n,t.CalcHAverage&&++n,t.CalcHAverageA&&++n,t.CalcHCount&&++n,t.CalcHCountA&&++n,t.CalcHMin&&++n,t.CalcHMax&&++n,e.CalcTotalHPercent&&++n,e.CalcTotalVPercent&&(e.EntireTotalValue&&(v[n].AsFloat=i/e.EntireTotalValue),++n)}),c.Post(),c.Next()}}function u(){var t,a,i,l,s=e(),u=[],c=0;for(u.push({field:x[0],asc:1,"case":1}),d=f.sortRecords(u,1),t=d.length;s.begin<=s.end;){for(;t>c&&(f.MoveTo(d[c]),!(x[0].AsDateTime>=s.begin));)c++;for(a=s.begin.getDay(),i=s.begin.getMonth(),o(),y.length&&(y[0].AsInteger=i+1,y[1].AsDateTime=s.begin),l=a;7>l;++l){for(F[l].AsDateTime=s.begin;t>c&&(f.MoveTo(d[c]),!(x[0].AsDateTime>s.begin));)r(l,null),c++;if(incDate(s.begin),s.begin>s.end||y.length&&i!==s.begin.getMonth())break}n()}}var d,p=createArray(T*S.length,0);s?u():(t(),d.forEach(function(e,t){(e<i.HAddedItemRecordOffsetBegin||e>=i.HAddedItemRecordOffsetEnd)&&(f.MoveTo(e),t&&!f.fieldsKeepedValueChanged(y)||(f.keepValue(),t&&n(),o())),f.curRecord._CrossNo_&&r(f.curRecord._CrossNo_-1,p)}),n(),S.some(function(e){return e.CalcVPercent||e.CalcTotalVPercent})&&l())}var o,n,a,i=this,l=i.report,s=9===i.HCrossPeriodType,u=new DetailGrid(l),c=u.Recordset,d=u.ColumnTitle.TitleCells,p=u.Columns,h=i.owner,f=h.Recordset,m=h.Columns,g=h.Groups.items,C=h.ColumnTitle.TitleCells.items,x=[],y=[],T=0,S=[],b=[],v=[],F=[],w=[],D=[];i.HAddedItemRecordOffsetBegin=-1,i.HAddedItemRecordOffsetEnd=-1,i.VAddedItemRecordOffsetBegin=-1,i.VAddedItemRecordOffsetEnd=-1,i.HPercentSums=[],u.assign(h),u.IsCrossTab=0,n=u.Groups.items,t(),r(),l.RunningDetailGrid=u,u.attachControlsData(),u.prepare()},GroupEndProcess:function(e){var t=this;t.HPercentSums.forEach(function(t){var r;t.Group===e&&(r=t.TotalSumBox.Value,t.DataSumBoxes.forEach(function(e){r?e.Value/=r:e.Value=0}),t.TotalSumBox.Value=1)})}},prototypeCopyExtend(CrossTab,Object);var BubbleCircleCoverRatio=.25,PixelsPerCm=96/2.54,ChartSeriesColorArray=[3381606,39423,16737996,3394764,10079232,6737100,10040319,3407718,16737843,13421568,6723993,14535833,3342489,8965273,13369497,14535833,13395507,10092424,10066278,14522879],ChartSeriesColorCount=ChartSeriesColorArray.length,SCALELINE_WEIGHT=4,BIG_GAP=8,SMALL_GAP=4,CalcNearestAlignInt=function(e,t){var r,o,n=0;for(e>=1&&(t=0),r=0;t>r;r++)e*=10;for(o=e;o>1;)++n,o/=10;if(o=.15>o?.1:.3>o?.2:.75>o?.5:1,t>0&&(n-=t),n>0)for(r=0;n>r;r++)o*=10;else for(r=n;0>r;r++)o/=10;return o},ChartSeriesCollection=function(e){Collection.call(this,e)};prototypeLinkExtend(ChartSeriesCollection,Collection),ChartSeriesCollection.prototype._createItem=function(){return new ChartSeries(this.owner)};var ChartShape=function(e,t){var r=this;r.seriesIndex=e,r.groupIndex=t},ChartRect=function(e,t,r){var o=this;ChartShape.call(o,e,t),o.rect=r};ChartRect.prototype={inRange:function(e,t){return this.rect.PtInRect(e,t)},tooltipPos:function(){var e=this.rect;return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}};var ChartPie=function(e,t,r,o,n,a,i){var l=this;ChartShape.call(l,e,t),l.x=r,l.y=o,l.r=n,l.beginAngle=a,l.endAngle=i};ChartPie.prototype={inRange:function(e,t){function r(){var r=e-o.x,n=t-o.y,a=Math.sqrt(r*r+n*n),i=Math.atan2(n,r);return 0>n&&(i+=2*Math.PI),{angle:360-toDegree(i),distance:a}}var o=this,n=r();return o.beginAngle<=n.angle&&n.angle<o.endAngle&&n.distance<o.r},tooltipPos:function(){var e=this,t=-toRadians(e.beginAngle+e.endAngle)/2,r=e.r/2;return{x:e.x+Math.cos(t)*r,y:e.y+Math.sin(t)*r}}};var ChartPoint=function(e,t,r,o,n){var a=this;ChartShape.call(a,e,t),a.x=r,a.y=o,a.r=n};ChartPoint.prototype={inRange:function(e,t){var r=this,o=e-r.x,n=t-r.y;return Math.sqrt(o*o+n*n)<=r.r},tooltipPos:function(){var e=this;return{x:e.x+4,y:e.y-4-Chart.prototype.options.tooltipFontSize}}};var ChartAxis=function(e){var t=this;Object.call(t,e),t.LinePen=new Pen,t.CoordLinePen=new Pen,t.Label="",t.Max=0,t.Min=0,t.Space=0,t.TextAngle=0,t.TextVisible=!0,t.TextFormat="0.##",t.LineVisible=!0,t.CoordLineVisible=!1,t.MarginBeginWeight=25,t.MarginEndWeight=25,t.Scales=[],t.CustomCoordLines=[]};ChartAxis.prototype={children:["LinePen","CoordLinePen"],afterLoad:function(e){var t=this;t.LinePen.loadFromJSON(e.LinePen,t.report.viewer.alpha.chartStroke),t.CoordLinePen.loadFromJSON(e.CoordLinePen,t.report.viewer.alpha.chartStroke)},CalcLabelHeight:function(){var e=this;return e.Label?e.owner.fontHeight+SMALL_GAP/2:0},CalcHorzAxisHeight:function(e){return this.DoCalcAxisSize(!0,e)},CalcVertAxisWidth:function(){return this.DoCalcAxisSize(!1,!1)},DoCalcAxisSize:function(e,t){var r,o=this,n=o.owner,a=[],i=o.owner.fontHeight,l=0;if(o.Used){if(o.TextVisible&&(!e||!n.IsDrawNegativeGraph())){if(t)a.push("1Agf");else if(o.IsValueAxis)if(o.Scales.length)o.Scales.forEach(function(e){a.push(e.Text)});else for(r=o.DrawMin;r<o.DrawMax+o.GetScaleTiny();r+=o.DrawSpace)a.push(o.ScaleFormatParser.format(r));else for(r=0;r<n.GroupCount;r++)a.push(n.GroupLabels[r]);-270===o.TextAngle?(a.forEach(function(e){l=Math.max(l,e.length)}),l*=i):(a.forEach(function(e){l=Math.max(l,n.context.measureTextWidth(e))}),e&&(l=Math.abs(Math.sin(toRadians(o.TextAngle))*l)+1+i))}o.LineVisible&&(l+=SCALELINE_WEIGHT),l&&(l+=SMALL_GAP)}return l},CalcGroupPos:function(e,t){var r=this,o=r.owner,n=o.IsHorzGraph()?o.CalcColumnBarCount():o.CalcBarCount(),a=r.MarginBeginWeight+r.MarginEndWeight+100*(o.GroupCount-1)+(n>0?o.BarWidthPercent:0),i=a?e*r.MarginBeginWeight/a:0,l=a?e*r.MarginEndWeight/a:0,s=e-i-l,u=n>0?o.BarWidthPercent:0,c=100*t,d=c+u,p={};return a-=r.MarginBeginWeight+r.MarginEndWeight,p.BeginPos=i,p.EndPos=i,a>0&&(p.BeginPos+=s*c/a,p.EndPos+=s*d/a),p.LabelMiddlePos=(p.BeginPos+p.EndPos)/2,p},DrawHorzAxisLabel:function(e){var t=this,r=t.owner.context;!e.IsRectEmpty()&&t.Label&&r.drawText(t.Label,(e.left+e.right-r.measureTextWidth(t.Label))/2,(e.top+e.bottom-t.owner.fontHeight)/2)},DrawVertAxisLabel:function(e){var t=this,r=t.owner.context;!e.IsRectEmpty()&&t.Label&&r.drawTextRotate(t.Label,(e.left+e.right-t.owner.fontHeight)/2,(e.top+e.bottom+r.measureTextWidth(t.Label))/2,90)},DrawAxisTextsPrepare:function(e){var t,r=this,o=r.owner,n=[];if(r.IsValueAxis)if(r.Scales.length)r.Scales.forEach(function(t){n.push({text:t.Text,pos:r.CalcValuePos(t.PosVal,e)})});else for(t=r.DrawMin;t<r.DrawMax+r.GetScaleTiny();t+=r.DrawSpace)n.push({text:r.ScaleFormatParser.format(t),pos:r.CalcValuePos(t,e)});else for(t=0;t<o.GroupCount;t++)n.push({text:o.GroupLabels[t]||"",pos:r.CalcGroupPos(e,t).LabelMiddlePos});return n},DrawHorzAxis:function(e,t,r){var o,n=this,a=n.owner,i=a.context,l=e.Width()-a.xView3DDepth,s=a.IsDrawNegativeGraph(),u=n.IsValueAxis,c=n.LinePen.clone();c.Width=.5,e.IsRectEmpty()||(n.LineVisible&&(i.SelectPen(n.LinePen),i.DrawHorzLine(r?e.bottom-1:e.top,e.left,e.left+l),a.Chart3DReal&&i.drawPolyLine([e.left+l,e.top,e.left+l+a.xView3DDepth,e.top-a.yView3DDepth,e.left+a.xView3DDepth,e.top-a.yView3DDepth,e.left+a.xView3DDepth,t.top,e.left+l+a.xView3DDepth,t.top,e.left+l+a.xView3DDepth,e.top-a.yView3DDepth],0),i.RestorePen()),i.SelectPen(c),o=n.DrawAxisTextsPrepare(l),o.forEach(function(o,l){var c,d,p=a.IsScatterGraph()||!s||(n.IsValueAxis?o.PosVal>=0:a.values[0][l]>=0);n.LineVisible&&(r?(d=e.bottom-1,c=d-SCALELINE_WEIGHT):(c=e.top+1,d=p?e.top+1+SCALELINE_WEIGHT:e.top+1-SCALELINE_WEIGHT),i.DrawVertLine(e.left+o.pos,c,d)),n.TextVisible&&n.DrawHorzAxisText(e,o.pos,o.text,r,p),n.CoordLineVisible&&!u&&n.IsValueAxis&&(i.SelectPen(n.CoordLinePen),i.DrawVertLine(e.left+o.pos,t.top+1,t.bottom),i.RestorePen()),u=!1}),i.RestorePen(),n.CustomCoordLines.forEach(function(o){var a=n.CalcValuePos(o.PosVal,l);o.Text||DrawHorzAxisText(e,a,o.Text,r,!0),i.SelectPen(o.LinePen),i.DrawVertLine(e.left+a,t.top+1,t.bottom),i.RestorePen()}))},DrawHorzAxisText:function(e,t,r,o,n){var a,i,l,s,u=this,c=u.owner.context,d=r.length,p=u.owner.fontHeight;if(o?(i=e.bottom-1,u.LineVisible&&(i-=SCALELINE_WEIGHT)):(i=e.top+1,u.LineVisible&&(i+=SCALELINE_WEIGHT)),-270===u.TextAngle)for(s=c.measureTextWidth("A"),a=e.left+t-s,o&&(i-=p*d),l=0;d>l;l++)c.drawText(r.charAt(l),a,i),i+=p;else s=c.measureTextWidth(r),a=e.left+t-Math.abs(s/2*Math.cos(toRadians(u.TextAngle)))+Math.abs(p/2*Math.sin(toRadians(u.TextAngle))),o&&(i-=p),n||(i-=p+2*SCALELINE_WEIGHT-1),c.drawTextRotate(r,a,i,u.TextAngle)},DrawVertAxis:function(e,t,r){var o,n,a=this,i=a.owner,l=i.context,s=e.Height()-i.yView3DDepth,u=a.LinePen.clone();u.Width=.5,!e.IsRectEmpty()&&a.Used&&(a.LineVisible&&(l.SelectPen(a.LinePen),o=r?e.left:e.right,l.DrawVertLine(o,e.bottom-s,e.bottom+1),i.Chart3DReal&&(l.DrawVertLine(e.right,e.bottom-s,e.bottom),l.drawPolyLine([e.right,e.bottom,e.right+i.xView3DDepth,e.bottom-i.yView3DDepth,e.right+i.xView3DDepth,e.bottom-i.yView3DDepth-s,e.right,e.bottom-s],0)),l.RestorePen()),n=a.DrawAxisTextsPrepare(s),n.forEach(function(o,n){var s,c,d=a.IsValueAxis?e.bottom-o.pos:e.top+o.pos,p=new Pen;p.Width=.5,p.Color=rgba2color(128,128,128,a.report.viewer.alpha.chartStroke),a.LineVisible&&o.pos!=a.DrawMin&&(s=e.right-SCALELINE_WEIGHT,c=e.right,r&&(s=e.left,c=e.left+SCALELINE_WEIGHT),l.SelectPen(u),l.DrawHorzLine(d,s,c),l.RestorePen(),i.Chart3DReal&&(l.SelectPen(p),l.drawLine(e.right,d,e.right+i.xView3DDepth,d-i.yView3DDepth),l.RestorePen())),a.TextVisible&&a.DrawVertAxisText(e,d,o.text,r),a.CoordLineVisible&&a.IsValueAxis&&(l.SelectPen(a.CoordLinePen),l.DrawHorzLine(d-i.yView3DDepth,t.left+i.xView3DDepth+a.LinePen.Width,t.right),l.RestorePen())}),a.CustomCoordLines.forEach(function(o){var n=e.bottom-a.CalcValuePos(o.PosVal,s);o.Text&&a.DrawVertAxisText(e,n,o.Text,r),l.SelectPen(o.LinePen),l.DrawHorzLine(n-i.yView3DDepth,t.left+i.xView3DDepth+a.LinePen.Width,t.right),l.RestorePen()}))},DrawVertAxisText:function(e,t,r,o){var n=this,a=n.owner.context,i=a.measureTextWidth(r),l=e.right-i;n.LineVisible&&(l-=SCALELINE_WEIGHT),o&&(l=e.left,n.LineVisible&&(l+=SCALELINE_WEIGHT)),a.drawText(r,l,t-n.owner.fontHeight/2)},PrepareDraw:function(){var e=this;e.Used=!1,e.IsValueAxis=!1,e.DrawMax=-Number.MAX_VALUE,e.DrawMin=Number.MAX_VALUE,e.DrawSpace=0,e.ScaleFormatParser=new grformat.NumericFormatter(e.TextFormat)},PrepareDrawRange:function(){var e=this;e.Max?e.DrawMax=e.Max:e.Scales.forEach(function(t){e.DrawMax=Math.max(e.DrawMax,t.PosVal)}),e.Min?e.DrawMin=e.Min:e.DrawMin>0&&e.DrawMax>0?e.DrawMin=0:e.DrawMin<0&&e.DrawMax<0?e.DrawMax=0:e.owner.NegativeAsZero&&(e.DrawMin=0),e.DrawMax<=e.DrawMin&&(e.DrawMin=0,e.DrawMax=100)},PrepareDrawSpace:function(e){var t,r=this;r.Space?r.DrawSpace=r.Space:(t=3*r.owner.fontHeight,r.DrawSpace=(r.DrawMax-r.DrawMin)*t/e,r.DrawSpace=CalcNearestAlignInt(r.DrawSpace,r.ScaleFormatParser.positiveAnalyser.precision)),r.DrawMax<=r.DrawMin&&(r.DrawMax=r.DrawMin+1,r.DrawSpace=.2),r.DrawSpace<2*r.GetScaleTiny()&&(r.DrawSpace=2*r.GetScaleTiny()),r.Max||r.Min||(r.DrawMax>0&&(r.DrawMax=r.DrawSpace*Math.ceil(r.DrawMax/r.DrawSpace)),r.DrawMin<0&&(r.DrawMin=r.DrawSpace*Math.floor(r.DrawMin/r.DrawSpace)))},GetScaleTiny:function(){var e=this;return(e.DrawMax-e.DrawMin)/1e4},CalcValuePos:function(e,t){var r=this;return(e-r.DrawMin)*t/(r.DrawMax-r.DrawMin)},get ScaleCount(){return this.Scales.length},AddCustomScale:function(e,t){this.Scales.push({PosVal:e,Text:t})},EmptyCustomScale:function(){this.Scales=[]},GetScaleText:function(e){return this.Scales[e].Text},GetScaleValue:function(e){return this.Scales[e].PosVal},AddCustomCoordLine:function(e,t,r,o,n){var a=new Pen;a.Width=r,a.Style=n,a.Color=o,this.CustomCoordLines.push({PosVal:e,Text:t,LinePen:a})},EmptyCustomCoordLine:function(){this.CustomCoordLines=[]}},prototypeCopyExtend(ChartAxis,Object);var ChartSeries=function(e){var t=this;Object.call(t,e),t.ChartType=1,t.ByY2Axis=!1,t.SeriesName="",t.XValueField="",t.YValueField="",t.ZValueField="",t.FillColor=0,t.FillColorAuto=!0,t.LabelText="",t.LabelAsGroup=!1,t.LabelInBar=!1,t.LabelTextAngle=0,t.TooltipText="",t.ValueFormat="0.##",t.MarkerStyle=3,t.MarkerSize=4,t.MarkerColor=16777215,t.MarkerColorAuto=!0,t.MarkerLegendShow=!0,t.BorderPen=new Pen,t.MarkerPen=new Pen};ChartSeries.prototype={afterLoad:function(e){var t=this;"StepBarChart"===t.ChartType?t.ChartType=4:enumMemberValid(t,"ChartType",grenum.ChartType),enumMemberValid(t,"MarkerStyle",grenum.PointMarkerStyle),colorMemberValid(t,"FillColor",t.report.viewer.alpha.chartGraph),colorMemberValid(t,"MarkerColor",t.report.viewer.alpha.chartGraph),t.BorderPen.loadFromJSON(e.BorderPen,t.report.viewer.alpha.chartStroke),t.MarkerPen.loadFromJSON(e.MarkerPen,t.report.viewer.alpha.chartStroke)},PrepareDraw:function(){var e=this;e.ValueFormatParser=new grformat.NumericFormatter(e.ValueFormat)},IsHorzGraph:function(){var e=this;return 11===e.ChartType||12===e.ChartType||13===e.ChartType},IsPercent100Graph:function(){var e=this;return 2===e.ChartType||10===e.ChartType||13===e.ChartType},IsBarChart:function(){var e=this;return 1===e.ChartType||4===e.ChartType||10===e.ChartType||11===e.ChartType||12===e.ChartType||13===e.ChartType},IsScatterGraph:function(){var e=this;return 5===e.ChartType||6===e.ChartType||8===e.ChartType||9===e.ChartType},CanGroupLabelChart:function(){var e=this;return 1===e.ChartType||11===e.ChartType},HasPointMarker:function(){var e=this;return 3===e.ChartType||7===e.ChartType||5===e.ChartType||6===e.ChartType||8===e.ChartType||9===e.ChartType},Support3D:function(){var e=this;return 1===e.ChartType||4===e.ChartType||10===e.ChartType||2===e.ChartType}},prototypeCopyExtend(ChartSeries,Object);var Chart=function(e){var t=this;Control.call(t,e),t.XAxis=new ChartAxis(t),t.YAxis=new ChartAxis(t),t.Y2Axis=new ChartAxis(t),t.Series=new ChartSeriesCollection(t),t.Recordset=new Recordset(t),t.TitleFont=new FontWrapper(t.Font),t.ValueFont=new FontWrapper(t.Font),t.Title="",t.Chart3D=!1,t.Chart3DViewAngle=35,t.LegendVisible=!0,t.LegendValueVisible=!1,t.LegendShowSum=!1,t.LegendAtBottom=!1,t.LegendColumnCount=0,t.LegendSumLabel="",t.SeriesField="",t.SeriesAuto=!0,t.GroupField="",t.GroupAuto=!0,t.GroupCount=5,t.SeriesCount=2,t.AbsNegativeValue=!1,t.NegativeBarColor=255,t.BarWidthPercent=70,t.NegativeAsZero=!1,t.SingleSeriesColored=!0,t.Bar3DAxisDepth=25,t.Pie3DHeightDepth=25,t.BubbleScalePerCm=0,t.SeriesLabels=[],t.GroupLabels=[]};Chart.prototype={ControlType:11,children:["Border","XAxis","YAxis","Y2Axis","Series"],options:{tooltipBoxColor:"rgba(0,0,0,.8)",tooltipBoxCorner:4,tooltipFontSize:14,tooltipFontStyle:"normal",tooltipTitleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipFontColor:"#fff"},afterLoad:function(e){var t=this;Control.prototype.afterLoad.call(t,e),colorMemberValid(t,"NegativeBarColor",t.report.viewer.alpha.chartGraph),t.XAxis.loadFromJSON(e.XAxis,t.report.viewer.alpha.chartStroke),t.YAxis.loadFromJSON(e.YAxis,t.report.viewer.alpha.chartStroke),t.Y2Axis.loadFromJSON(e.Y2Axis,t.report.viewer.alpha.chartStroke),t.Series.loadFromJSON(e.ChartSeries),t.Recordset.loadFromJSON(e.Recordset),t.TitleFont.loadFromJSON(e.TitleFont),t.ValueFont.loadFromJSON(e.ValueFont)},assign:function(e){var t=this;Control.prototype.assign.call(t,e),t.TitleFont.assign(e.TitleFont),t.ValueFont.assign(e.ValueFont)},attachData:function(){var e=this,t=e.Recordset;t.prepare(),e.oSeriesField=t.FieldByName(e.SeriesField),e.oGroupField=t.FieldByName(e.GroupField),e.Series.forEach(function(e){e.oYValueField=t.FieldByName(e.YValueField),e.IsScatterGraph()&&(e.oXValueField=t.FieldByName(e.XValueField),9==e.ChartType&&(e.oZValueField=t.FieldByName(e.ZValueField)))}),e.loadDrawingData()},loadDrawingData:function(){function e(){return t.Series.items.every(function(e){return e.oYValueField&&(!e.IsScatterGraph()||e.oXValueField&&(9!==e.ChartType||e.oZValueField))})}var t=this,r=e();r?t.applyDataFromRecordset():t.values||t.EmptyValues()},applyDataFromRecordset:function(){var e,t,r,o,n,a,i=this,l=i.Recordset,s=i.Series.items[0].IsScatterGraph();for(i.SeriesAuto&&i.oSeriesField&&(i.SeriesCount=0,i.SeriesLabels=[]),!s&&i.GroupAuto&&i.oGroupField&&(i.GroupCount=0,i.GroupLabels=[]),i.EmptyValues(),l.First();!l.Eof();)e=0,i.oSeriesField&&(t=i.oSeriesField.DisplayText,e=i.GetSeriesIndexByLabel(t,!1),0>e&&i.SeriesAuto&&(e=i.SeriesCount,i.SeriesLabels.push(t),++i.SeriesCount)),r=0,i.oGroupField&&!s&&(o=i.oGroupField.DisplayText,r=i.GetGroupIndexByLabel(o,!1),0>r&&i.GroupAuto&&(r=i.GroupCount,i.GroupLabels.push(o),++i.GroupCount)),i.Series.forEach(function(t,o){o&&(e=o),s?i.AddXYZValue(e,t.oXValueField.AsFloat,t.oYValueField.AsFloat,t.oZValueField?t.oZValueField.AsFloat:undefined):(n=t.oYValueField.AsFloat,a=i.Value(e,r),a&&(n+=a),i.SetValue(e,r,n))}),l.Next()},generateContent:function(e){this.report.registerCanvas(this,e)},generateInCell:function(e){this.generateContent(e)},showTooltip:function(e,t){var r=this,o=r.options,n=r.context;if(e||(e=undefined),r.activeShape!==e&&(r.activeShape=e,n.ctx.clearRect(0,0,r.canvas.width,r.canvas.height),r.draw(),e)){var a=r.graphSerieses[e.seriesIndex];if(a.TooltipTextBuilder){var i,l=n.ctx.font,s=a.TooltipTextBuilder.generateChartDisplayText(e.seriesIndex,e.groupIndex),u=e.tooltipPos(),c=o.tooltipFontSize+2,d=0;if(n.ctx.font=fontString(o.tooltipFontSize,o.tooltipFontStyle,o.tooltipTitleFontFamily),a.tooltipLines>1){i=[];for(var p,h,f=0;(p=s.indexOf("\n",f))>=0;)h=s.substring(f,p-("\r"===s.charAt(p-1)?1:0)),i.push(h),d=Math.max(d,n.measureTextWidth(h)),f=p+1;h=s.substring(f),i.push(h),d=Math.max(d,n.measureTextWidth(h))}else d=n.measureTextWidth(s);var m=new Rect(u.x,u.y,u.x+d,u.y+c*a.tooltipLines-2);if(m.InflateRect(o.tooltipBoxCorner,o.tooltipBoxCorner),m.OffsetRect(Math.min(r.canvas.width-m.right,0),Math.min(r.canvas.height-m.bottom,0)),n.setFillStyle(o.tooltipBoxColor),n.roundRectangle(m.left,m.top,m.Width(),m.Height(),o.tooltipBoxCorner,o.tooltipBoxCorner,1),n.setFillStyle(o.tooltipFontColor),i){var g=m.left+o.tooltipBoxCorner,C=m.top+o.tooltipBoxCorner;i.forEach(function(e){n.drawText(e,g,C),C+=c})}else n.drawTextCenter(s,(m.left+m.right)/2,(m.top+m.bottom-o.tooltipFontSize)/2);n.resetFillStyle(),n.ctx.font=l}}},prepareCanvas:function(){function e(){var e,t,r=n.Series.items.length;for(e=0;r>e;e++)if(t=n.Series.items[e],t.LabelText&&(t.LabelTextBuilder=new grexp.TextBuilder(n,t.LabelText)),t.TooltipText){t.TooltipTextBuilder=new grexp.TextBuilder(n,t.TooltipText),t.tooltipLines=1;for(var o=0;(o=t.TooltipText.indexOf("\n",o))>=0;)++o,++t.tooltipLines;a=1}}function t(){var e=toRadians(n.Chart3DViewAngle);n.xView3DDepth=Math.cos(e)*n.Bar3DAxisDepth,n.yView3DDepth=Math.sin(e)*n.Bar3DAxisDepth}function r(){var e,t,r=n.graphs=[],o=n.graphSerieses=[];for(e=0;e<n.SeriesCount;e++){t=e<n.Series.items.length?n.Series.items[e]:n.Series.items[0],o.push(t);for(var a=0;a<r.length;a++)if(t.ChartType===o[r[a][0]].ChartType){r[a].push(e);break}a===r.length&&r.push([e])}
}function o(e){var t,r,o=n.shapes.length;if(n.graphs.length>1)for(t=0;o>t;t++)if(r=n.shapes[t],!r.rect&&r.inRange(e.x,e.y))return r;for(t=0;o>t;t++)if(r=n.shapes[t],r.inRange(e.x,e.y))return r;return 0}var n=this,a=0;n.Chart3DReal=n.Chart3D&&n.Support3D(),n.xView3DDepth=0,n.yView3DDepth=0,n.Chart3DReal&&t(),e(),r(),a&&bindEvents(this,["mousemove","touchstart","touchmove","mouseout"],function(e){var t,r;"mouseout"!==e.type&&(t=getRelativePosition(e),r=o(t)),this.showTooltip(r,t)})},resize:function(){var e=this,t=e.canvas;t.width=Math.min(t.parentNode.clientWidth,window.innerWidth),t.height=Math.min(t.parentNode.clientHeight,window.innerHeight),e.draw(1)},draw:function(e){function t(){function e(){var e,o,i;u.DrawBubbleScalePerCm=u.BubbleScalePerCm,u.DrawBubbleScalePerCm<=0&&(e=r*t*BubbleCircleCoverRatio,o=e/(PixelsPerCm*PixelsPerCm),u.DrawBubbleScalePerCm=a/o),i=Math.sqrt(n/u.DrawBubbleScalePerCm)*PixelsPerCm,0===x.Max&&(x.DrawMax+=(x.DrawMax-x.DrawMin)*(i/2)/t),0==C.Max&&(C.DrawMax+=(C.DrawMax-C.DrawMin)*(i/2)/r)}var t,r,o=u.IsScatterGraph(),n=0,a=0;for(C.PrepareDraw(),x.PrepareDraw(),y.PrepareDraw(),l=u.Series.items.length,i=0;l>i;i++)u.Series.items[i].PrepareDraw(this);C.Used=!0,C.IsValueAxis=!1,x.IsValueAxis=!0,y.IsValueAxis=!0,u.Title&&(T=fontHeight(u.getUsingTitleFont())+BIG_GAP),o?(C.IsValueAxis=!0,m.forEach(function(e){e.forEach(function(e){var t,r=u.values[e],o=r.length,l=C,s=u.YAxisOfSeries(g[e]);for(s.Used=!0,i=0;o>i;i++)t=r[i],t.y<s.DrawMin&&(s.DrawMin=t.y),t.y>s.DrawMax&&(s.DrawMax=t.y),t.x<l.DrawMin&&(l.DrawMin=t.x),t.x>l.DrawMax&&(l.DrawMax=t.x),n<t.z&&(n=t.z),a+=t.z})}),C.PrepareDrawRange()):m.forEach(function(e){var t,r,o=g[e[0]].ChartType,n=4===o||10===o||12===o||13===o;for(t=0;t<u.GroupCount;t++)if(r=0,e.forEach(function(e){var o=u.values[e][t],a=u.YAxisOfSeries(g[e]);n?r+=o:(a.Used=!0,u.AbsNegativeValue&&(o=Math.abs(o)),o<a.DrawMin&&(a.DrawMin=o),o>a.DrawMax&&(a.DrawMax=o))}),n){var a=g[e[0]],i=u.YAxisOfSeries(a);i.m_Used=!0,10===a.ChartType||13===a.ChartType?(i.DrawMin=0,i.DrawMax=100):(r<i.DrawMin&&(i.DrawMin=r),r>i.DrawMax&&(i.DrawMax=r))}}),x.Used||y.Used||(x.Used=!0),x.Used&&(s=x.DrawMax),y.Used&&s<y.DrawMax&&(s=y.DrawMax),x.PrepareDrawRange(),y.PrepareDrawRange(),t=p-T-C.CalcLabelHeight()-C.CalcHorzAxisHeight(!0),t=Math.max(t,1),x.PrepareDrawSpace(t),y.PrepareDrawSpace(t),o&&(r=d-x.CalcLabelHeight()-x.CalcVertAxisWidth()-y.CalcLabelHeight()-y.CalcVertAxisWidth(),r=Math.max(r,1),0!=C.Space?C.DrawSpace=C.Space:C.DrawSpace=CalcNearestAlignInt((C.DrawMax-C.DrawMin)*fontHeight(u.getUsingFont())*6/r,C.ScaleFormatParser.positiveAnalyser.precision),C.DrawMax<=C.DrawMin&&(C.DrawMax=C.DrawMin+1,C.DrawSpace=.2),C.DrawSpace<2*C.GetScaleTiny()&&(C.DrawSpace=2*C().GetScaleTiny()),0===C.Max&&(C.DrawMax=Math.ceil((C.DrawMax-.1)/C.DrawSpace)*C.DrawSpace),t=p-T-C.CalcLabelHeight()-C.CalcHorzAxisHeight(!1),t=Math.max(t,1),9===u.Series.items[0].ChartType&&e())}function r(){var e;u.LegendAtBottom?(e=u.DrawHorzSideLegend(h),h.bottom-=e+BIG_GAP):(e=u.DrawVertSideLegend(h),h.right-=e+BIG_GAP)}function o(){f.SelectFont(u.getUsingTitleFont()),f.drawTextCenter(u.Title,(h.left+h.right)/2,h.top+BIG_GAP/2),f.RestoreFont()}function n(e){var t,r,o,n,a,i,l,c,d=C.CalcLabelHeight(),p=C.CalcHorzAxisHeight(!1),h=x.CalcLabelHeight(),T=x.CalcVertAxisWidth(),S=y.CalcLabelHeight(),b=y.CalcVertAxisWidth(),v=0,F=0,w=!1;for(r=u.Series.items.length,t=0;r>t;t++)if(o=u.Series.items[t],o.LabelTextBuilder&&!o.LabelInBar){w=!0;break}if(!w&&u.Title||(v=fontHeight(u.getUsingValueFont())/(o.LabelTextBuilder?1:2),u.IsDrawNegativeGraph()&&(F=v),o.LabelTextAngle&&(f.SelectFont(u.getUsingValueFont()),v=Math.max(Math.abs(f.measureTextWidth(o.ValueFormatParser.format(s))*Math.sin(toRadians(o.LabelTextAngle))),v),f.RestoreFont())),a=new Rect(e.left+h+T,e.top+v,e.right-S-b,e.bottom-d-p-F),l=new Rect(e.left,e.top+v,e.left+h,e.bottom-d-p-F),x.DrawVertAxisLabel(l),c=new Rect(e.right-S,l.top,e.right,l.bottom),y.DrawVertAxisLabel(c),l.left=l.right,l.right+=T,x.DrawVertAxis(l,a,!1),c.right=c.left,c.left-=b,y.DrawVertAxis(c,a,!0),i=new Rect(e.left+h+T,e.bottom-d,e.right-S-b,e.bottom),C.DrawHorzAxisLabel(i),u.IsDrawNegativeGraph()?(i.top=l.bottom-x.CalcValuePos(0,l.Height()),i.bottom=i.top+p):(i.top=a.bottom,i.bottom=i.top+p),u.Chart3D&&C.DrawHorzAxis(i,a,!1),!a.IsRectEmpty()&&(u.IsScatterGraph()||u.GroupCount)){for(f.SelectFont(u.getUsingValueFont()),r=m.length,t=0;r>t;t++)switch(o=m[t],n=g[o[0]].ChartType){case 1:u.DrawBar(o,a);break;case 4:case 10:u.DrawStackedBar(o,n,a);break;case 3:case 7:u.DrawLine(o,n,a);break;case 9:u.DrawBubble(o,a);break;default:u.DrawXYScatterGraph(o,n,a)}f.RestoreFont()}u.Chart3D||C.DrawHorzAxis(i,a,!1)}function a(e){var t,r,o,n,a,i,l,c,d=C.CalcLabelHeight(),p=C.CalcVertAxisWidth(),h=x.CalcLabelHeight(),T=x.CalcHorzAxisHeight(!1),S=y.CalcLabelHeight(),b=y.CalcHorzAxisHeight(!1),v=0,F=0,w=!1;for(r=u.Series.items.length,t=0;r>t;t++)if(o=u.Series.items[t],o.LabelTextBuilder&&!o.LabelInBar){w=!0;break}if(w&&(f.SelectFont(u.getUsingValueFont()),v=f.measureTextWidth(o.ValueFormatParser.format(s)),u.IsDrawNegativeGraph()&&(F=v),f.RestoreFont()),a=new Rect(e.left+d+p+F,e.top+h+T,e.right-v,e.bottom-S+b),l=new Rect(a.left,e.top,a.right,e.top+h),x.DrawHorzAxisLabel(l),c=new Rect(l.left,e.bottom-S,l.right,e.bottom),y.DrawHorzAxisLabel(c),l.top=l.bottom,l.bottom+=T,x.DrawHorzAxis(l,a,!0),c.bottom=c.top,c.top-=b,y.DrawHorzAxis(c,a,!1),i=new Rect(e.left,a.top,e.left+d,a.bottom),C.DrawVertAxisLabel(i),i.left=i.right,i.right+=p,!a.IsRectEmpty()&&u.GroupCount){for(f.SelectFont(u.getUsingValueFont()),r=m.length,t=0;r>t;t++)switch(o=m[t],n=g[o[0]].ChartType){case 11:u.DrawColumnBar(o,a);break;case 12:case 13:u.DrawStackedColumnBar(o,n,a)}f.RestoreFont()}u.Chart3D||C.DrawVertAxis(i,a,!1)}var i,l,s,u=this,c=u.canvas,d=c.width,p=c.height,h=new Rect(0,0,d,p),f=u.context=new Context(c.getContext("2d")),m=u.graphs,g=u.graphSerieses,C=u.XAxis,x=u.YAxis,y=u.Y2Axis,T=0;u.fontHeight=fontHeight(u.getUsingFont()),u.valueFontHeight=fontHeight(u.getUsingValueFont()),f.SelectFont(u.getUsingFont()),f.setDefaultFillColor(u.ForeColor),u.report.singleChart&&(h.left+=u.PaddingLeft,h.top+=u.PaddingTop,h.right-=u.PaddingRight,h.bottom-=u.PaddingBottom),u.toUpdateShapes=e,e&&(u.shapes=[]),t();try{u.LegendVisible&&u.SeriesCount&&r(),u.Title&&o(),h.top+=T,h.IsRectEmpty()||(2==u.Series.items[0].ChartType?u.DrawPie(h):u.IsHorzGraph()?a(h):n(h))}catch(S){}f.RestoreFont()},DrawPie:function(e){var t,r,o,n,a=this,i=a.context,l=0,s=0,u=e.Height(),c=e.Width(),d=c*u,p=Number.MAX_VALUE,h=-1,f=-1;for(t=0;t<a.GroupCount;t++){for(r=0;r<a.SeriesCount;r++)i.SelectFont(a.getUsingValueFont()),a.graphSerieses[r].LabelTextBuilder&&(l=Math.max(l,i.measureTextWidth(a.GetDrawValueText(r,t)))),i.RestoreFont();s=Math.max(s,i.measureTextWidth(a.GroupLabel(t)))}for(t=1;t<=a.GroupCount;t++)r=Math.floor((a.GroupCount+t-1)/t),o=Math.min(c/r,u/t),o=d-o*o*a.GroupCount,p>o&&(p=o,h=r,f=t);for(i.SelectFont(a.getUsingValueFont()),o=0;o<a.GroupCount;o++)t=Math.floor(o/h),r=o%h,n=new Rect(e.left+c*r/h,e.top+u*t/f,e.left+c*(r+1)/h,e.top+u*(t+1)/f),a.Chart3DReal||a.DrawOne2DPie(o,n,l,s);i.RestoreFont()},DrawOne2DPie:function(e,t,r){function o(){var r,o,f,g,x,y,T=c.getUsingValueFont(),S=T.Italic?p(T):0,b=new Rect(0,0,0,0);for(u=0,n=0;m>n;n++)s=toRadians(C[n]),o=i+Math.cos(s)*a,f=l-Math.sin(s)*a,y=c.GetDrawValueText(n,e),x=d.measureTextWidth(y)+S,r=new Rect(o,f,o+x,f+h),s<Math.PI/2?(r.OffsetRect(2,-h),1===u&&r.top<b.bottom&&(g=b.right-r.left+2,r.right+g<t.right?r.OffsetRect(g,0):r.OffsetRect(0,b.bottom-r.top),d.drawLine(o,f,r.left,r.bottom-x.cy/3)),u=1):s<Math.PI?(r.OffsetRect(-x-2,-h),2===u&&r.top<b.bottom&&(g=r.right-b.left+2,r.left-g>t.left?r.OffsetRect(-g,0):r.OffsetRect(0,b.bottom-r.top),d.drawLine(o,f,r.right,r.bottom-x.cy/3)),u=2):s<1.5*Math.PI?(r.OffsetRect(-x-2,0),3===u&&r.bottom>b.top&&(g=r.right-b.left+2,r.left-g>t.left?r.OffsetRect(-g,0):r.OffsetRect(0,r.bottom-b.top),d.drawLine(o,f,r.right,r.top+x.cy/3)),u=3):(r.OffsetRect(2,0),4===u&&r.bottom>b.top&&(g=b.right-r.left+2,r.right-g<t.right?r.OffsetRect(g,0):r.OffsetRect(0,r.bottom-b.top),d.drawLine(o,f,r.left,r.top+x.cy/3))),c.DrawLabelText(y,(r.left+r.right)/2,r.top),b=r}var n,a,i,l,s,u,c=this,d=c.context,p=c.fontHeight,h=c.valueFontHeight,f=!1,m=c.SeriesCount,g=0,C=[];for(n=0;m>n;n++)g+=c.Value(n,e),c.graphSerieses[n].LabelTextBuilder&&(f=!0);if(!(0>=g||(i=t.Width()-2*r-2*SMALL_GAP,l=t.Height()-p-2*h-2*SMALL_GAP,0>=i||0>=l||(a=Math.min(i,l)/2,f?t.InflateRect(-SMALL_GAP,-SMALL_GAP):t.InflateRect(a-i/2,a-l/2),t.bottom-=p,t.IsRectEmpty())))){for(c.DrawLabelText(c.GroupLabel(e),(t.left+t.right)/2,t.bottom),i=(t.left+t.right)/2,l=(t.top+t.bottom)/2,s=0,n=0;m>n;n++)u=s+360*c.Value(n,e)/g,c.toUpdateShapes&&c.shapes.push(new ChartPie(n,e,i,l,a,s,u)),d.setFillColor(c.GetGraphFillColor(n)),d.pie(i,l,a,s,u),f&&C.push((s+u)/2),s=u;d.resetFillStyle(),f&&o()}},DrawColumnBar:function(e,t){var r,o,n,a,i,l,s,u,c,d,p,h,f=this,m=f.context,g=f.CalcColumnBarCount(),C=f.CalcFirtColumnBarIndex(e),x=t.Width()-f.xView3DDepth,y=t.Height()-f.yView3DDepth,T=f.IsDrawNegativeGraph()?f.YAxis.CalcValuePos(0,x):t.left+1,S=e.length,b=f.IsDrawNegativeGraph(),v=[];for(n=0;n<f.GroupCount;n++)for(s=f.XAxis.CalcGroupPos(y,n),u=s.EndPos-s.BeginPos,r=0;S>r;r++)a=e[r],o=f.Value(a,n),c=f.AbsNegativeValue&&0>o,c&&(o=-o),h=new Rect(0,t.top+s.BeginPos+u*(C+r)/g,0,t.top+s.BeginPos+u*(C+r+1)/g),p=f.YAxisOfSeries(f.graphSerieses[a]).CalcValuePos(o,x),b?(h.left=t.left+T,h.right=Math.min(t.left+p,t.right),T>p&&(p=h.left,h.left=h.right,h.right=p)):(h.left=t.left,h.right=Math.min(t.left+Math.max(0,p),t.right)),v.push(h),f.toUpdateShapes&&f.shapes.push(new ChartRect(a,n,h)),d=c?f.NegativeBarColor:f.GetGraphFillColor(f.IsColorSingleBar()?n:a),f.Chart3DReal,m.drawBar(h,f.graphSerieses[a].BorderPen,d,b?3:1);for(n=0;n<f.GroupCount;n++)if(i=f.graphSerieses[e[0]],i.LabelAsGroup){for(l=f.GetDrawValueText(e[0],n),p=-9999,r=0;S>r;r++)h=v[n*S+r],p<h.right&&(p=h.right);f.DrawValueText(i,l,p+SMALL_GAP+m.measureTextWidth(l)/2,(v[n*S].top+v[n*S+S-1].bottom+f.valueFontHeight)/2)}else for(r=0;S>r;r++)a=e[r],i=f.graphSerieses[a],i.LabelTextBuilder&&(l=f.GetDrawValueText(a,n),h=v[n*S+r],i.LabelInBar?f.DrawHorzBarText(l,h):f.DrawValueText(i,l,h.right+SMALL_GAP+m.measureTextWidth(l)/2,(h.top+h.bottom+f.valueFontHeight)/2))},DrawStackedColumnBar:function(e,t,r){var o,n,a,i,l,s,u,c,d,p,h,f,m,g=this,C=g.context,x=g.CalcColumnBarCount(),y=g.CalcFirtColumnBarIndex(e),T=r.Width()-g.xView3DDepth,S=r.Height()-g.yView3DDepth,b=e.length,v=[];for(a=0;a<g.GroupCount;a++){for(s=g.XAxis.CalcGroupPos(S,a),u=s.EndPos-s.BeginPos,h=r.top+s.BeginPos+u*y/x,f=r.top+s.BeginPos+u*(y+1)/x,d=r.left,o=0;b>o;o++)i=e[o],l=g.graphSerieses[i],n=g.Value(i,a),13==t&&(n*=100/g.CalcGroupTotalValue(e,a)),p=Math.max(0,g.YAxisOfSeries(l).CalcValuePos(n,T)),m=new Rect(d,h,Math.min(r.right,d+p),f),v.push(m),g.toUpdateShapes&&g.shapes.push(new ChartRect(i,a,m)),c=g.GetGraphFillColor(i),g.Chart3DReal,C.drawBar(m,g.graphSerieses[i].BorderPen,c,1),d+=p;if(l=g.graphSerieses[e[0]],l.LabelInBar)for(o=0;b>o;o++)i=e[o],l=g.graphSerieses[i],l.LabelTextBuilder&&g.DrawHorzBarText(g.GetDrawValueText(i,a),v[a*b+o]);else n=g.GetDrawValueText(e[0],a),g.DrawValueText(l,n,d+SMALL_GAP+C.measureTextWidth(n)/2,(h+f+g.valueFontHeight)/2)}},DrawBar:function(e,t){var r,o,n,a,i,l,s,u,c,d,p,h,f,m=this,g=m.context,C=m.CalcBarCount(),x=m.CalcFirtBarIndex(e),y=m.IsDrawNegativeGraph(),T=t.Height()-m.yView3DDepth,S=y?m.YAxis.CalcValuePos(0,T):t.bottom+1,b=e.length,v=[];for(a=0;a<m.GroupCount;a++)for(u=m.XAxis.CalcGroupPos(t.Width()-m.xView3DDepth,a),c=u.EndPos-u.BeginPos,n=x,r=0;b>r;r++)i=e[r],o=m.Value(i,a),d=m.AbsNegativeValue&&0>o,d&&(o=-o),f=new Rect(t.left+u.BeginPos+c*n/C,0,t.left+u.BeginPos+c*(n+1)/C,0),h=m.YAxisOfSeries(m.graphSerieses[i]).CalcValuePos(o,T),y?(f.top=Math.max(t.bottom-h,t.top),f.bottom=t.bottom-S,S>h&&(h=f.top,f.top=f.bottom,f.bottom=h)):(f.top=t.bottom-h,f.bottom=t.bottom),v.push(f),m.toUpdateShapes&&m.shapes.push(new ChartRect(i,a,f)),p=d?m.NegativeBarColor:m.GetGraphFillColor(m.IsColorSingleBar()?a:i),m.Chart3DReal,g.drawBar(f,m.graphSerieses[i].BorderPen,p,y&&0>o?2:0),++n;for(a=0;a<m.GroupCount;a++)if(l=m.graphSerieses[e[0]],l.LabelAsGroup){for(s=m.GetDrawValueText(e[0],a),h=9999,r=0;b>r;r++)f=v[a*b+r],h>f.top&&(h=f.top);m.DrawValueText(l,s,(v[a*b].left+v[a*b+b-1].right+m.xView3DDepth)/2,h-SMALL_GAP/2-m.yView3DDepth)}else for(r=0;b>r;r++)i=e[r],l=m.graphSerieses[i],l.LabelTextBuilder&&(s=m.GetDrawValueText(i,a),f=v[a*b+r],l.LabelInBar?m.DrawVertBarText(s,f):(h=f.top-SMALL_GAP/2-m.yView3DDepth,m.IsDrawNegativeGraph()&&t.bottom-S<f.bottom&&(h=f.bottom+m.valueFontHeight),m.DrawValueText(l,s,(f.left+f.right+m.xView3DDepth)/2,h)))},DrawStackedBar:function(e,t,r){var o,n,a,i,l,s,u,c,d,p,h,f,m,g=this,C=g.context,x=g.CalcBarCount(),y=g.CalcFirtBarIndex(e),T=r.Width()-g.xView3DDepth,S=r.Height()-g.yView3DDepth,b=e.length,v=[];for(a=0;a<g.GroupCount;a++){for(s=g.XAxis.CalcGroupPos(T,a),u=s.EndPos-s.BeginPos,p=r.left+s.BeginPos+u*y/x,h=r.left+s.BeginPos+u*(y+1)/x,f=r.bottom,o=0;b>o;o++)i=e[o],l=g.graphSerieses[i],n=g.Value(i,a),10===t&&(n*=100/g.CalcGroupTotalValue(e,a)),d=g.YAxisOfSeries(l).CalcValuePos(n,S),m=new Rect(p,Math.min(Math.max(f-d,r.top),f),h,f),v.push(m),g.toUpdateShapes&&g.shapes.push(new ChartRect(i,a,m)),c=g.GetGraphFillColor(i),g.Chart3DReal,C.drawBar(m,g.graphSerieses[i].BorderPen,c,0),f-=d;if(l=g.graphSerieses[e[0]],l.LabelInBar)for(o=0;b>o;o++)i=e[o],l=g.graphSerieses[i],l.LabelTextBuilder&&g.DrawVertBarText(g.GetDrawValueText(i,a),v[a*b+o]);else g.DrawValueText(l,g.GetDrawValueText(e[0],a),(p+h+g.xView3DDepth)/2,f-SMALL_GAP/2-g.yView3DDepth)}},DrawLine:function(e,t,r){var o,n,a,i,l,s,u,c,d=this,p=d.context,h=e.length,f=[];for(o=0;h>o;o++)f.push([]);for(n=0;n<d.GroupCount;n++)for(u=r.left+d.XAxis.CalcGroupPos(r.Width()-d.xView3DDepth,n).LabelMiddlePos,o=0;h>o;o++){a=e[o],i=d.graphSerieses[a];var m={x:u,y:r.bottom-d.YAxisOfSeries(i).CalcValuePos(d.Value(a,n),r.Height())};f[o].push(m),d.toUpdateShapes&&d.shapes.push(new ChartPoint(a,n,m.x,m.y,i.MarkerSize))}for(o=0;h>o;o++)(7===t?d.DrawCurveLine:d.DrawPolyLine).call(d,f[o],e[o]);for(o=0;h>o;o++)d.DrawPointsMarker(f[o],e[o]);for(n=0;n<d.GroupCount;n++)for(o=0;h>o;o++)a=e[o],i=d.graphSerieses[a],i.LabelTextBuilder&&(c=r.bottom-d.YAxisOfSeries(i).CalcValuePos(d.Value(a,n),r.Height()),-1!==i.MarkerStyle&&(c-=i.MarkerSize/2),l=d.GetDrawValueText(a,n),s=p.measureTextWidth(l),u=f[o][n].x+s/2,d.GroupCount>1&&(u-=s*n/(d.GroupCount-1)),d.DrawValueText(i,l,u,c))},DrawBubble:function(e,t){var r,o,n,a,i,l,s,u,c,d=this,p=(d.context,e.length),h=[],f=[];for(r=0;p>r;r++)for(a=e[r],i=d.graphSerieses[a],u=[],c=[],h.push(u),f.push(c),s=d.ValueCount(a),n=0;s>n;n++){o=d.Value(a,n),l=Math.sqrt(o.z/d.DrawBubbleScalePerCm)*PixelsPerCm/2;var m={x:t.left+d.XAxis.CalcValuePos(o.x,t.Width()),y:t.bottom-d.YAxisOfSeries(i).CalcValuePos(o.y,t.Height())};u.push(m),c.push(l),d.toUpdateShapes&&d.shapes.push(new ChartPoint(a,n,m.x,m.y,l)),i.LabelTextBuilder&&d.DrawValueText(i,d.GetDrawValueText(a,n),m.x,m.y-l)}for(r=0;p>r;r++)a=e[r],d.DrawPointsMarker(h[a],a,f[a])},DrawXYScatterGraph:function(e,t,r){var o,n,a,i,l,s,u,c=this,d=(c.context,e.length),p=[];for(o=0;d>o;o++)for(i=e[o],l=c.graphSerieses[i],u=[],p.push(u),s=c.ValueCount(i),a=0;s>a;a++){n=c.Value(i,a);var h={x:r.left+c.XAxis.CalcValuePos(n.x,r.Width()),y:r.bottom-c.YAxisOfSeries(l).CalcValuePos(n.y,r.Height())};u.push(h),c.toUpdateShapes&&c.shapes.push(new ChartPoint(i,a,h.x,h.y,l.MarkerSize)),l.LabelTextBuilder&&c.DrawValueText(l,c.GetDrawValueText(i,a),h.x,h.y-l.MarkerSize)}if(6===t||8===t)for(o=0;d>o;o++)i=e[o],l=c.graphSerieses[i],(8===t?c.DrawCurveLine:c.DrawPolyLine).call(c,p[i],i);for(o=0;d>o;o++)i=e[o],c.DrawPointsMarker(p[i],i)},DrawPolyLine:function(e,t){var r,o,n=this,a=n.context,i=e.length,l=[];for(r=0;i>r;r++)l.push(e[r].x,e[r].y);o=n.graphSerieses[t].BorderPen.clone(),o.Color=n.GetGraphFillColor(t),a.SelectPen(o),a.drawPolyLine(l),a.RestorePen()},DrawCurveLine:function(e,t){function r(e,t,r){var o=.4,n=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=Math.sqrt(Math.pow(r.x-t.x,2)+Math.pow(r.y-t.y,2)),i=o*n/(n+a),l=o*a/(n+a);return{inner:{x:t.x-i*(r.x-e.x),y:t.y-i*(r.y-e.y)},outer:{x:t.x+l*(r.x-e.x),y:t.y+l*(r.y-e.y)}}}var o,n,a,i,l=this,s=l.context,u=e.length,c=[];if(u>1){for(a=e[0],i=r(a,a,e[1]),c.push(a,i.outer),o=1;u-1>o;o++)a=e[o],i=r(e[o-1],a,e[o+1]),c.push(i.inner,a,i.outer);a=e[o],i=r(e[o-1],a,a),c.push(i.inner,a),n=l.graphSerieses[t].BorderPen.clone(),n.Color=l.GetGraphFillColor(t),s.SelectPen(n),s.polyBezier(c),s.RestorePen()}},DrawPointsMarker:function(e,t,r){var o,n=this,a=n.context,i=n.graphSerieses[t],l=e.length;if(-1!==i.MarkerStyle)for(o=0;l>o;o++)a.DrawPointMarker(CalcPointMarkerRect(e[o].x,e[o].y,r?r[o]:i.MarkerSize),i.MarkerStyle,i.MarkerPen,i.MarkerColorAuto?n.GetGraphFillColor(t):i.MarkerColor)},DrawHorzSideLegend:function(e){var t,r,o,n,a,i,l,s,u=this,c=u.context,d=u.LegendRealShowValue(),p=u.LegendColumnCount>0?u.LegendColumnCount:999,h=e.Width(),f=2*u.fontHeight,m=3*f/4,g=u.LegendItemCount(),C=h,x=[],y={Count:0,Width:0};for(r=0;g>r;++r)t=BIG_GAP+m+SMALL_GAP,t+=c.measureTextWidth(u.LegendItemLabel(r)),d&&(t+=SMALL_GAP+c.measureTextWidth(u.LegendItemValueText(r))),(t>C||y.Count>=p)&&y.Width>0&&(x.push(y),y={Count:0,Width:0},C=h),y.Count++,y.Width+=t,C-=t;for(y.Count>0&&x.push(y),n=SMALL_GAP+x.length*f,o=0,y=x[o],r=e.bottom-n+SMALL_GAP,a=new Rect((e.left+e.right-y.Width)/2,e.bottom-n+SMALL_GAP,0,r+f),r=0;g>r;++r)y.Count<=0&&(o++,y=x[o],a.left=(e.left+e.right-y.Width)/2,a.top=a.bottom,a.bottom+=f),y.Count--,a.left+=BIG_GAP,(g-1>r||!u.LegendIsSumItem(r))&&(t=(a.top+a.bottom-m)/2,i=new Rect(a.left,t,a.left+m,t+m),u.DrawLegendGraph(r,i)),a.left+=m,l=(a.top+a.bottom-u.fontHeight)/2,s=u.LegendItemLabel(r),a.left+=SMALL_GAP,a.right=a.left+c.measureTextWidth(s),c.drawText(s,a.left,l),a.left=a.right,d&&(s=u.LegendItemValueText(r),a.left+=SMALL_GAP,a.right=a.left+c.measureTextWidth(s),c.drawText(s,a.left,l),a.left=a.right);return n},DrawVertSideLegend:function(e){var t,r,o,n,a,i,l,s,u,c,d,p,h,f,m=this,g=m.context,C=m.LegendRealShowValue(),x=m.LegendRealShowSum(),y=m.LegendItemCount(),T=m.LegendColumnCount,S=2*m.fontHeight,b=3*S/4,v=e.Height()-2*SMALL_GAP,F=0,w=0,D=2*SMALL_GAP,P=[],B=[];for(n=0;y>n;++n)i=g.measureTextWidth(m.LegendItemLabel(n)),i>F&&(F=i),l=S,D+=l,P.push(l),C&&(i=g.measureTextWidth(m.LegendItemValueText(n)),i>w&&(w=i));if(t=F+SMALL_GAP,w>0&&(t+=w+SMALL_GAP),0>=T&&(T=1,D>e.Height()))for(i=0,n=0;y>n;++n)i>v&&(T++,i=P[n]);if(v<P[0])return 0;for(n=0,i=0;T>i;i++)for(l=v;y>n&&l>P[n];)l-=P[n++];for(r=y>n,r&&(i=y,x&&(n--,i--),P.splice(n,i-n)),i=P.length,l=T,s=Math.ceil(i/T),B=createArray(T,0),x&&(B[T-1]=s,i-=s,l--,l>0&&(s=Math.ceil(i/l))),n=0;l>n;n++)B[n]=Math.min(s,i),i-=B[n];for(l=0,n=0,i=0;T>i;i++){for(s=0,a=0;a<B[i];a++)s+=P[n++];s>l&&(l=s)}for(D=Math.min(e.Height(),l+2*SMALL_GAP),u=SMALL_GAP+b+SMALL_GAP+t,c=u*T+SMALL_GAP,c>2*e.Width()/3&&(c=2*e.Width()/3,l=u,u=(c-SMALL_GAP)/T,F-=l-u),i=e.right-c,l=(e.top+e.bottom-D)/2,d=new Rect(i,l,i+c,l+D),g.rectangle2(d),i=d.left+SMALL_GAP,l=u-SMALL_GAP,p=new Rect(i,0,i+b,0),i+=p.Width()+SMALL_GAP,l-=p.Width()+SMALL_GAP,h=new Rect(i,d.top+SMALL_GAP,i+Math.min(l,F+SMALL_GAP),0),i+=h.Width()+SMALL_GAP,l-=h.Width()+SMALL_GAP,f=new Rect(i,0,i+l,0),i=P.length-1,x&&i--,l=0,n=0;T>n;n++){for(h.top=d.top+SMALL_GAP,a=0;a<B[n];++a)h.bottom=h.top+P[l],s=(h.top+h.bottom-m.fontHeight)/2,r&&i===l?g.drawText("... ...",p.left,s):(p.top=(h.top+h.bottom-b)/2,p.bottom=p.top+b,o=x&&l===P.length-1,o?l=y-1:m.DrawLegendGraph(l,p),g.drawText(m.LegendItemLabel(l),h.left,s),C&&g.drawText(m.LegendItemValueText(l),f.left,s),o&&(g.SelectPen(new Pen(.5,0,1)),g.DrawHorzLine(h.top,p.left,f.right),g.RestorePen(new Pen(.5,0,1)))),h.top+=P[l++];p.left+=u,p.right+=u,h.left+=u,h.right+=u,f.left+=u,f.right+=u}return c},DrawLegendGraph:function(e,t){var r,o=this,n=o.context,a=!1,i=o.GetGraphFillColor(e);o.LegendIsGroup()||(r=o.graphSerieses[e],a=r.HasPointMarker()&&r.MarkerLegendShow,a&&n.DrawPointMarker(t,r.MarkerStyle,r.MarkerPen,i)),a||(n.setFillColor(i),n.rectangle2(t,1),n.resetFillStyle())},DrawValueText:function(e,t,r,o){var n,a=this,i=a.context,l=a.valueFontHeight;e.LabelTextAngle?(n=toRadians(e.LabelTextAngle),r-=(i.measureTextWidth(t)*Math.cos(n)+Math.abs(l*Math.sin(n)))/2,o-=Math.abs(l*Math.cos(n)),i.drawTextRotate(t,r,o,e.LabelTextAngle)):i.drawTextCenter(t,r,o-l)},DrawLabelText:function(e,t,r){var o=this.context;o.drawTextCenter(e,t,r)},DrawVertBarText:function(e,t){var r=this,o=r.context;o.drawTextRotate(e,(t.left+t.right-r.fontHeight)/2,(t.top+t.bottom+o.measureTextWidth(e))/2,90)},DrawHorzBarText:function(e,t){var r=this,o=r.context,n=o.measureTextWidth(e),a=r.fontHeight,i=(t.left+t.right-n)/2,l=(t.top+t.bottom-a)/2;o.drawText(e,i,l)},CalcBarCount:function(){var e,t,r,o=this,n=o.graphs.length,a=0;for(e=0;n>e;e++)t=o.graphs[e],r=o.graphSerieses[t[0]].ChartType,1===r?a+=t.length:4!==r&&10!==r||a++;return a},CalcColumnBarCount:function(){var e,t,r,o=this,n=o.graphs.length,a=0;for(e=0;n>e;e++)t=o.graphs[e],r=o.graphSerieses[t[0]].ChartType,11===r?a+=t.length:12!=r&&13!=r||a++;return a},CalcFirtBarIndex:function(e){var t,r,o,n=this,a=n.graphs,i=a.length,l=0;for(t=0;i>t&&(r=a[t],r!==e);t++)o=n.graphSerieses[r[0]].ChartType,1===o?l+=r.length:4!==o&&10!==o||++l;return l},CalcFirtColumnBarIndex:function(e){var t,r,o,n=this,a=n.graphs,i=a.length,l=0;for(t=0;i>t&&(r=a[t],r!==e);t++)o=n.graphSerieses[r[0]].ChartType,11===o?l+=r.length:12!==o&&13!==o||++l;return l},CalcGroupTotalValue:function(e,t){var r,o=this,n=e.length,a=0;for(r=0;n>r;r++)a+=o.Value(e[r],t);return a},IsScatterGraph:function(){return this.Series.items[0].IsScatterGraph()},IsHorzGraph:function(){return this.Series.items[0].IsHorzGraph()},IsColorSingleBar:function(){var e=this;return 1==e.SeriesCount&&e.SingleSeriesColored},IsDrawNegativeGraph:function(){var e=this;return!e.Series.items.some(function(e){return e.ByY2Axis})&&e.YAxis.DrawMax>=0&&e.YAxis.DrawMin<0&&!e.AbsNegativeValue},LegendIsGroup:function(){var e=this,t=e.Series.items[0].ChartType;return 1===e.SeriesCount&&e.SingleSeriesColored&&(1===t||3===t||7===t||11===t)},LegendRealShowValue:function(){var e=this;return e.LegendValueVisible&&(!e.IsScatterGraph()||9===e.Series.items[0].ChartType)},LegendRealShowSum:function(){var e=this;return e.LegendShowSum&&e.LegendRealShowValue()},LegendItemCount:function(){var e=this;return(e.LegendIsGroup()?e.GroupCount:e.SeriesCount)+(e.LegendRealShowSum()?1:0)},LegendIsSumItem:function(e){var t=this;return t.LegendIsGroup()?e===t.GroupCount:e===t.SeriesCount},LegendItemLabel:function(e){var t=this;return t.LegendIsSumItem(e)?t.LegendSumLabelShow():t.LegendIsGroup()?t.GroupLabels[e]:t.getSeriesShowLabel(e)},LegendItemValueText:function(e){var t=this,r=0,o=t.graphSerieses[0];return t.LegendIsSumItem(e)?r=t.GetTotalValue():t.LegendIsGroup()?r=t.GetDrawValue(0,e):(r=t.GetSeriesTotalValue(e),o=t.graphSerieses[e]),o.ValueFormatParser.format(r)},LegendSumLabelShow:function(){return this.LegendSumLabel||"合计"},Support3D:function(){return this.Series.items.every(function(e){return e.Support3D()})},YAxisOfSeries:function(e){var t=this;return e.ByY2Axis?t.Y2Axis:t.YAxis},getSeriesShowLabel:function(e){var t=this;return t.SeriesLabels[e]||(t.graphSerieses[e]?t.graphSerieses[e].SeriesName:"")},getUsingTitleFont:function(){return this.TitleFont.UsingFont()},getUsingValueFont:function(){return this.ValueFont.UsingFont()},GetGraphFillColor:function(e){var t,r,o,n,a=this,i=a.graphSerieses[e],l=a.FillColors?a.FillColors.length:ChartSeriesColorCount;return a.IsColorSingleBar()||i.FillColorAuto?(t=Math.floor(e/l),r=e%l,o=a.FillColors?a.FillColors[r]:colorAlpha(ChartSeriesColorArray[r],a.report.viewer.alpha.chartGraph),t>0&&(n=color2rgba(o),o=rgba2color((n.r+73*r+196*t)%255,(n.g+197*r+120*t)%255,(n.b+117*r+90*t)%255,n.a)),o):i.FillColor},GetSeriesIndexByLabel:function(e,t){var r=this,o=r.SeriesLabels.indexOf(e);return 0>o&&t&&(o=+e,(!isNaN(o)||o>=r.SeriesCount)&&(o=-1)),o},GetGroupIndexByLabel:function(e,t){var r=this,o=r.GroupLabels.indexOf(e);return 0>o&&t&&(o=+e,(!isNaN(o)||o>=r.GroupCount)&&(o=-1)),o},GetDrawValueText:function(e,t){var r=this.graphSerieses[e];return r.LabelTextBuilder?r.LabelTextBuilder.generateChartDisplayText(e,t):""},GetGroupTotalValue:function(e,t){var r,o=this,n=e.length,a=0;if(!o.IsScatterGraph())for(r=0;n>r;r++)a+=o.Value(e[r],t);return a},GetSeriesTotalValue:function(e){var t,r,o=this,n=0;if(o.IsScatterGraph())for(r=o.ValueCount(e),t=0;r>t;t++)n+=o.Value(e,t).z;else for(t=0;t<o.GroupCount;t++)n+=o.Value(e,t);return n},GetTotalValue:function(){var e,t=this,r=0;for(e=0;e<t.SeriesCount;e++)r+=t.GetSeriesTotalValue(e);return r},prepareValues:function(){for(var e=this,t=e.values.length;t++<e.SeriesCount;)e.values.push([])},GroupLabel:function(e){return this.GroupLabels[e]},SetGroupLabel:function(e,t){this.GroupLabels[e]=t},SeriesLabel:function(e){return this.SeriesLabels[e]},SetSeriesLabel:function(e,t){this.SeriesLabels[e]=t},Value:function(e,t){var r=this;return r.prepareValues(),r.values[e][t]},SetValue:function(e,t,r){var o=this;o.prepareValues(),o.values[e][t]=r},ValueCount:function(e){var t=this;return t.prepareValues(),t.values[e].length},get FillColorCount(){var e=this;return e.FillColors?e.FillColors.length:0},getFillColor:function(e){var t=this;return t.FillColors?t.FillColors[e]:undefined},AddFillColor:function(e){var t=this;t.FillColors&&(t.FillColors=[]),t.FillColors.push(e)},EmptyFillColors:function(){delete self.FillColors},LoadDataFromXML:function(e,t,r,o){function n(){return l?i.text:i.textContent}var a,i,l,s,u,c,d=this,p=1,h=parseXML(e);if(!dom)return 0;o&&(d.GroupCount=0,d.GroupLabels=[]),r&&(d.SeriesCount=0,d.SeriesLabels=[]),d.values=[];try{for(a=h.childNodes[0].firstChild,nodeText=a.hasOwnProperty("text");a;){if(i=a.firstChild,t&&(s=n(),i=i.nextSibling,u=d.GetSeriesIndexByLabel(s,!r),0>u&&r&&(u=d.SeriesCount,d.SeriesCount++,d.SeriesLabels.push(s)),0>u))throw 0;if(s=n(),i=i.nextSibling,c=d.GetGroupIndexByLabel(s,!o),0>c&&o&&(c=d.GroupCount,d.GroupCount++,d.GroupLabels.push(s)),0>c)throw 0;if(t)d.SetValue(u,c,+n()+d.Value(u,c));else for(u=0;i;)d.SetValue(u,c,+n()+d.Value(u,c)),u++,i=i.nextSibling;a=a.nextSibling}}catch(f){p=0}return p},DoLoadXYZDataFromXML:function(e,t,r){function o(){return i?a.text:a.textContent}var n,a,i,l,s,u,c,d,p=this,h=1,f=parseXML(e);if(!dom)return 0;t&&(p.SeriesCount=0,p.SeriesLabels=[]),p.values=[];try{for(n=f.childNodes[0].firstChild,nodeText=n.hasOwnProperty("text");n;){if(a=n.firstChild,FirstSeries?(l=o(),d=p.GetSeriesIndexByLabel(l,!t),0>d&&t&&(d=m_SeriesCount,++m_SeriesCount,m_SeriesLabels[d]=l),a=a.nextSibling):d=0,0>d)throw 0;s=+o(),a=a.nextSibling,u=+o(),r||(a=a.nextSibling,c=+o()),p.AddXYZValue(d,s,u,c),n=n.nextSibling}}catch(m){h=0}return h},LoadXYDataFromXML:function(e,t){return this.DoLoadXYZDataFromXML(e,t,1)},LoadXYZDataFromXML:function(e,t){return DoLoadXYZDataFromXML(e,t,0)},AddXYZValue:function(e,t,r,o){var n=this;n.prepareValues(),n.values[e].push({x:t,y:r,z:o})},EmptyValues:function(){var e=this;e.values=[],e.prepareValues()}},prototypeCopyExtend(Chart,Control),gr.dom.Report=Report}(),function(e,t){"use strict";var r=gr.helper,o=gr.common,n=gr.const_,a=r.penStyleText,i=r.fontCSSText,l=r.pixelsToHtml,s=r.colorValue2Html,u=r.assignObject,c=r.compareObject,d=r.parseXML,p=r.xmlToReportDataJSON,h=o.HtmlStyles,f=function(e,t){return e.Styles===t.Styles&&(!e.Styles||c(e.Pen,t.Pen))&&e.Shadow===t.Shadow&&(!e.Shadow||e.ShadowWidth===t.ShadowWidth&&e.ShadowColor===t.ShadowColor)},m=function(e,t){return e.PaddingLeft===t.PaddingLeft&&e.PaddingRight===t.PaddingRight&&e.PaddingTop===t.PaddingTop&&e.PaddingBottom===t.PaddingBottom},g=function(e){var t,r=this;e.FreeCell?e.isSingleDockControl()&&(t=e.Controls.items[0],t.TextFormat&&(r.TextFormat={},u(r.TextFormat,t.TextFormat),r.TextFormat.ForeColor=t.ForeColor),r.PaddingLeft=t.PaddingLeft,r.PaddingRight=t.PaddingRight,r.PaddingTop=t.PaddingTop,r.PaddingBottom=t.PaddingBottom):(r.TextFormat={},u(r.TextFormat,e.TextFormat),r.TextFormat.ForeColor=e.ForeColor,r.PaddingLeft=e.PaddingLeft,r.PaddingRight=e.PaddingRight,r.PaddingTop=e.PaddingTop,r.PaddingBottom=e.PaddingBottom),e.BorderCustom?(r.border={},u(r.border,e.Border)):r.ownerGrid=e.getOwnerGrid(),r.toFillBack=e.toFillBack(),r.toFillBack&&(r.BackColor=e.BackColor)};g.prototype={compareObject:function(e){var t=this,r=e.toFillBack();return(t.TextFormat&&!e.FreeCell&&c(e.TextFormat,t.TextFormat)&&t.TextFormat.ForeColor===e.ForeColor&&m(t,e)||!t.TextFormat&&!e)&&(t.border&&e.Border&&f(e.Border,t.border)||!t.border&&!e.Border&&t.ownerGrid===e.getOwnerGrid())&&t.toFillBack===r&&(!r||t.BackColor===e.BackColor)},getStyleName:function(){return"-gr-cell"+this.index},getStyles:function(){var e=this,t=new h,r=e.TextFormat;return r&&(t.addTextFormat(r,1),t.addObjectPadding(e)),e.border?t.addBorder(e.border):t.addCellBorder(e.ownerGrid),e.toFillBack&&t.addBackColor(e.BackColor),t}};var C=function(e){var t=this,r=e.getUsingFont();t.asCell=!!e.cell,e.TextFormat&&(t.TextFormat={},u(t.TextFormat,e.TextFormat),t.TextFormat.ForeColor=e.ForeColor),t.PaddingLeft=e.PaddingLeft,t.PaddingRight=e.PaddingRight,t.PaddingTop=e.PaddingTop,t.PaddingBottom=e.PaddingBottom,t.border={},u(t.border,e.Border),t.toFillBack=e.toFillBack(),t.toFillBack&&(t.BackColor=e.BackColor),t.textdecoration={Underline:r.Underline,Strikethrough:r.Strikethrough}};C.prototype={compareObject:function(e){var t=this,r=e.getUsingFont(),o=e.toFillBack(),n=!!e.cell;return(e.TextFormat&&t.TextFormat&&c(e.TextFormat,t.TextFormat)&&t.TextFormat.ForeColor===e.ForeColor||!e.TextFormat&&!t.TextFormat)&&m(t,e)&&f(e.Border,t.border)&&t.toFillBack===o&&(!o||t.BackColor===e.BackColor)&&t.asCell===n&&t.textdecoration.Underline===r.Underline&&t.textdecoration.Strikethrough===r.Strikethrough},getStyleName:function(){return"-gr-ctrl"+this.index},getStyles:function(){var e=this,t=new h,r=e.textdecoration;return e.asCell||t.add("position","absolute"),t.addObjectPadding(e),t.addBorder(e.border),e.TextFormat&&t.addTextFormat(e.TextFormat,e.asCell),e.toFillBack&&t.addBackColor(e.BackColor),(r.Underline||r.Strikethrough)&&t.add("text-decoration",(r.Underline?"underline":"")+(r.Underline&&r.Strikethrough?" ":"")+(r.Strikethrough?"line-through":"")),t}};var x=function(e){var t=this;t.Left=e.pxRect.left,t.Top=e.pxRect.top,t.Width=e.getContentWidth(),t.Height=e.getContentHeight()};x.prototype={compareObject:function(e){var t=this;return t.Left===e.pxRect.left&&t.Top===e.pxRect.top&&t.Width===e.getContentWidth()&&t.Height===e.getContentHeight()},getStyleName:function(){return"-gr-pos"+this.index},getStyles:function(){var e=this,t=new h;return t.add("left",l(e.Left)),t.add("top",l(e.Top)),t.add("width",l(e.Width)),t.add("height",l(e.Height)),t}};var y=function(e){var t=this,r=e.cells?e:0;t.section=e,t.isLastRow=1,t.Height=e.pxHeight,r&&(e=r.section,t.isLastRow=e.tableRows[e.tableRows.length-1]===r),e.Font.font&&(t.Font={},u(t.Font,e.Font.font)),e.owner.GroupHeader&&(t.detailgrid=e.owner.owner),!e.toFillBack()||r&&!t.detailgrid||(t.BackColor=e.BackColor)};y.prototype={compareObject:function(e){var t=this,r=e.cells?e:0,o=e.pxHeight,n=1;r&&(e=e.section,n=e.tableRows[e.tableRows.length-1]===r);var a=e.toFillBack()&&(!r||e.owner.GroupHeader),i=e.Font.font;return t.Height===o&&(i&&t.Font&&c(i,t.Font)||!i&&!t.Font)&&(a&&t.BackColor&&t.BackColor===e.BackColor||!a&&!t.BackColor)&&(e.owner.GroupHeader&&e.owner.owner===t.detailgrid||!e.owner.GroupHeader&&!t.detailgrid)&&t.isLastRow===n},getStyleName:function(){return"-gr-section"+this.index},getStyles:function(){var e=this,t=e.section.pctHeight,r=new h,o=e.detailgrid;return r.add("height",t?t+"%":l(e.Height)),t&&r.add("width","100%"),e.Font&&(r.items=r.items.concat(T.prototype.getStyles.call(e.Font).items)),e.BackColor&&r.addBackColor(e.BackColor),e.isLastRow&&o&&o.ShowRowLine&&r.add("border-bottom",a(o.ColLinePen)),r}};var T=function(e){var t=this;
t.Size=e.Size,t.Bold=e.Bold,t.Italic=e.Italic,t.Name=e.Name};T.prototype={compareObject:function(e){var t=this;return t.Size===e.Size&&t.Bold===e.Bold&&t.Italic===e.Italic&&t.Name===e.Name},getStyleName:function(){return"-gr-fs"+this.index},getStyles:function(){var e=new h;return e.add("font",i(this)),e}};var S=function(e){this.htmlStyles=e};S.prototype={getStyleName:function(){return"-gr-cs"+this.index},getStyles:function(){return this.htmlStyles}};var b=function(e){var t=this;t.items=[],t.classStyle=e};b.prototype={toString:function(){var e="";return this.items.forEach(function(t){e+="."+t.getStyleName()+"{"+t.getStyles().getText()+"}\r\n"}),e},select:function(e,t){return this.selectItem(e,t).getStyleName()},selectItem:function(e,t){var r,o,n=this,a=n.items.length;if(t&&t.compareObject(e))return t;for(r=0;a>r;r++)if(o=n.items[r],o.compareObject(e))return o;return o=new n.classStyle(e),o.index=a,n.items.push(o),o}};var v=function(e,t,r,o){var n=this;n.running=!1,n.generated=!1,n.events={},n.viewerHolderID=e,n.reportHTTP={},"string"==typeof t?n.reportHTTP.url=t:u(n.reportHTTP,t),n.dataHTTP={},"string"==typeof r?n.dataHTTP.url=r:u(n.dataHTTP,r),n.alpha={background:.5,border:.8,stroke:.8,pen:.8,text:.8,chartGraph:.5,chartStroke:.8},n.attachOptions(o),n.report=new gr.dom.Report(n)};v.prototype={ajax:function(e,t){var r=this,o=new XMLHttpRequest;o.onreadystatechange=function(){4==o.readyState&&t.call(r,o,200==o.status)},o.onerror=function(){t.call(r,o,0)},"string"==typeof e&&(e={url:e,method:"GET"}),e.method||(e.method="GET"),o.open(e.method,e.url,!0),o.send(e.data)},attachOptions:function(e){var t=this;t.stop(),t.options={controlPosition:gr.enum_.controlLayout.auto,fitToHolder:!1,gridFitWidth:!1,singleChartFill:!1},e&&u(t.options,e)},start:function(){var e=this;e.generated||e.running||(e.reportPrepared=e.reportPrepared||!e.reportHTTP.url,e.dataPrepared=e.dataPrepared||!e.dataHTTP.url,e.reportPrepared||(e.running=!0,e.ajax(e.reportHTTP,function(e,t){this.doLoadReport(e,t,1)})),e.dataPrepared||(e.running=!0,e.ajax(e.dataHTTP,function(e,t){this.doLoadData(e,t,1)})))},stop:function(e,r){var o,n=this,a=n.report;return e=e||arguments[0]===t,n.running?0:(n.generated&&(e||(a.Clear(),reportPrepared=!1),r||(n.tables=null,dataPrepared=!1),n.viewerHolderID&&(o=document.getElementById(n.viewerHolderID),o&&(o.innerHTML="")),a.unprepare(),n.generated=!1),1)},loadReportFromText:function(e,r){r=r||arguments[1]===t,this.doLoadReport(e,1,r)},loadDataFromText:function(e,r){r=r||arguments[1]===t,this.doLoadData(e,1,r)},doLoadReport:function(e,t,r){var o,n=this,a="string"!=typeof e;if(t){try{n.report.loadFromJSON(JSON.parse(a?e.responseText:e))}catch(i){t=0,o="解析报表模板"}t&&(n.reportPrepared=!0,r&&n.generate())}else o="获取报表模板";t||n.displayError(o,a?n.reportHTTP:0,a?e:0,a?0:e)},doLoadData:function(e,t,r){var o,n,a=this,i="string"!=typeof e,l=t?(i?e.responseText:e).replace(/\r\n/g,""):"";if(t){try{if("{"===l.charAt(0))a.tables=JSON.parse(l);else{if(o=d(l),!o)throw 0;a.tables=p(o)}}catch(s){t=0,n="解析报表数据"}t&&(a.dataPrepared=!0,r&&a.generate())}else n="获取报表数据";t||a.displayError(n,i?a.dataHTTP:0,i?e:0,i?0:e)},generate:function(){var t=this,o=t.report,n=document.getElementById(t.viewerHolderID);if(t.reportPrepared&&t.dataPrepared){try{n.innerHTML="",t.html="",t.fontStyles=new b(T),t.controlStyles=new b(C),t.cellStyles=new b(g),t.sectionStyles=new b(y),t.positionStyles=new b(x),t.customStyles=new b(S),n.classList.add(t.selectFont2(o.Font.font)),16777215!==o.BackColor&&(n.style.backgroundColor=s(o.BackColor)),o.generate(),t.generateStyles(),n.innerHTML=t.html,o.toFillHolder&&(n.style.height="100%"),o.singleChart&&(n.style.backgroundColor=s(o.singleChart.BackColor)),o.canvasControls&&(o.prepareCanvas(),o.renderCanvas()),o.toFillHolder&&(r.addEvent(e,"resize",function(e){o.resizeCanvas()},1),o.resizeCanvas())}catch(a){}t.running=!1,t.generated=!0,t.events.onGenerated&&t.events.onGenerated(t)}},generateStyles:function(){var e=this,t=e.report.toFillHolder?"html,body{height:100%;}\n*{margin:0;padding:0;}":"",r=[t,e.fontStyles,e.positionStyles,e.sectionStyles,e.cellStyles,e.controlStyles,e.customStyles],o=r.join(""),a=document.getElementById(n.REPORT_STYLE_ID);a||(a=document.createElement("STYLE"),a.id=n.REPORT_STYLE_ID,document.head.appendChild(a)),a.innerHTML=o},addCustomStyle:function(e){var t=this.customStyles.items,r=new S(e);return r.index=t.length,t.push(r),r},selectCell:function(e){return this.cellStyles.select(e,e.defaultStyle)},selectCellItem:function(e){return this.cellStyles.selectItem(e)},selectControl:function(e){return this.controlStyles.select(e,e.defaultStyle)},selectControlItem:function(e){return this.controlStyles.selectItem(e)},selectSection:function(e){return this.sectionStyles.select(e,e.defaultStyle)},selectSectionItem:function(e){return this.sectionStyles.selectItem(e)},selectPosition:function(e){return this.positionStyles.select(e,e.defaultPositionStyle)},selectPositionItem:function(e){return this.positionStyles.selectItem(e)},selectFont:function(e,t){return this.fontStyles.select(e,t)},selectFont2:function(e){return this.selectFontItem(e).getStyleName()},selectFontItem:function(e){return this.fontStyles.selectItem(e)},displayError:function(e,t,r,o){var n,a=document.getElementById(this.viewerHolderID);n='<div style="background-color:#bbffbb"><h3>'+e+"失败!</h3>",t&&(n+="<div>URL: "+t.url+"</div>"),r?(n+="<div>HTTP Status: "+r.status+"</div><div>HTTP Status Text: "+r.statusText+"</div>",r.responseText&&(n+="<div>HTTP Response Text: <pre>"+r.responseText+"</pre></div>")):n+="<div>Loaded Text: <pre>"+r.responseText+"</pre></div>",n+="</div>",a.innerHTML=n},get reportURL(){return this.reportHTTP.url},set reportURL(e){this.reportHTTP.url=e},get dataURL(){return this.dataHTTP.url},set dataURL(e){this.dataHTTP.url=e}},e.rubylong={grhtml5:{controlLayout:gr.enum_.controlLayout,insertReportViewer:function(e,t,r,o){return new v(e,t,r,o)}}}}(window);